var oldDCI=window.DCI,DCI={};DCI.version="0.7.3";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=DCI}else{if(typeof define==="function"&&define.amd){define(DCI)}}DCI.noConflict=function(){window.DCI=oldDCI;return this};window.DCI=DCI;DCI.Util={extend:function(d){var c=Array.prototype.slice.call(arguments,1),e,b,a,f;for(b=0,a=c.length;b<a;b++){f=c[b]||{};for(e in f){if(f.hasOwnProperty(e)){d[e]=f[e]}}}return d},bind:function(b,c){var a=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return b.apply(c,a||arguments)}},stamp:(function(){var b=0,a="_dci_id";return function(c){c[a]=c[a]||++b;return c[a]}}()),invokeEach:function(d,e,c){var b,a;if(typeof d==="object"){a=Array.prototype.slice.call(arguments,3);for(b in d){e.apply(c,[b,d[b]].concat(a))}return true}return false},limitExecByInterval:function(d,f,c){var b,e;return function a(){var g=arguments;if(b){e=true;return}b=true;setTimeout(function(){b=false;if(e){a.apply(c,g);e=false}},f);d.apply(c,g)}},falseFn:function(){return false},formatNum:function(a,c){var b=Math.pow(10,c||5);return Math.round(a*b)/b},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return DCI.Util.trim(a).split(/\s+/)},setOptions:function(b,a){b.options=DCI.extend({},b.options,a);return b.options},getParamString:function(d,a,b){var e=[];for(var c in d){e.push(encodeURIComponent(b?c.toUpperCase():c)+"="+encodeURIComponent(d[c]))}return((!a||a.indexOf("?")===-1)?"?":"&")+e.join("&")},template:function(b,a){return b.replace(/\{ *([\w_]+) *\}/g,function(e,c){var d=a[c];if(d===undefined){throw new Error("No value provided for variable "+e)}else{if(typeof d==="function"){d=d(a)}}return d})},each:function(d,c){for(var a=0;a<d.length;a++){var b=c(d[a],a);if(b){return}else{continue}}},isArray:Array.isArray||function(a){return(Object.prototype.toString.call(a)==="[object Array]")},findByTagName:function(c,a,d){var b=c.getElementsByTagName(a);if(c==null){return null}if(!DCI.Browser.ie){if(b.length==0){b=c.getElementsByTagName(d)}}return b},calculateAngle:function(a,b,c){var d;if((b.lng-a.lng)==0&&(b.lat-a.lat)==0){d=c}else{if((b.lng-a.lng)==0){if(b.lat>a.lat){d=270}else{d=90}}else{if((b.lat-a.lat)==0){if(b.lng>a.lng){d=0}else{d=180}}else{if(b.lat-a.lat>0&&b.lng-a.lng<0){d=(Math.atan((b.lat-a.lat)/(a.lng-b.lng))/Math.PI)*180;d=d+180}else{if(b.lat-a.lat<0&&b.lng-a.lng<0){d=(Math.atan((a.lat-b.lat)/(a.lng-b.lng))/Math.PI)*180;d=180-d}else{if(b.lat-a.lat>0&&b.lng-a.lng>0){d=(Math.atan((b.lat-a.lat)/(b.lng-a.lng))/Math.PI)*180;d=360-d}else{d=(Math.atan((a.lat-b.lat)/(b.lng-a.lng))/Math.PI)*180;d=d}}}}}if(d){c=d}else{d=c}}return d},pbRightClick:function(){if(window.Event){document.captureEvents(Event.MOUSEUP)}function b(){return false}function a(c){if(window.Event){if(c.which&&(c.which==2||c.which==3)){return false}}else{if(event.button==2||event.button==3){event.cancelBubble=true;event.returnValue=false;return false}}}document.oncontextmenu=b;document.onmousedown=a},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function d(f){var g,h,k=["webkit","moz","o","ms"];for(g=0;g<k.length&&!h;g++){h=window[k[g]+f]}return h}var e=0;function b(f){var h=+new Date(),g=Math.max(0,16-(h-e));e=h+g;return window.setTimeout(f,g)}var a=window.requestAnimationFrame||d("RequestAnimationFrame")||b;var c=window.cancelAnimationFrame||d("CancelAnimationFrame")||d("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};DCI.Util.requestAnimFrame=function(k,h,f,g){k=DCI.bind(k,h);if(f&&a===b){k()}else{return a.call(window,k,g)}};DCI.Util.cancelAnimFrame=function(f){if(f){c.call(window,f)}}}());DCI.extend=DCI.Util.extend;DCI.bind=DCI.Util.bind;DCI.each=DCI.Util.each;DCI.stamp=DCI.Util.stamp;DCI.setOptions=DCI.Util.setOptions;DCI.findByTagName=DCI.Util.findByTagName;DCI.calculateAngle=DCI.Util.calculateAngle;DCI.pbRightClick=DCI.Util.pbRightClick;DCI.Class=function(){};DCI.Class.extend=function(c){var f=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks){this.callInitHooks()}};var e=function(){};e.prototype=this.prototype;var d=new e();d.constructor=f;f.prototype=d;for(var a in this){if(this.hasOwnProperty(a)&&a!=="prototype"){f[a]=this[a]}}if(c.statics){DCI.extend(f,c.statics);delete c.statics}if(c.includes){DCI.Util.extend.apply(null,[d].concat(c.includes));delete c.includes}if(c.options&&d.options){c.options=DCI.extend({},d.options,c.options)}DCI.extend(d,c);d._initHooks=[];var b=this;f.__super__=b.prototype;d.callInitHooks=function(){if(this._initHooksCalled){return}if(b.prototype.callInitHooks){b.prototype.callInitHooks.call(this)}this._initHooksCalled=true;for(var h=0,g=d._initHooks.length;h<g;h++){d._initHooks[h].call(this)}};return f};DCI.Class.include=function(a){DCI.extend(this.prototype,a)};DCI.Class.mergeOptions=function(a){DCI.extend(this.prototype.options,a)};DCI.Class.addInitHook=function(b){var a=Array.prototype.slice.call(arguments,1);var c=typeof b==="function"?b:function(){this[b].apply(this,a)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(c)};var eventsKey="_dci_events";DCI.Mixin={};DCI.Mixin.Events={addEventListener:function(f,m,b){if(DCI.Util.invokeEach(f,this.addEventListener,this,m,b)){return this}var n=this[eventsKey]=this[eventsKey]||{},e=b&&b!==this&&DCI.stamp(b),d,g,a,l,c,k,h;f=DCI.Util.splitWords(f);for(d=0,g=f.length;d<g;d++){a={action:m,context:b||this};l=f[d];if(e){c=l+"_idx";k=c+"_len";h=n[c]=n[c]||{};if(!h[e]){h[e]=[];n[k]=(n[k]||0)+1}h[e].push(a)}else{n[l]=n[l]||[];n[l].push(a)}}return this},hasEventListeners:function(b){var a=this[eventsKey];return !!a&&((b in a&&a[b].length>0)||(b+"_idx" in a&&a[b+"_idx_len"]>0))},removeEventListener:function(g,o,a){if(!this[eventsKey]){return this}if(!g){return this.clearAllEventListeners()}if(DCI.Util.invokeEach(g,this.removeEventListener,this,o,a)){return this}var p=this[eventsKey],e=a&&a!==this&&DCI.stamp(a),d,h,n,m,b,c,l,k,f;g=DCI.Util.splitWords(g);for(d=0,h=g.length;d<h;d++){n=g[d];c=n+"_idx";l=c+"_len";k=p[c];if(!o){delete p[n];delete p[c];delete p[l]}else{m=e&&k?k[e]:p[n];if(m){for(b=m.length-1;b>=0;b--){if((m[b].action===o)&&(!a||(m[b].context===a))){f=m.splice(b,1);f[0].action=DCI.Util.falseFn}}if(a&&k&&(m.length===0)){delete k[e];p[l]--}}}}return this},clearAllEventListeners:function(){delete this[eventsKey];return this},fireEvent:function(g,b){if(!this.hasEventListeners(g)){return this}var a=DCI.Util.extend({},b,{type:g,target:this});var k=this[eventsKey],h,c,e,f,d;if(k[g]){h=k[g].slice();for(c=0,e=h.length;c<e;c++){h[c].action.call(h[c].context,a)}}f=k[g+"_idx"];for(d in f){h=f[d].slice();if(h){for(c=0,e=h.length;c<e;c++){h[c].action.call(h[c].context,a)}}}return this},addOneTimeEventListener:function(b,d,a){if(DCI.Util.invokeEach(b,this.addOneTimeEventListener,this,d,a)){return this}var c=DCI.bind(function(){this.removeEventListener(b,d,a).removeEventListener(b,c,a)},this);return this.addEventListener(b,d,a).addEventListener(b,c,a)}};DCI.Mixin.Events.on=DCI.Mixin.Events.addEventListener;DCI.Mixin.Events.off=DCI.Mixin.Events.removeEventListener;DCI.Mixin.Events.once=DCI.Mixin.Events.addOneTimeEventListener;DCI.Mixin.Events.fire=DCI.Mixin.Events.fireEvent;(function(){var p="ActiveXObject" in window,u=p&&!document.addEventListener,t=navigator.userAgent.toLowerCase(),l=t.indexOf("mozilla")!==-1,a=t.indexOf("webkit")!==-1,o=t.indexOf("chrome")!==-1,c=t.indexOf("phantom")!==-1,v=t.indexOf("android")!==-1,n=t.search("android [23]")!==-1,k=t.indexOf("gecko")!==-1,e=typeof orientation!==undefined+"",d=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints&&!window.PointerEvent,q=(window.PointerEvent&&window.navigator.pointerEnabled&&window.navigator.maxTouchPoints)||d,b=("devicePixelRatio" in window&&window.devicePixelRatio>1)||("matchMedia" in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches),w=document.documentElement,r=p&&("transition" in w.style),m=("WebKitCSSMatrix" in window)&&("m11" in new window.WebKitCSSMatrix())&&!n,g="MozPerspective" in w.style,s="OTransition" in w.style,h=!window.L_DISABLE_3D&&(r||m||g||s)&&!c;var f=!window.L_NO_TOUCH&&!c&&(function(){var y="ontouchstart";if(q||(y in w)){return true}var z=document.createElement("div"),x=false;if(!z.setAttribute){return false}z.setAttribute(y,"return;");if(typeof z[y]==="function"){x=true}z.removeAttribute(y);z=null;return x}());DCI.Browser={ie:p,ielt9:u,mozilla:l,webkit:a,gecko:k&&!a&&!window.opera&&!p,android:v,android23:n,chrome:o,ie3d:r,webkit3d:m,gecko3d:g,opera3d:s,any3d:h,mobile:e,mobileWebkit:e&&a,mobileWebkit3d:e&&m,mobileOpera:e&&window.opera,touch:f,msPointer:d,pointer:q,retina:b,getIEVersion:function(){var y=navigator.appName;var A=navigator.appVersion;var x=A.split(";");var z=x[1].replace(/[ ]/g,"");var B=11;if(z=="MSIE10.0"){B=10}else{if(z=="MSIE9.0"){B=9}else{if(z=="MSIE8.0"){B=8}else{if(z=="MSIE7.0"){B=7}else{if(z=="MSIE6.0"){B=6}}}}}return B}}}());DMath=function(){this.CalculateDis4=function(f,e,h,g){return Math.sqrt((f-h)*(f-h)+(e-g)*(e-g))};this.CalculateThreePoint=function(h,g,p,o,n,m,l){var k=h*o-g*p+g*n-h*m+p*m-o*n;if(Math.abs(k)>this.CalculateDis4(h,g,p,o)*l){return 0}if(this.CalculateDis4(h,g,n,m)<=l){return 1}if(this.CalculateDis4(p,o,n,m)<=l){return 2}if((h-n)*(n-p)>(0.0125*l)){return 3}if((g-m)*(m-o)>(0.0125*l)){return 3}};this.verPToALine=function(b,h,a,g,c,k,f,l){var d=parseFloat(this.CalculateDis4(b,h,a,g));var e;e=(d-parseFloat(this.CalculateDis4(a,g,c,k))*Math.cos(this.JD3(b,h,a,g,c,k)*Math.PI/180))/d;f=parseFloat(b)+parseFloat((a-b)*e);l=parseFloat(h)+parseFloat((g-h)*e);return new DCI.Point(f,l)};this.JD3=function(w,s,q,p,o,n){var m=w*p-s*q+s*o-w*n+q*n-p*o;var v,k;v=parseFloat((o-q)*(w-q)+(n-p)*(s-p));k=parseFloat((n-p)*(w-q)-(o-q)*(s-p));var l;l=v*v+k*k;if(l<1e-300){return 0}var u=33;var t,r;t=v;r=k;if(t==0){if(r>0){u=90}if(r<0){u=270}}if(r==0){if(t>0){u=0}if(t<0){u=180}}if(u!=33){return u}u=Math.atan2(Math.abs(k),Math.abs(v))/Math.PI*180;if(t>0&&r>0){return u}if(t<0&&r>0){return 180-u}if(t>0&&r<0){return 360-u}return 180+u;return 0};this.DistanceLine=function(){}};DMath.Haversine=function(a){return(1-Math.cos(a))/2};DMath.CalcHav=function(e,g,d,f){var c=Math.cos(g);var b=Math.cos(f);var a=DMath.Haversine(f-g)+c*b*DMath.Haversine(d-e);a=2*Math.asin(Math.sqrt(a));return a};DMath.SphericalPolygonArea=function(h,k,l){var w=6378137;var p=k.length;if(p<3){return 0}var f=0;if(l){for(var u=0;u<p;u++){f=f+(h[u]*k[(u+1)%p]-h[(u+1)%p]*k[u])}return Math.abs(0.5*f)}else{var y,g,x,e,v,d;g=k[0];y=h[0];for(var r=1;r<p-1;r++){e=k[r];x=h[r];d=k[r+1];v=h[r+1];var B=DMath.CalcHav(y,g,x,e);var A=DMath.CalcHav(x,e,v,d);var z=DMath.CalcHav(v,d,y,g);var o=0.5*(B+A+z);var m=Math.tan(o/2)*Math.tan((o-B)/2)*Math.tan((o-A)/2)*Math.tan((o-z)/2);var q=Math.abs(4*Math.atan(Math.sqrt(Math.abs(m))));if(y*e-g*x+g*v-y*d+x*d-e*v>0){q=-q}f+=q}return Math.abs(f)*w*w}};DMath.IsInnnerIntersection=function(b,k){var d,o,c,m,a,l,p,h;var e=b.length;for(var g=0;g<e;g++){d=b[g];o=k[g];c=b[(g+1)%e];m=k[(g+1)%e];for(var f=g+2;f<g+e-1;f++){a=b[f%e];l=k[f%e];p=b[(1+f)%e];h=k[(1+f)%e];if(DMath.InterSection8(d,o,c,m,a,l,p,h)){return 1}}}return 0};DMath.InterSection8=function(d,n,b,l,a,k,q,h){var c,m,f,p,o;c=((a-q)*(l-n)-(k-h)*(b-d));if(c==0){return 0}m=((a-d)*(h-k)-(q-a)*(k-n));f=((a-d)*(l-n)-(b-d)*(k-n));try{p=(m/c)}catch(g){return 0}try{o=(f/c)}catch(g){return 0}if(p>1||p<0){return 0}if(o>1||o<0){return 0}return 1};DCI.Point=function(a,c,b){this.x=(b?Math.round(a):a);this.y=(b?Math.round(c):c)};DCI.Point.prototype={clone:function(){return new DCI.Point(this.x,this.y)},add:function(a){return this.clone()._add(DCI.point(a))},_add:function(a){this.x+=a.x;this.y+=a.y;return this},subtract:function(a){return this.clone()._subtract(DCI.point(a))},_subtract:function(a){this.x-=a.x;this.y-=a.y;return this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){this.x/=a;this.y/=a;return this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){this.x*=a;this.y*=a;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(b){b=DCI.point(b);var a=b.x-this.x,c=b.y-this.y;return Math.sqrt(a*a+c*c)},equals:function(a){a=DCI.point(a);return a.x===this.x&&a.y===this.y},contains:function(a){a=DCI.point(a);return Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+DCI.Util.formatNum(this.x)+", "+DCI.Util.formatNum(this.y)+")"}};DCI.point=function(a,c,b){if(a instanceof DCI.Point){return a}if(DCI.Util.isArray(a)){return new DCI.Point(a[0],a[1])}if(a===undefined||a===null){return a}return new DCI.Point(a,c,b)};DCI.Bounds=function(e,d){if(!e){return}var g=d?[e,d]:e;for(var f=0,c=g.length;f<c;f++){this.extend(g[f])}};DCI.Bounds.prototype={extend:function(a){a=DCI.point(a);if(!this.min&&!this.max){this.min=a.clone();this.max=a.clone()}else{this.min.x=Math.min(a.x,this.min.x);this.max.x=Math.max(a.x,this.max.x);this.min.y=Math.min(a.y,this.min.y);this.max.y=Math.max(a.y,this.max.y)}return this},getCenter:function(a){return new DCI.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new DCI.Point(this.min.x,this.max.y)},getTopRight:function(){return new DCI.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(c){var b,a;if(typeof c[0]==="number"||c instanceof DCI.Point){c=DCI.point(c)}else{c=DCI.bounds(c)}if(c instanceof DCI.Bounds){b=c.min;a=c.max}else{b=a=c}return(b.x>=this.min.x)&&(a.x<=this.max.x)&&(b.y>=this.min.y)&&(a.y<=this.max.y)},intersects:function(f){f=DCI.bounds(f);var d=this.min,a=this.max,e=f.min,b=f.max,c=(b.x>=d.x)&&(e.x<=a.x),g=(b.y>=d.y)&&(e.y<=a.y);return c&&g},isValid:function(){return !!(this.min&&this.max)}};DCI.bounds=function(d,c){if(!d||d instanceof DCI.Bounds){return d}return new DCI.Bounds(d,c)};DCI.Transformation=function(f,e,h,g){this._a=f;this._b=e;this._c=h;this._d=g};DCI.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){b=b||1;a.x=b*(this._a*a.x+this._b);a.y=b*(this._c*a.y+this._d);return a},untransform:function(a,b){b=b||1;return new DCI.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}};DCI.DomUtil={get:function(a){return(typeof a==="string"?document.getElementById(a):a)},getStyle:function(c,b){var d=c.style[b];if(!d&&c.currentStyle){d=c.currentStyle[b]}if((!d||d==="auto")&&document.defaultView){var a=document.defaultView.getComputedStyle(c,null);d=a?a[b]:null}return d==="auto"?null:d},getViewportOffset:function(f){var k=0,e=0,d=f,g=document.body,c=document.documentElement,h;do{k+=d.offsetTop||0;e+=d.offsetLeft||0;k+=parseInt(DCI.DomUtil.getStyle(d,"borderTopWidth"),10)||0;e+=parseInt(DCI.DomUtil.getStyle(d,"borderLeftWidth"),10)||0;h=DCI.DomUtil.getStyle(d,"position");if(d.offsetParent===g&&h==="absolute"){break}if(h==="fixed"){k+=g.scrollTop||c.scrollTop||0;e+=g.scrollLeft||c.scrollLeft||0;break}if(h==="relative"&&!d.offsetLeft){var b=DCI.DomUtil.getStyle(d,"width"),l=DCI.DomUtil.getStyle(d,"max-width"),a=d.getBoundingClientRect();if(b!=="none"||l!=="none"){e+=a.left+d.clientLeft}k+=a.top+(g.scrollTop||c.scrollTop||0);break}d=d.offsetParent}while(d);d=f;do{if(d===g){break}k-=d.scrollTop||0;e-=d.scrollLeft||0;d=d.parentNode}while(d);return new DCI.Point(e,k)},documentIsLtr:function(){if(!DCI.DomUtil._docIsLtrCached){DCI.DomUtil._docIsLtrCached=true;DCI.DomUtil._docIsLtr=DCI.DomUtil.getStyle(document.body,"direction")==="ltr"}return DCI.DomUtil._docIsLtr},create:function(b,d,a){var c=document.createElement(b);c.className=d;if(a){a.appendChild(c)}return c},createforIE6:function(b,d,a){var c=document.createElement(b);if(b=="div"&&d=="dci-tile"){}else{c.className=d}if(a){a.appendChild(c)}return c},hasClass:function(c,a){if(c.classList!==undefined){return c.classList.contains(a)}var b=DCI.DomUtil._getClass(c);return b.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(b)},addClass:function(f,b){if(f.classList!==undefined){var d=DCI.Util.splitWords(b);for(var c=0,a=d.length;c<a;c++){f.classList.add(d[c])}}else{if(!DCI.DomUtil.hasClass(f,b)){var e=DCI.DomUtil._getClass(f);DCI.DomUtil._setClass(f,(e?e+" ":"")+b)}}},removeClass:function(b,a){if(b.classList!==undefined){b.classList.remove(a)}else{DCI.DomUtil._setClass(b,DCI.Util.trim((" "+DCI.DomUtil._getClass(b)+" ").replace(" "+a+" "," ")))}},_setClass:function(b,a){if(b.className.baseVal===undefined){b.className=a}else{b.className.baseVal=a}},_getClass:function(a){return a.className.baseVal===undefined?a.className:a.className.baseVal},setOpacity:function(c,d){if("opacity" in c.style){c.style.opacity=d}else{if("filter" in c.style){var b=false,a="DXImageTransform.Microsoft.Alpha";try{b=c.filters.item(a)}catch(f){if(d===1){return}}d=Math.round(d*100);if(b){b.Enabled=(d!==100);b.Opacity=d}else{c.style.filter+=" progid:"+a+"(opacity="+d+")"}}}},testProp:function(c){var b=document.documentElement.style;for(var a=0;a<c.length;a++){if(c[a] in b){return c[a]}}return false},getTranslateString:function(a){var c=DCI.Browser.webkit3d,b="translate"+(c?"3d":"")+"(",d=(c?",0":"")+")";return b+a.x+"px,"+a.y+"px"+d},getScaleString:function(c,a){var d=DCI.DomUtil.getTranslateString(a.add(a.multiplyBy(-1*c))),b=" scale("+c+") ";return d+b},setPosition:function(c,a,b){c._dci_pos=a;if(!b&&DCI.Browser.any3d){c.style[DCI.DomUtil.TRANSFORM]=DCI.DomUtil.getTranslateString(a)}else{c.style.left=a.x+"px";c.style.top=a.y+"px"}},getPosition:function(a){return a._dci_pos}};DCI.DomUtil.TRANSFORM=DCI.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);DCI.DomUtil.TRANSITION=DCI.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);DCI.DomUtil.TRANSITION_END=DCI.DomUtil.TRANSITION==="webkitTransition"||DCI.DomUtil.TRANSITION==="OTransition"?DCI.DomUtil.TRANSITION+"End":"transitionend";(function(){if("onselectstart" in document){DCI.extend(DCI.DomUtil,{disableTextSelection:function(){DCI.DomEvent.on(window,"selectstart",DCI.DomEvent.preventDefault)},enableTextSelection:function(){DCI.DomEvent.off(window,"selectstart",DCI.DomEvent.preventDefault)}})}else{var a=DCI.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);DCI.extend(DCI.DomUtil,{disableTextSelection:function(){if(a){var b=document.documentElement.style;this._userSelect=b[a];b[a]="none"}},enableTextSelection:function(){if(a){document.documentElement.style[a]=this._userSelect;delete this._userSelect}}})}DCI.extend(DCI.DomUtil,{disableImageDrag:function(){DCI.DomEvent.on(window,"dragstart",DCI.DomEvent.preventDefault)},enableImageDrag:function(){DCI.DomEvent.off(window,"dragstart",DCI.DomEvent.preventDefault)}})})();DCI.LatLng=function(a,c,b){a=parseFloat(a);c=parseFloat(c);if(isNaN(a)||isNaN(c)){throw new Error("Invalid LatLng object: ("+a+", "+c+")")}this.lng=a;this.lat=c;if(b!==undefined){this.alt=parseFloat(b)}};DCI.extend(DCI.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});DCI.LatLng.prototype={equals:function(b){if(!b){return false}b=DCI.latLng(b);var a=Math.max(Math.abs(this.lng-b.lng),Math.abs(this.lat-b.lat));return a<=DCI.LatLng.MAX_MARGIN},clone:function(){return new DCI.LatLng(this.lng,this.lat)},toString:function(a){return"LatLng("+DCI.Util.formatNum(this.lng,a)+", "+DCI.Util.formatNum(this.lat,a)+")"},distanceTo:function(h){h=DCI.latLng(h);var g=6378137,d=DCI.LatLng.DEG_TO_RAD,l=(h.lng-this.lng)*d,k=(h.lat-this.lat)*d,f=this.lat*d,c=h.lat*d,e=Math.sin(k/2),b=Math.sin(l/2);var m=e*e+b*b*Math.cos(f)*Math.cos(c);return g*2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},wrap:function(d,c){var e=this.lng;d=d||-180;c=c||180;e=(e+c)%(c-d)+(e<d||e===c?c:d);return new DCI.LatLng(e,this.lat)},gml:function(){return"<Point><coordinates>"+this.lng+","+this.lat+"</coordinates></Point>"}};DCI.latLng=function(d,c){if(d instanceof DCI.LatLng){return d}if(DCI.Util.isArray(d)){if(typeof d[0]==="number"||typeof d[0]==="string"){return new DCI.LatLng(d[0],d[1],d[2])}else{return null}}if(d===undefined||d===null){return d}if(typeof d==="object"&&"lat" in d){return new DCI.LatLng("lng" in d?d.lng:d.lon,d.lat)}if(c===undefined){return null}return new DCI.LatLng(d,c)};DCI.LatLngBounds=function(e,c){if(!e){return}var b=c?[e,c]:e;for(var d=0,a=b.length;d<a;d++){this.extend(b[d])}};DCI.LatLngBounds.prototype={extend:function(b){if(!b){return this}var a=DCI.latLng(b);if(a!==null){b=a}else{b=DCI.latLngBounds(b)}if(b instanceof DCI.LatLng){if(!this._southWest&&!this._northEast){this._southWest=new DCI.LatLng(b.lng,b.lat);this._northEast=new DCI.LatLng(b.lng,b.lat)}else{this._southWest.lng=Math.min(b.lng,this._southWest.lng);this._southWest.lat=Math.min(b.lat,this._southWest.lat);this._northEast.lng=Math.max(b.lng,this._northEast.lng);this._northEast.lat=Math.max(b.lat,this._northEast.lat)}}else{if(b instanceof DCI.LatLngBounds){this.extend(b._southWest);this.extend(b._northEast)}}return this},pad:function(d){var b=this._southWest,e=this._northEast,c=Math.abs(b.lng-e.lng)*d,a=Math.abs(b.lat-e.lat)*d;return new DCI.LatLngBounds(new DCI.LatLng(b.lng-c,b.lat-a),new DCI.LatLng(e.lng+c,e.lat+a))},getCenter:function(){return new DCI.LatLng((this._southWest.lng+this._northEast.lng)/2,(this._southWest.lat+this._northEast.lat)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new DCI.LatLng(this.getWest(),this.getNorth())},getSouthEast:function(){return new DCI.LatLng(this.getEast(),this.getSouth())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){if(typeof e[0]==="number"||e instanceof DCI.LatLng){e=DCI.latLng(e)}else{e=DCI.latLngBounds(e)}var a=this._southWest,d=this._northEast,b,c;if(e instanceof DCI.LatLngBounds){b=e.getSouthWest();c=e.getNorthEast()}else{b=c=e}return(b.lat>=a.lat)&&(c.lat<=d.lat)&&(b.lng>=a.lng)&&(c.lng<=d.lng)},intersects:function(d){d=DCI.latLngBounds(d);var a=this._southWest,g=this._northEast,b=d.getSouthWest(),f=d.getNorthEast(),c=(f.lng>=a.lng)&&(b.lng<=g.lng),e=(f.lat>=a.lat)&&(b.lat<=g.lat);return c&&e},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){if(!a){return false}a=DCI.latLngBounds(a);return this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())},isValid:function(){return !!(this._southWest&&this._northEast)},intersection:function(b){var c=new DCI.LatLng(Math.max(this.getWest(),b.getWest()),Math.min(this.getSouth(),b.getSouth()));var a=new DCI.LatLng(Math.min(this.getEast(),b.getEast()),Math.max(this.getNorth(),b.getNorth()));if(c&&a){return new DCI.LatLngBounds(c,a)}}};DCI.latLngBounds=function(d,c){if(!d||d instanceof DCI.LatLngBounds){return d}return new DCI.LatLngBounds(d,c)};DCI.Projection={};DCI.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(g){var e=DCI.LatLng.DEG_TO_RAD,b=this.MAX_LATITUDE,c=Math.max(Math.min(b,g.lat),-b),a=g.lng*e,f=c*e;f=Math.log(Math.tan((Math.PI/4)+(f/2)));return new DCI.Point(a,f)},unproject:function(a){var e=DCI.LatLng.RAD_TO_DEG,b=a.x*e,c=(2*Math.atan(Math.exp(a.y))-(Math.PI/2))*e;return new DCI.LatLng(b,c)}};DCI.Projection.LonLat={project:function(a){return new DCI.Point(a.lng,a.lat)},unproject:function(a){return new DCI.LatLng(a.x,a.y)}};DCI.CRS={latLngToPoint:function(d,b){var a=this.projection.project(d),c=this.scale(b);return this.transformation._transform(a,c)},pointToLatLng:function(a,c){var d=this.scale(c),b=this.transformation.untransform(a,d);return this.projection.unproject(b)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(b){var a=this.scale(b);return DCI.point(a,a)}};DCI.CRS.Simple=DCI.extend({},DCI.CRS,{projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}});DCI.CRS.EPSG3857=DCI.extend({},DCI.CRS,{code:"EPSG:3857",projection:DCI.Projection.SphericalMercator,transformation:new DCI.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(c){var b=this.projection.project(c),a=6378137;return b.multiplyBy(a)}});DCI.CRS.EPSG900913=DCI.extend({},DCI.CRS.EPSG3857,{code:"EPSG:900913"});DCI.CRS.EPSG900919=DCI.extend({},DCI.CRS.EPSG3857,{code:"CRS:84"});DCI.CRS.EPSG4326=DCI.extend({},DCI.CRS,{code:"EPSG:4326",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1/360,0.5,-1/360,0.5)});DCI.CRS.EPSG4490=DCI.extend({},DCI.CRS,{code:"EPSG:4490",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1/360,0.5,-1/360,0.25)});DCI.Map=DCI.Class.extend({includes:DCI.Mixin.Events,options:{crs:DCI.CRS.EPSG3857,fadeAnimation:DCI.DomUtil.TRANSITION&&!DCI.Browser.android23,trackResize:true,markerZoomAnimation:DCI.DomUtil.TRANSITION&&DCI.Browser.any3d,WMTS:false,WMTS_XOrigin:0,WMTS_YOrigin:0,X990003:1,Y990003:-1},initialize:function(b,a){a=DCI.setOptions(this,a);this._initContainer(b);this._initLayout();this._onResize=DCI.bind(this._onResize,this);this._initEvents();if(a.maxBounds){this.setMaxBounds(a.maxBounds)}if(a.center&&a.zoom!==undefined){this.setView(DCI.latLng(a.center),a.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(a.layers)},setView:function(a,b){b=b===undefined?this.getZoom():b;this._resetView(DCI.latLng(a),this._limitZoom(b));return this},setZoom:function(b,a){if(!this._loaded){this._zoom=this._limitZoom(b);return this}return this.setView(this.getCenter(),b,{zoom:a})},zoomIn:function(b,a){return this.setZoom(this._zoom+(b||1),a)},zoomOut:function(b,a){return this.setZoom(this._zoom-(b||1),a)},setZoomAround:function(h,f,e){var g=this.getZoomScale(f),d=this.getSize().divideBy(2),c=h instanceof DCI.Point?h:this.latLngToContainerPoint(h),a=c.subtract(d).multiplyBy(1-1/g),b=this.containerPointToLatLng(d.add(a));return this.setView(b,f,{zoom:e})},fitBounds:function(b,k){k=k||{};b=b.getBounds?b.getBounds():DCI.latLngBounds(b);var d=DCI.point(k.paddingTopLeft||k.padding||[0,0]),c=DCI.point(k.paddingBottomRight||k.padding||[0,0]),h=this.getBoundsZoom(b,false,d.add(c)),f=c.subtract(d).divideBy(2),g=this.project(b.getSouthWest(),h),e=this.project(b.getNorthEast(),h),a=this.unproject(g.add(e).divideBy(2).add(f),h);h=k&&k.maxZoom?Math.min(k.maxZoom,h):h;return this.setView(a,h,k)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){this.fire("movestart");this._rawPanBy(DCI.point(a));this.fire("move");return this.fire("moveend")},setMaxBounds:function(a){a=DCI.latLngBounds(a);this.options.maxBounds=a;if(!a){return this.off("moveend",this._panInsideMaxBounds,this)}if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(d,c){var a=this.getCenter(),b=this._limitCenter(a,this._zoom,d);if(a.equals(b)){return this}return this.panTo(b,c)},addLayer:function(a){var b=DCI.stamp(a);if(this._layers[b]){return this}this._layers[b]=a;if(a.options&&(!isNaN(a.options.maxZoom)||!isNaN(a.options.minZoom))){this._zoomBoundLayers[b]=a;this._updateZoomLevels()}if(this.options.zoomAnimation&&DCI.TileLayer&&(a instanceof DCI.TileLayer)){this._tileLayersNum++;this._tileLayersToLoad++;a.on("load",this._onTileLayerLoad,this)}if(this._loaded){this._layerAdd(a)}return this},removeLayer:function(a){var b=DCI.stamp(a);if(!this._layers[b]){return this}if(this._loaded){a.onRemove(this)}delete this._layers[b];if(this._loaded){this.fire("layerremove",{layer:a})}if(this._zoomBoundLayers[b]){delete this._zoomBoundLayers[b];this._updateZoomLevels()}if(this.options.zoomAnimation&&DCI.TileLayer&&(a instanceof DCI.TileLayer)){this._tileLayersNum--;this._tileLayersToLoad--;a.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(a){if(!a){return false}return(DCI.stamp(a) in this._layers)},eachLayer:function(c,b){for(var a in this._layers){c.call(b,this._layers[a])}return this},invalidateSize:function(c){if(!this._loaded){return this}c=DCI.extend({animate:false,pan:true},c===true?{animate:true}:c);var d=this.getSize();this._sizeChanged=true;this._initialCenter=null;var b=this.getSize(),f=d.divideBy(2).round(),a=b.divideBy(2).round(),e=f.subtract(a);if(!e.x&&!e.y){return this}if(c.animate&&c.pan){this.panBy(e)}else{if(c.pan){this._rawPanBy(e)}this.fire("move");if(c.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(DCI.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:d,newSize:b})},addHandler:function(a,c){if(!c){return this}var b=this[a]=new c(this);this._handlers.push(b);if(this.options[a]){b.enable()}return this},remove:function(){if(this._loaded){this.fire("unload")}this._initEvents("off");try{delete this._container._dci}catch(a){this._container._dci=undefined}this._clearPanes();if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();if(this._initialCenter&&!this._moved()){return this._initialCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var b=this.getPixelBounds(),a=this.unproject(b.getBottomLeft()),c=this.unproject(b.getTopRight());return new DCI.LatLngBounds(a,c)},getMinZoom:function(){return this.options.minZoom===undefined?(this._layersMinZoom===undefined?0:this._layersMinZoom):this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?(this._layersMaxZoom===undefined?Infinity:this._layersMaxZoom):this.options.maxZoom},getBoundsZoom:function(a,b,f){a=DCI.latLngBounds(a);var h=this.getMinZoom()-(b?1:0),g=this.getMaxZoom(),l=this.getSize(),d=a.getNorthWest(),e=a.getSouthEast(),c=true,k;f=DCI.point(f||[0,0]);do{h++;k=this.project(e,h).subtract(this.project(d,h)).add(f);c=!b?l.contains(k):k.x<l.x||k.y<l.y}while(c&&h<=g);if(c&&b){return null}return b?h:h-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new DCI.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new DCI.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},setContainerSize:function(b,a){this._size=new DCI.Point(b,a)},getZoomScale:function(b){var a=this.options.crs;return a.scale(b)/a.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+(Math.log(a)/Math.LN2)},project:function(b,a){a=a===undefined?this._zoom:a;if(this.options.WMTS){return this.options.crs.latLngToPoint(DCI.latLng(b),a,this.options)}return this.options.crs.latLngToPoint(DCI.latLng(b),a)},unproject:function(a,b){b=b===undefined?this._zoom:b;return this.options.crs.pointToLatLng(DCI.point(a),b)},layerPointToLatLng:function(a){var b=DCI.point(a).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(b){var a=this.project(DCI.latLng(b))._round();return a._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return DCI.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return DCI.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var b=this.containerPointToLayerPoint(DCI.point(a));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(DCI.latLng(a)))},mouseEventToContainerPoint:function(a){return DCI.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(b){var a=this._container=DCI.DomUtil.get(b);if(!a){throw new Error("Map container not found.")}else{if(a._dci){throw new Error("Map container is already initialized.")}}a._dci=true;nodeImageDIV=document.createElement("div");nodeImageDIV.name="nodeImageDIV";nodeImageDIV.id="nodeImageDIV";this._container.appendChild(nodeImageDIV)},_initLayout:function(){var b=this._container;DCI.DomUtil.addClass(b,"dci-container"+(DCI.Browser.touch?" dci-touch":"")+(DCI.Browser.retina?" dci-retina":"")+(DCI.Browser.ielt9?" dci-oldie":"")+(this.options.fadeAnimation?" dci-fade-anim":""));var a=DCI.DomUtil.getStyle(b,"position");if(a!=="absolute"&&a!=="relative"&&a!=="fixed"){b.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var b=this._panes={};this._mapPane=b.mapPane=this._createPane("dci-map-pane",this._container);this._tilePane=b.tilePane=this._createPane("dci-tile-pane",this._mapPane);b.objectsPane=this._createPane("dci-objects-pane",this._mapPane);b.shadowPane=this._createPane("dci-shadow-pane");b.overlayPane=this._createPane("dci-overlay-pane");b.markerPane=this._createPane("dci-marker-pane");b.popupPane=this._createPane("dci-popup-pane");var a=" dci-zoom-hide";if(!this.options.markerZoomAnimation){DCI.DomUtil.addClass(b.markerPane,a);DCI.DomUtil.addClass(b.shadowPane,a);DCI.DomUtil.addClass(b.popupPane,a)}},_createPane:function(b,a){return DCI.DomUtil.create("div",b,a||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(c){c=c?(DCI.Util.isArray(c)?c:[c]):[];for(var b=0,a=c.length;b<a;b++){this.addLayer(c[b])}},_resetView:function(c,e,b,d){var a=(this._zoom!==e);if(!d){this.fire("movestart");if(a){this.fire("zoomstart")}}this._zoom=e;this._initialCenter=c;this._initialTopLeftPoint=this._getNewTopLeftPoint(c);if(!b){DCI.DomUtil.setPosition(this._mapPane,new DCI.Point(0,0))}else{this._initialTopLeftPoint._add(this._getMapPanePos())}this._tileLayersToLoad=this._tileLayersNum;var f=!this._loaded;this._loaded=true;this.fire("viewreset",{hard:!b});if(f){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("move");if(a||d){this.fire("zoomend")}this.fire("moveend",{hard:!b})},_rawPanBy:function(a){DCI.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var c,e=Infinity,a=-Infinity,d=this._getZoomSpan();for(c in this._zoomBoundLayers){var b=this._zoomBoundLayers[c];if(!isNaN(b.options.minZoom)){e=Math.min(e,b.options.minZoom)}if(!isNaN(b.options.maxZoom)){a=Math.max(a,b.options.maxZoom)}}if(c===undefined){this._layersMaxZoom=this._layersMinZoom=undefined}else{this._layersMaxZoom=a;this._layersMinZoom=e}if(d!==this._getZoomSpan()){this.fire("zoomlevelschange")}},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(b){if(!DCI.DomEvent){return}b=b||"on";DCI.DomEvent[b](this._container,"click",this._onMouseClick,this);var d=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu","touchstart","touchend","touchmove"],c,a;for(c=0,a=d.length;c<a;c++){DCI.DomEvent[b](this._container,d[c],this._fireMouseEvent,this)}if(this.options.trackResize){DCI.DomEvent[b](window,"resize",this._onResize,this)}},_onResize:function(){DCI.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=DCI.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this,false,this._container)},_onMouseClick:function(a){if(!this._loaded||(!a._simulated&&((this.dragging&&this.dragging.moved())||(this.boxZoom&&this.boxZoom.moved())))||DCI.DomEvent._skipped(a)){return}this.fire("preclick");this._fireMouseEvent(a)},_fireMouseEvent:function(d){if(!this._loaded||DCI.DomEvent._skipped(d)){return}var c=d.type;c=(c==="mouseenter"?"mouseover":(c==="mouseleave"?"mouseout":c));if(!this.hasEventListeners(c)){return}if(c==="contextmenu"){DCI.DomEvent.preventDefault(d)}var b=this.mouseEventToContainerPoint(d),a=this.containerPointToLayerPoint(b),f=this.layerPointToLatLng(a);this.fire(c,{latlng:f,layerPoint:a,containerPoint:b,originalEvent:d})},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad){this.fire("tilelayersload")}},_clearHandlers:function(){for(var b=0,a=this._handlers.length;b<a;b++){this._handlers[b].disable()}},whenReady:function(b,a){if(this._loaded){b.call(a||this,this)}else{this.on("load",b,a)}return this},_layerAdd:function(a){a.onAdd(this);this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return DCI.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,c){var b=this.getSize()._divideBy(2);return this.project(a,c)._subtract(b)._round()},_latLngToNewLayerPoint:function(d,b,a){var c=this._getNewTopLeftPoint(a,b).add(this._getMapPanePos());return this.project(d,b)._subtract(c)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,d,c){if(!c){return a}var g=this.project(a,d),b=this.getSize().divideBy(2),e=new DCI.Bounds(g.subtract(b),g.add(b)),f=this._getBoundsOffset(e,c,d);return this.unproject(g.add(f),d)},_limitOffset:function(d,a){if(!a){return d}var c=this.getPixelBounds(),b=new DCI.Bounds(c.min.add(d),c.max.add(d));return d.add(this._getBoundsOffset(b,a))},_getBoundsOffset:function(d,b,f){var e=this.project(b.getNorthWest(),f).subtract(d.min),g=this.project(b.getSouthEast(),f).subtract(d.max),c=this._rebound(e.x,-g.x),a=this._rebound(e.y,-g.y);return new DCI.Point(c,a)},_rebound:function(b,a){return b+a>0?Math.round(b-a)/2:Math.max(0,Math.ceil(b))-Math.max(0,Math.floor(a))},_limitZoom:function(c){var b=this.getMinZoom(),a=this.getMaxZoom();return Math.max(b,Math.min(a,c))},minBox:function(b){var c,k,o,d;if(b instanceof Array){b=b.join(",")}var m=b.split(",");for(var h=0;h<m.length;h++){var e=m[h];if(!e){alert("调用Map.minBox时出错，坐标中出现空值，将检查latlngs数组或者字符串");return}var f=Number(e);if(h%2==1){c?(c>=f?c=f:null):c=f;k?(k<=f?k=f:null):k=f}else{o?(o>=f?o=f:null):o=f;d?(d<=f?d=f:null):d=f}}var n=new DCI.latLng(c,o);var g=new DCI.latLng(k,d);if(n&&g){return new DCI.latLngBounds(n,g)}},calcSpanScale:function(e){var f=e.getSouthWest();var d=e.getNorthEast();f=this.options.crs.latLngToPoint(f,this.getZoom());d=this.options.crs.latLngToPoint(d,this.getZoom());var a=new DCI.bounds(f,d);var h=this.getSize();var c=(a.max.x-a.min.x)/h.x;var g=(a.min.y-a.max.y)/h.y;var b=Math.max(c,g);return b},coordConvert:function(c,d,a,f){if(a==f){alert("当前方向和转换目标方向相同");return}var e=function(){this.x=0;this.y=0};e.x=d.lng;e.y=d.lat;var b=null;switch(a){case 45:b=this.DongBei(c,f,e);break;case 135:b=this.DongNan(c,f,e);break;case 225:b=this.XiNan(c,f,e);break;case 315:b=this.XiBei(c,f,e);break}b=new DCI.point(b.x,b.y);return b},OffsetXY:function(b){var a={x:0,y:0};switch(b){case 45:a.x=369183.124;a.y=24508.143;break;case 135:a.x=1081624.507;a.y=246139.8;break;case 225:a.x=638361.211;a.y=602360.532;break;case 315:a.x=-74080.302;a.y=380728.896;break;default:a.x=0;a.y=0;break}return a},DongBei:function(f,b,c){var l=c.x;var g=c.y;var e=0;var d=0;var k=45;var a=-30;var h=this.OffsetXY(k);var m=null;switch(f){case -1:m=this.To25(l,g,e,k,a,h.x,h.y);break;case 0:var n=this.OffsetXY(b);m=this.To2(l,g,e,k,a,d,h.x,h.y);m=this.To25(m.x,m.y,e,b,a,n.x,n.y);break;case 1:m=this.To2(l,g,e,k,a,d,h.x,h.y);break;default:m.x=l;m.y=g;break}return m},DongNan:function(f,b,c){var l=c.x;var g=c.y;var e=0;var d=0;var k=135;var a=-30;var h=this.OffsetXY(k);var m=null;switch(f){case -1:m=this.To25(l,g,e,k,a,h.x,h.y);break;case 0:var n=this.OffsetXY(b);m=this.To2(l,g,e,k,a,d,h.x,h.y);m=this.To25(m.x,m.y,e,b,a,n.x,n.y);break;case 1:m=this.To2(l,g,e,k,a,d,h.x,h.y);break;default:m.x=l;m.y=g;break}return m},XiNan:function(f,b,c){var l=c.x;var g=c.y;var e=0;var d=0;var k=225;var a=-30;var h=this.OffsetXY(k);var m=null;switch(f){case -1:m=this.To25(l,g,e,k,a,h.x,h.y);break;case 0:var n=this.OffsetXY(b);m=this.To2(l,g,e,k,a,d,h.x,h.y);m=this.To25(m.x,m.y,e,b,a,n.x,n.y);break;case 1:m=this.To2(l,g,e,k,a,d,h.x,h.y);break;default:m.x=l;m.y=g;break}return m},XiBei:function(f,b,c){var l=c.x;var g=c.y;var e=0;var d=0;var k=315;var a=-30;var h=this.OffsetXY(k);var m=null;switch(f){case -1:m=this.To25(l,g,e,k,a,h.x,h.y);break;case 0:var n=this.OffsetXY(b);m=this.To2(l,g,e,k,a,d,h.x,h.y);m=this.To25(m.x,m.y,e,b,a,n.x,n.y);break;case 1:m=this.To2(l,g,e,k,a,d,h.x,h.y);break;default:m.x=l;m.y=g;break}return m},getMat:function(c,b,a){switch(c){case 45:if(a==true){_45_3_2Mat={m11:0.707106781186547,m12:0.353553390593274,m13:-0.612372435695795,m14:0,m21:-0.707106781186548,m22:0.353553390593274,m23:-0.612372435695794,m24:0,m31:0,m32:0.866025403784439,m33:0.5,m34:0,m41:0,m42:-0,m43:0,m44:1};return _45_3_2Mat}else{_45_2_3Mat={m11:0.707106781186548,m12:-0.707106781186548,m13:0,m14:0,m21:0.353553390593274,m22:0.353553390593274,m23:0.866025403784439,m24:0,m31:-0.612372435695795,m32:-0.612372435695795,m33:0.5,m34:0,m41:-0,m42:0,m43:-0,m44:1};return _45_2_3Mat}break;case 135:if(a==true){_135_3_2Mat={m11:-0.707106781186547,m12:0.353553390593274,m13:-0.612372435695795,m14:0,m21:-0.707106781186548,m22:-0.353553390593274,m23:0.612372435695794,m24:0,m31:0,m32:0.866025403784439,m33:0.5,m34:0,m41:0,m42:0,m43:0,m44:1};return _135_3_2Mat}else{_135_2_3Mat={m11:-0.707106781186547,m12:-0.707106781186548,m13:0,m14:0,m21:0.353553390593274,m22:-0.353553390593274,m23:0.866025403784439,m24:0,m31:-0.612372435695795,m32:0.612372435695794,m33:0.5,m34:0,m41:-0,m42:-0,m43:-0,m44:1};return _135_2_3Mat}break;case 225:if(a==true){_225_3_2Mat={m11:-0.707106781186548,m12:-0.353553390593274,m13:0.612372435695795,m14:0,m21:0.707106781186548,m22:-0.353553390593274,m23:0.612372435695795,m24:0,m31:0,m32:0.866025403784439,m33:0.5,m34:0,m41:-0,m42:0,m43:-0,m44:1};return _225_3_2Mat}else{_225_2_3Mat={m11:-0.707106781186548,m12:0.707106781186548,m13:0,m14:0,m21:-0.353553390593274,m22:-0.353553390593274,m23:0.866025403784439,m24:0,m31:0.612372435695795,m32:0.612372435695795,m33:0.5,m34:0,m41:-0,m42:0,m43:-0,m44:1};return _225_2_3Mat}break;case 315:if(a==true){_315_3_2Mat={m11:0.707106781186547,m12:-0.353553390593274,m13:0.612372435695795,m14:0,m21:0.707106781186548,m22:0.353553390593274,m23:-0.612372435695794,m24:0,m31:0,m32:0.866025403784439,m33:0.5,m34:0,m41:0,m42:0,m43:0,m44:1};return _315_3_2Mat}else{_315_2_3Mat={m11:0.707106781186547,m12:0.707106781186548,m13:0,m14:0,m21:-0.353553390593274,m22:0.353553390593274,m23:0.866025403784439,m24:0,m31:0.612372435695795,m32:-0.612372435695794,m33:0.5,m34:0,m41:-0,m42:-0,m43:-0,m44:1};return _315_2_3Mat}break}},To25:function(h,f,e,g,a,c,b){var k=this.getMat(g,a,true);var d={x:0,y:0,z:0};d.x=h*k.m11+f*k.m21+e*k.m31+k.m41+c;d.y=h*k.m12+f*k.m22+e*k.m32+k.m42+b;d.z=0;return d},To2:function(m,h,g,l,a,e,d,b){m=m-d;h=h-b;var n=this.getMat(l,a,false);var k={x:0,y:0,z:0};k.x=m*n.m11+h*n.m21+0*n.m31+n.m41;k.y=m*n.m12+h*n.m22+0*n.m32+n.m42;k.z=m*n.m13+h*n.m23+0*n.m33+n.m43;var c={x:0,y:0,z:0};c.x=Math.sin(l*Math.PI/180);c.y=Math.cos(l*Math.PI/180);c.z=Math.tan(a*Math.PI/180);var f={x:c.x/Math.sqrt((c.x*c.x)+(c.y*c.y)+(c.z*c.z)),y:c.y/Math.sqrt((c.x*c.x)+(c.y*c.y)+(c.z*c.z)),z:c.z/Math.sqrt((c.x*c.x)+(c.y*c.y)+(c.z*c.z))};var o=(e-k.z)/f.z;k.x=k.x+f.x*o;k.y=k.y+f.y*o;k.z=e;return k}});DCI.map=function(b,a){return new DCI.Map(b,a)};DCI.Drawer=DCI.Class.extend({initialize:function(a){this._map=a;$thisDrawer=this},stopDrawer:function(){if(this.drawer=="polyline"){this._map.off("mousedown",this.mousedown_polyline);this._map.off("mousemove",this.mousemove_polyline);this._map.off("dblclick",this.dbclick_polyline)}else{if(this.drawer=="polygon"){this._map.off("mousedown",this.mousedown_polygon);this._map.off("mousemove",this.mousemove_polygon);this._map.off("dblclick",this.dbclick_polygon)}else{if(this.drawer=="rectangle"){this._map.off("mousedown",this.mousedown_rect);this._map.off("mousemove",this.mousemove_rect);this._map.off("mouseup",this.mouseup_rect);this._map.dragging.enable()}else{if(this.drawer=="circle"){this._map.off("mousedown",this.mousedown_circle);this._map.off("mousemove",this.mousemove_circle);this._map.off("mouseup",this.mouseup_circle);this._map.dragging.enable()}}}}},getGraphic:function(){return this.path},drawPolyline:function(){this.dclick=false;this.path=null;this.pDragPoint=null;this.rubberlineGraph=null;this.coord=new Array();this.drawer="polyline";var a=DCI.Browser.mobile;if(a){this._map.on("click",this.mousedown_polyline)}else{this._map.on("mousedown",this.mousedown_polyline);this._map.on("dblclick",this.dbclick_polyline)}},drawPolygon:function(){this.dclick=false;this.path=null;this.firstPoint=null;this.pDragPoint=null;this.rubberPolygonGraph=null;this.coord=new Array();this.drawer="polygon";this.eventtype=0;var a=DCI.Browser.mobile;if(a){this._map.on("click",this.mousedown_polygon)}else{this._map.on("mousedown",this.mousedown_polygon);this._map.on("dblclick",this.dbclick_polygon)}},drawRect:function(c){this.firstPoint=null;this.path=null;this.down=false;this.callback=c;this.drawer="rectangle";var a=DCI.Browser.mobile;if(a){var b=this;this._map.on("click",function(d){if($thisDrawer.path==null){b.mousedown_rect(d)}else{b.mouseup_rect(d)}})}else{this._map.on("mousedown",this.mousedown_rect);this._map.on("mousemove",this.mousemove_rect);this._map.on("mouseup",this.mouseup_rect)}this._map.dragging.disable()},drawCircle:function(){this.firstPoint=null;this.center=null;this.path=null;this.down=false;this.drawer="circle";var a=DCI.Browser.mobile;if(a){var b=this;this._map.on("click",function(c){if($thisDrawer.path==null){b.mousedown_circle(c)}else{b.mouseup_circle(c)}})}else{this._map.on("mousedown",this.mousedown_circle);this._map.on("mousemove",this.mousemove_circle);this._map.on("mouseup",this.mouseup_circle)}this._map.dragging.disable()},mousedown_polyline:function(a){if($thisDrawer.dclick){$thisDrawer.dclick=false}$thisDrawer.pDragPoint=a.latlng;$thisDrawer.coord.push($thisDrawer.pDragPoint);if(!$thisDrawer.rubberlineGraph){$thisDrawer.rubberlineGraph=new DCI.Polyline([$thisDrawer.pDragPoint,$thisDrawer.pDragPoint],{weight:3,opacity:0.8,dashArray:[5,5]});$thisDrawer._map.addLayer($thisDrawer.rubberlineGraph);$thisDrawer._map.on("mousemove",$thisDrawer.mousemove_polyline);$thisDrawer._map.doubleClickZoom.disable()}if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer._map.removeLayer($thisDrawer.rubberlineGraph)}$thisDrawer.path=new DCI.Polyline($thisDrawer.coord,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path)},dbclick_polyline:function(b){var a=3;if(DCI.Browser.ie){var c=DCI.Browser.getIEVersion();if(c<9){a=2}}if($thisDrawer.coord.length<a){DCI.popup().setLatLng(b.latlng).setContent("画线不能少于2个点").openOn($thisDrawer._map);$thisDrawer.overDraw=false;return}$thisDrawer.overDraw=true;if(a==3){$thisDrawer.coord.pop()}if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer._map.removeLayer($thisDrawer.rubberlineGraph)}$thisDrawer.path=new DCI.Polyline($thisDrawer.coord,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path);$thisDrawer.coord=null;$thisDrawer.coord=new Array();$thisDrawer.dclick=true;$thisDrawer.rubberlineGraph=null;$thisDrawer._map.off("mousemove",$thisDrawer.mousemove_polyline)},mousemove_polyline:function(a){if($thisDrawer.dclick){return}var b=a.latlng;if($thisDrawer.rubberlineGraph&&$thisDrawer.coord.length>0){$thisDrawer._map.removeLayer($thisDrawer.rubberlineGraph);$thisDrawer.rubberlineGraph=null;$thisDrawer.rubberlineGraph=new DCI.Polyline([$thisDrawer.pDragPoint,b],{weight:3,opacity:0.8,dashArray:[5,5]});$thisDrawer._map.addLayer($thisDrawer.rubberlineGraph)}},mousedown_polygon:function(a){$thisDrawer.eventtype++;if($thisDrawer.dclick){$thisDrawer.dclick=false}$thisDrawer.pDragPoint=a.latlng;$thisDrawer.coord.push($thisDrawer.pDragPoint);if(!$thisDrawer.rubberPolygonGraph){$thisDrawer.firstPoint=$thisDrawer.pDragPoint;$thisDrawer.rubberPolygonGraph=new DCI.Polygon([$thisDrawer.pDragPoint,$thisDrawer.pDragPoint],{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.rubberPolygonGraph);$thisDrawer._map.on("mousemove",$thisDrawer.mousemove_polygon);$thisDrawer._map.doubleClickZoom.disable()}if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer._map.removeLayer($thisDrawer.rubberPolygonGraph)}$thisDrawer.path=new DCI.Polygon($thisDrawer.coord,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path)},dbclick_polygon:function(b){var a=4;if(DCI.Browser.ie){var c=DCI.Browser.getIEVersion();if(c<9){a=3}}if($thisDrawer.coord.length<a){DCI.popup().setLatLng(b.latlng).setContent("画多边形不能少于3个点").openOn($thisDrawer._map);$thisDrawer.overDraw=false;return}$thisDrawer.overDraw=true;if(a==4){$thisDrawer.coord.pop()}if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer._map.removeLayer($thisDrawer.rubberPolygonGraph)}$thisDrawer.path=new DCI.Polygon($thisDrawer.coord,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path);$thisDrawer.dclick=true;$thisDrawer.coord=null;$thisDrawer.coord=new Array();$thisDrawer.rubberPolygonGraph=null;$thisDrawer._map.off("mousemove",$thisDrawer.mousemove_polygon);DCI.DomEvent.stop(b)},mousemove_polygon:function(a){if($thisDrawer.dclick){return}var b=a.latlng;if($thisDrawer.rubberPolygonGraph&&$thisDrawer.coord.length>0){$thisDrawer._map.removeLayer($thisDrawer.rubberPolygonGraph);$thisDrawer.rubberPolygonGraph=null;$thisDrawer.rubberPolygonGraph=new DCI.Polyline([$thisDrawer.pDragPoint,b,$thisDrawer.firstPoint],{weight:3,opacity:0.8,dashArray:[5,5]});$thisDrawer._map.addLayer($thisDrawer.rubberPolygonGraph)}},mousedown_rect:function(b){if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path)}$thisDrawer.firstPoint=b.latlng;var a=new DCI.LatLngBounds($thisDrawer.firstPoint,$thisDrawer.firstPoint);$thisDrawer.path=new DCI.Rectangle(a,{weight:3,opacity:0.8});$thisDrawer.down=true},mouseup_rect:function(b){if(!$thisDrawer.down){return}var c=b.latlng;if($thisDrawer.firstPoint&&c!=$thisDrawer.firstPoint){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer.path=null;var a=new DCI.LatLngBounds($thisDrawer.firstPoint,c);$thisDrawer.path=new DCI.Rectangle(a,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path)}if($thisDrawer.callback){$thisDrawer.callback($thisDrawer.firstPoint,c);$thisDrawer._map.removeLayer($thisDrawer.path)}else{}$thisDrawer.firstPoint=null;$thisDrawer.down=false},mousemove_rect:function(b){var c=b.latlng;if($thisDrawer.down&&$thisDrawer.path&&$thisDrawer.firstPoint&&c!=$thisDrawer.firstPoint){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer.path=null;var a=new DCI.LatLngBounds($thisDrawer.firstPoint,c);$thisDrawer.path=new DCI.Rectangle(a,{weight:3,opacity:0.8});$thisDrawer._map.addLayer($thisDrawer.path)}},mousedown_circle:function(b){if($thisDrawer.path){$thisDrawer._map.removeLayer($thisDrawer.path)}var c=b.latlng;$thisDrawer.down=true;$thisDrawer.ct=new DCI.LatLng(c.lng,c.lat);var a={weight:3,opacity:0.8};if($thisDrawer._map.options.crs.code=="EPSG:990001"){$thisDrawer.firstPoint=new DCI.point([c.lng,c.lat])}else{$thisDrawer.firstPoint=c.clone()}$thisDrawer.path=new DCI.circle($thisDrawer.ct,0,a)},mouseup_circle:function(b){var c=b.latlng;if($thisDrawer.firstPoint&&c!=$thisDrawer.ct){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer.path=null;var a={weight:3,opacity:0.8};if($thisDrawer._map.options.crs.code=="EPSG:990001"){c=new DCI.point([c.lng,c.lat])}$thisDrawer.path=new DCI.circle($thisDrawer.ct,$thisDrawer.firstPoint.distanceTo(c),a);$thisDrawer._map.addLayer($thisDrawer.path)}$thisDrawer.firstPoint=null;$thisDrawer.down=false},mousemove_circle:function(b){var c=b.latlng;if($thisDrawer.down&&$thisDrawer.path&&$thisDrawer.firstPoint&&c!=$thisDrawer.ct){$thisDrawer._map.removeLayer($thisDrawer.path);$thisDrawer.path=null;var a={weight:3,opacity:0.8};if($thisDrawer._map.options.crs.code=="EPSG:990001"){c=new DCI.point([c.lng,c.lat])}$thisDrawer.path=new DCI.circle($thisDrawer.ct,$thisDrawer.firstPoint.distanceTo(c),a);$thisDrawer._map.addLayer($thisDrawer.path)}}});DCI.drawer=function(a){return new DCI.Drawer(a)};DCI.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(c){var k=DCI.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,l=Math.max(Math.min(n,c.lat),-n),a=this.R_MAJOR,e=this.R_MINOR,o=c.lng*k*a,m=l*k,g=e/a,f=Math.sqrt(1-g*g),b=f*Math.sin(m);b=Math.pow((1-b)/(1+b),f*0.5);var h=Math.tan(0.5*((Math.PI*0.5)-m))/b;m=-a*Math.log(h);return new DCI.Point(o,m)},unproject:function(p){var m=DCI.LatLng.RAD_TO_DEG,a=this.R_MAJOR,c=this.R_MINOR,o=p.x*m/a,h=c/a,e=Math.sqrt(1-(h*h)),n=Math.exp(-p.y/a),l=(Math.PI/2)-2*Math.atan(n),f=15,q=1e-7,g=f,k=0.1,b;while((Math.abs(k)>q)&&(--g>0)){b=e*Math.sin(l);k=(Math.PI/2)-2*Math.atan(n*Math.pow((1-b)/(1+b),0.5*e))-l;l+=k}return new DCI.LatLng(o,l*m)}};DCI.CRS.EPSG3395=DCI.extend({},DCI.CRS,{code:"EPSG:3395",projection:DCI.Projection.Mercator,transformation:(function(){var a=DCI.Projection.Mercator,b=a.R_MAJOR,c=0.5/(Math.PI*b);return new DCI.Transformation(c,0.5,-c,0.5)}())});DCI.CRS.EPSG990001=DCI.extend({},DCI.CRS,{code:"EPSG:990001",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1,0,-1,688194),scale:function(a){return Math.pow(2,a)/896.0859375}});DCI.CRS.EPSG990002=DCI.extend({},DCI.CRS,{code:"EPSG:990002",projection:DCI.Projection.SphericalMercator,transformation:new DCI.Transformation(0.5/Math.PI,0,-0.5/Math.PI,0.183174871),project:function(c){var b=this.projection.project(c),a=6378137;return b.multiplyBy(a)},scale:function(a){return 256*Math.pow(2,a)*174.6964519}});DCI.CRS.EPSG990003=DCI.extend({},DCI.CRS,{code:"EPSG:990003",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1,0,-1,688194),scale:function(a){return Math.pow(2,a)/resolution_990003},latLngToPoint:function(e,c,b){var a=this.projection.project(e),d=this.scale(c);this.transformation=new DCI.Transformation(b.X990003,b.WMTS_XOrigin,b.Y990003,b.WMTS_YOrigin);return this.transformation._transform(a,d)}});DCI.CRS.EPSG990004=DCI.extend({},DCI.CRS,{code:"EPSG:990004",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1,24851732.2180885,1.0062367,18820520.133765),scale:function(a){return Math.pow(2,a)/120296.6734496}});DCI.CRS.EPSG990005=DCI.extend({},DCI.CRS,{code:"EPSG:990005",projection:DCI.Projection.LonLat,transformation:new DCI.Transformation(1,20037508.3427892,-1,20037508.3427892),scale:function(a){return Math.pow(2,a)/48617.258408333335}});DCI.TileLayer=DCI.Class.extend({includes:DCI.Mixin.Events,options:{direction:0,fxnum:315,_type:"0",minZoom:0,maxZoom:12,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,rowOffset:0,continuousWorld:true,unloadInvisibleTiles:DCI.Browser.mobile,updateWhenIdle:DCI.Browser.mobile},initialize:function(c,b,d){b=DCI.setOptions(this,b);if(d!=null){b._type=d}var e=this.options._type;if(e==="0"){this.options.fxnum=315}else{if(e==="xibei"){this.options.fxnum=315}else{if(e==="dongbei"){this.options.fxnum=45}else{if(e==="dongnan"){this.options.fxnum=135}else{if(e==="xinan"){this.options.fxnum=225}}}}}if(b.detectRetina&&DCI.Browser.retina&&b.maxZoom>0){b.tileSize=Math.floor(b.tileSize/2);b.zoomOffset++;if(b.minZoom>0){b.minZoom--}this.options.maxZoom--}if(b.bounds){b.bounds=DCI.latLngBounds(b.bounds)}this._url=c;var a=this.options.subdomains;if(typeof a==="string"){this.options.subdomains=a.split("")}},onAdd:function(a){this._map=a;this._map.options.year=this.options.year;this._animated=a._zoomAnimated;this._initContainer();a.on({viewreset:this._reset,moveend:this._update},this);if(this._animated){a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){this._limitedUpdate=DCI.Util.limitExecByInterval(this._update,150,this);a.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(b){var a=this.options._type;if(a==="0"||a==null){b.addLayer(this)}else{b.addLayer(this);jzlayer=DCI.tileLayer("gov25d",null,a+"jianzhu");b.addLayer(jzlayer)}return this},onRemove:function(a){this.options._type="0";this._container.parentNode.removeChild(this._container);a.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){a.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;if(this._container){a.appendChild(this._container);this._setAutoZIndex(a,Math.max)}return this},bringToBack:function(){var a=this._map._panes.tilePane;if(this._container){a.insertBefore(this._container,a.firstChild);this._setAutoZIndex(a,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){this.options.opacity=a;if(this._map){this._updateOpacity()}return this},setZIndex:function(a){this.options.zIndex=a;this._updateZIndex();return this},setUrl:function(a,b){this._url=a;if(!b){this.redraw()}return this},redraw:function(){if(this._map){this._reset({hard:true});this._update()}return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(g,d){var e=g.children,c=-d(Infinity,-Infinity),f,b,a;for(b=0,a=e.length;b<a;b++){if(e[b]!==this._container){f=parseInt(e[b].style.zIndex,10);if(!isNaN(f)){c=d(c,f)}}}this.options.zIndex=this._container.style.zIndex=(isFinite(c)?c:0)+d(1,-1)},_updateOpacity:function(){var b,a=this._tiles;if(DCI.Browser.ielt9){for(b in a){DCI.DomUtil.setOpacity(a[b],this.options.opacity)}}else{DCI.DomUtil.setOpacity(this._container,this.options.opacity)}},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){this._container=DCI.DomUtil.create("div","dci-layer");var b=this.options._type;if(b.indexOf("jianzhu")>-1){this._container.style.zIndex=4}else{this._container.style.zIndex=1}this._updateZIndex();if(this._animated){var c="dci-tile-container";this._bgBuffer=DCI.DomUtil.create("div",c,this._container);this._tileContainer=DCI.DomUtil.create("div",c,this._container)}else{this._tileContainer=this._container}a.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(b){for(var a in this._tiles){this.fire("tileunload",{tile:this._tiles[a]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&b&&b.hard){this._clearBgBuffer()}this._initContainer()},_getTileSize:function(){var d=this._map,b=d.getZoom()+this.options.zoomOffset,a=this.options.maxNativeZoom,c=this.options.tileSize;if(a&&b>a){c=Math.round(d.getZoomScale(b)/d.getZoomScale(a)*c)}return c},_update:function(){if(!this._map){return}var e=this._map,b=e.getPixelBounds(),a=e.getZoom(),c=this._getTileSize();if(a>this.options.maxZoom||a<this.options.minZoom){return}var d=DCI.bounds(b.min.divideBy(c)._floor(),b.max.divideBy(c)._floor());this._addTilesFromCenterOut(d);if(this.options.unloadInvisibleTiles||this.options.reuseTiles){this._removeOtherTiles(d)}},_addTilesFromCenterOut:function(g){var c=[],b=g.getCenter();var e,f,a;for(e=g.min.y;e<=g.max.y;e++){for(f=g.min.x;f<=g.max.x;f++){a=new DCI.Point(f,e);if(this._tileShouldBeLoaded(a)){c.push(a)}}}var h=c.length;if(h===0){return}c.sort(function(l,k){return l.distanceTo(b)-k.distanceTo(b)});var d=document.createDocumentFragment();if(!this._tilesToLoad){this.fire("loading")}this._tilesToLoad+=h;for(f=0;f<h;f++){this._addTile(c[f],d)}this._tileContainer.appendChild(d)},_tileShouldBeLoaded:function(f){if((f.x+":"+f.y) in this._tiles){return false}var e=this.options;if(!e.continuousWorld){var c=this._getWrapTileNum();if((e.noWrap&&(f.x<0||f.x>=c.x))||f.y<0||f.y>=c.y){return false}}if(e.bounds){var h=e.tileSize,d=f.multiplyBy(h),a=d.add([h,h]),b=this._map.unproject(d),g=this._map.unproject(a);if(!e.continuousWorld&&!e.noWrap){b=b.wrap();g=g.wrap()}if(!e.bounds.intersects([b,g])){return false}}return true},_removeOtherTiles:function(d){var c,a,e,b;for(b in this._tiles){c=b.split(":");a=parseInt(c[0],10);e=parseInt(c[1],10);if(a<d.min.x||a>d.max.x||e<d.min.y||e>d.max.y){this._removeTile(b)}}},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src});if(this.options.reuseTiles){DCI.DomUtil.removeClass(b,"dci-tile-loaded");this._unusedTiles.push(b)}else{if(b.parentNode===this._tileContainer){this._tileContainer.removeChild(b)}}if(!DCI.Browser.android){b.onload=null;b.src=DCI.Util.emptyImageUrl}delete this._tiles[a]},_addTile:function(c,a){var b=this._getTilePos(c);var d=this._getTile();DCI.DomUtil.setPosition(d,b,DCI.Browser.chrome);this._tiles[c.x+":"+c.y]=d;this._loadTile(d,c);if(d.parentNode!==this._tileContainer){a.appendChild(d)}},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();if(a.zoomReverse){b=a.maxZoom-b}b+=a.zoomOffset;return a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getTilePos:function(b){var a=this._map.getPixelOrigin(),c=this._getTileSize();return b.multiplyBy(c).subtract(a)},getTileUrl:function(a){return DCI.Util.template(this._url,DCI.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y+this.options.rowOffset},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,b=a.getSize(this._map.getZoom());return b.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(b){var a=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap){b.x=((b.x%a.x)+a.x)%a.x}if(this.options.tms){b.y=a.y-b.y-1}b.z=this._getZoomForUrl()},_getSubdomain:function(b){var a=Math.abs(b.x+b.y)%this.options.subdomains.length;return this.options.subdomains[a]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();this._resetTile(a);return a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=DCI.DomUtil.create("img","dci-tile");a.style.width=a.style.height=this._getTileSize()+"px";a.galleryimg="no";a.onselectstart=a.onmousemove=DCI.Util.falseFn;if(DCI.Browser.ielt9&&this.options.opacity!==undefined){DCI.DomUtil.setOpacity(a,this.options.opacity)}if(DCI.Browser.mobileWebkit3d){a.style.WebkitBackfaceVisibility="hidden"}return a},_loadTile:function(b,a){b._layer=this;b.onload=this._tileOnLoad;b.onerror=this._tileOnError;this._adjustTilePoint(a);b.src=this.getTileUrl(a);this.fire("tileloadstart",{tile:b,url:b.src})},_tileLoaded:function(){this._tilesToLoad--;if(this._animated){DCI.DomUtil.addClass(this._tileContainer,"dci-zoom-animated")}if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(DCI.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var a=this._layer;if(this.src!==DCI.Util.emptyImageUrl){DCI.DomUtil.addClass(this,"dci-tile-loaded");a.fire("tileload",{tile:this,url:this.src})}a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;if(b){this.src=b}a._tileLoaded()}});DCI.tileLayer=function(c,b,e){var d=b==null||b==undefined?"2012":b.year||"2012";if(c=="pub"||c=="pub_Raster"||c=="pub_VR"||c=="pub_Tra"){d="2011"}if(c=="gov"||c=="gov_Sate"||c=="gov_Sate_Rv"||c=="gov_Tra"){b={continuousWorld:true,minZoom:0,maxZoom:12,rowOffset:1,year:d||"2012"}}else{if(c=="pub"||c=="pub_Raster"||c=="pub_VR"||c=="pub_Tra"){b={minZoom:1,maxZoom:10,subdomains:"01234",year:d||"2011"}}else{if(c=="gov25d"){b={continuousWorld:true,minZoom:0,maxZoom:12,rowOffset:1,year:"2014"}}}}if(c=="gov"){c="/"+_applicationName+"/ImageEngine?request=1&year="+b.year+"&type=Shiliang&level={z}&x={y}&y={x}"}else{if(c=="gov_Sate"){c="/"+_applicationName+"/ImageEngine?request=1&year="+b.year+"&type=Sate&level={z}&x={y}&y={x}"}else{if(c=="gov_Sate_Rv"){c="/"+_applicationName+"/ImageEngine?request=1&year="+b.year+"&type=Sate_Rv&level={z}&x={y}&y={x}"}else{if(c=="gov_Tra"){c="/"+_applicationName+"/TRAImage?request=1&year="+b.year+"&type=tra&level={z}&x={y}&y={x}&random="+Math.random();if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a==6){return new DCI.tileLayer.ie6(c,b)}}}else{if(c=="pub"){c="http://210.75.193.19{s}:8080/Vector_"+b.year+"_new/{z}/{x}/{y}.png"}else{if(c=="pub_Raster"){c="http://210.75.193.19{s}:8080/Raster_"+b.year+"_new/{z}/{x}/{y}.png"}else{if(c=="pub_VR"){c="http://210.75.193.19{s}:8080/VR_"+b.year+"_new/{z}/{x}/{y}.png"}else{if(c=="pub_Tra"){c="/"+_applicationName+"/TRAImage?request=1&year="+b.year+"&type=tra&level={z}&x={y}&y={x}&random="+Math.random()}else{if(c=="gov25d"){if(e.indexOf("jianzhu")>-1){c="/"+_applicationName+"/is25dImage?Service=get25dImage&request=1&year="+b.year+"&type="+e+"&level={z}&x={y}&y={x}"}else{c="/"+_applicationName+"/is25dImage?Service=get25dImage&request=1&year="+b.year+"&type="+e+"yingxiang&level={z}&x={y}&y={x}"}}}}}}}}}}return new DCI.TileLayer(c,b,e)};DCI.GovTraLayer=DCI.Class.extend({includes:DCI.Mixin.Events,options:{direction:0,minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,pzindex:3,unloadInvisibleTiles:DCI.Browser.mobile,updateWhenIdle:DCI.Browser.mobile},defaultWmsParams:{ServiceName:"IMAGESTAT",request:"getmap",version:"1.1.1",layers:"",styles:"",format:"png",TRANSPARENT:true,crs:""},initialize:function(c,b,f){this.options.direction=f;if(f!=0){switch(f){case 45:this.defaultWmsParams.layers="1";break;case 135:this.defaultWmsParams.layers="2";break;case 225:this.defaultWmsParams.layers="3";break;case 315:this.defaultWmsParams.layers="4";break}}this._url=c;var a=DCI.extend({},this.defaultWmsParams),e=b.tileSize||this.options.tileSize;if(b.detectRetina&&DCI.Browser.retina){a.width=a.height=e*2}else{a.width=a.height=e}for(var d in b){if(!this.options.hasOwnProperty(d)&&d!=="crs"){a[d]=b[d]}}this.wmsParams=a;DCI.setOptions(this,b)},onAdd:function(b){this._map=b;this._initContainer();if(this._animated){b.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}this._crs=this.options.crs||b.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var c=this._wmsVersion>=1.3?"crs":"srs";if(this._crs.code!=undefined){this.wmsParams[c]=this._crs.code}var a=b.getSize();this.wmsParams.width=a.x;this.wmsParams.height=a.y;this._map=b;b.on({viewreset:this._reset,moveend:this._update,zoomend:this._update},this);this._update()},_initContainer:function(){var a=this._map._panes.tilePane;this._animated=map._zoomAnimated;if(!this._container){this._container=DCI.DomUtil.create("div","dci-govTraLayer");this._container.style.zIndex=this.options.pzindex;this._updateZIndex();if(this._animated){var b="dci-wmsTile-container";this._bgBuffer=DCI.DomUtil.create("div",b,this._container);this._tileContainer=DCI.DomUtil.create("div",b,this._container)}else{this._tileContainer=this._container}a.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(b){for(var a in this._tiles){this.fire("tileunload",{tile:this._tiles[a]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&b&&b.hard){this._clearBgBuffer()}this._initContainer()},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined){this._container.style.zIndex=this.options.zIndex}},_update:function(){if(!this._map){return}var c=this._map,b=c.getPixelBounds();this._tileContainer.innerHTML="";var a=document.createDocumentFragment();this._addTile(b,a);this._tileContainer.appendChild(a)},_createTile:function(){var a=DCI.DomUtil.create("img","dci-wmsTile");a.style.width=this.wmsParams.width+"px";a.style.height=this.wmsParams.height+"px";a.galleryimg="no";a.onselectstart=a.onmousemove=DCI.Util.falseFn;if(DCI.Browser.ielt9&&this.options.opacity!==undefined){DCI.DomUtil.setOpacity(a,this.options.opacity)}if(DCI.Browser.mobileWebkit3d){a.style.WebkitBackfaceVisibility="hidden"}return a},_animateZoom:function(f){if(this._animated){DCI.DomUtil.addClass(this._tileContainer,"dci-zoom-animated")}var c=this._tileContainer,a=DCI.DomUtil.TRANSFORM,b=f.delta?DCI.DomUtil.getTranslateString(f.delta):c.style[a],d=DCI.DomUtil.getScaleString(f.scale,f.origin);c.style[a]=f.backwards?d+" "+b:b+" "+d},_endZoomAnim:function(){DCI.Util.falseFn(this._tileContainer.offsetWidth);this._tileContainer.style[DCI.DomUtil.TRANSFORM]=""},_addTile:function(e,a){var b=this._map.getPixelOrigin();var c=e.min.clone().subtract(b);var d=this._getTile();DCI.DomUtil.setPosition(d,c,DCI.Browser.chrome);this._loadTile(d,e);if(d.parentNode!==this._tileContainer){a.appendChild(d)}},_loadTile:function(b,a){b._layer=this;b.onload=this._tileOnLoad;b.onerror=this._tileOnError;b.src=this.getTileUrl(a);var c=this.options.direction;if(c!=0){switch(c){case 45:b.src+="&affine=0.7071067812,-0.7071067812,369183.124,0.3535533906,0.3535533906,24508.143,0.7071067812,1.414213562,-295711.6387,-0.7071067812,1.414213562,226392.1423";break;case 135:b.src+="&affine=-0.707106781186547,-0.707106781186548,1081624.507,0.353553390593274,-0.353553390593274,246139.8  ,-0.707106781186548,1.41421356237309,416729.780197455,-0.707106781186548,-1.41421356237309,1112918.26699706";break;case 225:b.src+="&affine=-0.707106781186548,0.707106781186548,638361.211,-0.353553390593274,-0.353553390593274,602360.532,-0.707106781186547,-1.41421356237309,1303255.97493723,0.707106781186547,-1.41421356237309,400476.892648116";break;case 315:b.src+="&affine=0.707106781186547,0.707106781186548,-74080.302,-0.353553390593274,0.353553390593274,380728.896,0.707106781186547,-1.4142135623731,590814.652207083,0.707106781186548,1.41421356237309,-486049.284413987";break}}this.fire("tileloadstart",{tile:b,url:b.src})},addTo:function(b){var a=this.options._type;if(a==="0"||a==null){b.addLayer(this)}else{b.addLayer(this)}return this},onRemove:function(a){this.options.direction=0;this._container.parentNode.removeChild(this._container);a.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){a.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},getTileUrl:function(b){var d=this._map;var c=d.getBounds();var a=c.getNorthWest();se=c.getSouthEast();bbox=this._wmsVersion>=1.3&&this._crs===DCI.CRS.EPSG4326?[se.lat,a.lng,a.lat,se.lng].join(","):[a.lng,se.lat,se.lng,a.lat].join(","),url=DCI.Util.template(this._url);return url+DCI.Util.getParamString(this.wmsParams,url,true)+"&BBOX="+bbox},_getTile:function(){return this._createTile()},redraw:function(){if(this._map){this._update()}return this},setParams:function(b,a){DCI.extend(this.wmsParams,b);if(!a){this.redraw()}return this}});DCI.govTraLayer=function(b,a,c){return new DCI.GovTraLayer(b,a,c)};DCI.WMSLayer=DCI.Class.extend({includes:DCI.Mixin.Events,options:{box:"",direction:0,minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,pzindex:1000,unloadInvisibleTiles:DCI.Browser.mobile,updateWhenIdle:DCI.Browser.mobile},defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false,crs:""},initialize:function(c,b,f){this.options.direction=f;this._url=c;var a=DCI.extend({},this.defaultWmsParams),e=b.tileSize||this.options.tileSize;if(b.detectRetina&&DCI.Browser.retina){a.width=a.height=e*2}else{a.width=a.height=e}for(var d in b){if(!this.options.hasOwnProperty(d)&&d!=="crs"){a[d]=b[d]}}this.wmsParams=a;DCI.setOptions(this,b)},onAdd:function(b){this._map=b;this._initContainer();if(this._animated){b.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}this._crs=this.options.crs||b.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var c=this._wmsVersion>=1.3?"crs":"srs";if(this._crs.code!=undefined){this.wmsParams[c]=this._crs.code}var a=b.getSize();this.wmsParams.width=a.x;this.wmsParams.height=a.y;this._map=b;b.on({viewreset:this._reset,moveend:this._update,zoomend:this._update},this);this._update()},_initContainer:function(){var a=this._map._panes.tilePane;this._animated=this._map._zoomAnimated;if(!this._container){this._container=DCI.DomUtil.create("div","dci-wmsLayer");this._container.style.zIndex=this.options.pzindex;this._updateZIndex();if(this._animated){var b="dci-wmsTile-container";this._bgBuffer=DCI.DomUtil.create("div",b,this._container);this._tileContainer=DCI.DomUtil.create("div",b,this._container)}else{this._tileContainer=this._container}a.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(b){for(var a in this._tiles){this.fire("tileunload",{tile:this._tiles[a]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&b&&b.hard){this._clearBgBuffer()}this._initContainer()},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined){this._container.style.zIndex=this.options.zIndex}},_update:function(){if(!this._map){return}var c=this._map,b=c.getPixelBounds();this._tileContainer.innerHTML="";var a=document.createDocumentFragment();this._addTile(b,a);this._tileContainer.appendChild(a)},_createTile:function(){var a=DCI.DomUtil.create("img","dci-wmsTile");a.style.width=this.wmsParams.width+"px";a.style.height=this.wmsParams.height+"px";a.galleryimg="no";a.onselectstart=a.onmousemove=DCI.Util.falseFn;if(DCI.Browser.ielt9&&this.options.opacity!==undefined){DCI.DomUtil.setOpacity(a,this.options.opacity)}if(DCI.Browser.mobileWebkit3d){a.style.WebkitBackfaceVisibility="hidden"}return a},_animateZoom:function(f){if(this._animated){DCI.DomUtil.addClass(this._tileContainer,"dci-zoom-animated")}var c=this._tileContainer,a=DCI.DomUtil.TRANSFORM,b=f.delta?DCI.DomUtil.getTranslateString(f.delta):c.style[a],d=DCI.DomUtil.getScaleString(f.scale,f.origin);c.style[a]=f.backwards?d+" "+b:b+" "+d},_endZoomAnim:function(){DCI.Util.falseFn(this._tileContainer.offsetWidth);this._tileContainer.style[DCI.DomUtil.TRANSFORM]=""},_addTile:function(e,a){var b=this._map.getPixelOrigin();var c=e.min.clone().subtract(b);var d=this._getTile();DCI.DomUtil.setPosition(d,c,DCI.Browser.chrome);this._loadTile(d,e);if(d.parentNode!==this._tileContainer){a.appendChild(d)}},_loadTile:function(b,a){b._layer=this;b.onload=this._tileOnLoad;b.onerror=this._tileOnError;b.src=this.getTileUrl(a);var c=this.options.direction;if(c!=0){switch(c){case 45:b.src+="&affine=0.7071067812,-0.7071067812,369183.124,0.3535533906,0.3535533906,24508.143,0.7071067812,1.414213562,-295711.6387,-0.7071067812,1.414213562,226392.1423";break;case 135:b.src+="&affine=-0.707106781186547,-0.707106781186548,1081624.507,0.353553390593274,-0.353553390593274,246139.8  ,-0.707106781186548,1.41421356237309,416729.780197455,-0.707106781186548,-1.41421356237309,1112918.26699706";break;case 225:b.src+="&affine=-0.707106781186548,0.707106781186548,638361.211,-0.353553390593274,-0.353553390593274,602360.532,-0.707106781186547,-1.41421356237309,1303255.97493723,0.707106781186547,-1.41421356237309,400476.892648116";break;case 315:b.src+="&affine=0.707106781186547,0.707106781186548,-74080.302,-0.353553390593274,0.353553390593274,380728.896,0.707106781186547,-1.4142135623731,590814.652207083,0.707106781186548,1.41421356237309,-486049.284413987";break}}this.fire("tileloadstart",{tile:b,url:b.src})},onRemove:function(a){this.options.direction=0;this._container.parentNode.removeChild(this._container);a.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){a.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},getTileUrl:function(b){var d=this._map;var c=d.getBounds();var a=c.getNorthWest();se=c.getSouthEast();bbox=this._wmsVersion>=1.3&&this._crs===DCI.CRS.EPSG4326?[se.lat,a.lng,a.lat,se.lng].join(","):[a.lng,se.lat,se.lng,a.lat].join(","),url=DCI.Util.template(this._url);if(!this.options.box==""){bbox=this.options.box}return url+DCI.Util.getParamString(this.wmsParams,url,true)+"&BBOX="+bbox},_getTile:function(){return this._createTile()},redraw:function(){if(this._map){this._update()}return this},setParams:function(b,a){DCI.extend(this.wmsParams,b);if(!a){this.redraw()}return this},_tileOnLoad:function(){var a=this._layer;if(this.src!==DCI.Util.emptyImageUrl){DCI.DomUtil.addClass(this,"dci-tile-loaded");a.fire("tileload",{tile:this,url:this.src})}a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;if(b){this.src=b}a._tileLoaded()},_tileLoaded:function(){this._tilesToLoad--;if(this._animated){DCI.DomUtil.addClass(this._tileContainer,"dci-zoom-animated")}if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(DCI.bind(this._clearBgBuffer,this),500)}}}});DCI.wmsLayer=function(b,a,c){return new DCI.WMSLayer(b,a,c)};DCI.PUBWMSLayer=DCI.TileLayer.extend({includes:DCI.Mixin.Events,options:{direction:0,minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,pzindex:1000,unloadInvisibleTiles:DCI.Browser.mobile,updateWhenIdle:DCI.Browser.mobile},defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false,crs:""},initialize:function(c,b,f){this.options.direction=f;this._url=c;var a=DCI.extend({},this.defaultWmsParams),e=b.tileSize||this.options.tileSize;if(b.detectRetina&&DCI.Browser.retina){a.width=a.height=e*2}else{a.width=a.height=e}for(var d in b){if(!this.options.hasOwnProperty(d)&&d!=="crs"){a[d]=b[d]}}this.wmsParams=a;DCI.setOptions(this,b)},onAdd:function(b){this._map=b;this._initContainer();if(this._animated){b.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}this._crs=this.options.crs||b.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var c=this._wmsVersion>=1.3?"crs":"srs";if(this._crs.code!=undefined){this.wmsParams[c]=this._crs.code}var a=b.getSize();this.wmsParams.width=a.x;this.wmsParams.height=a.y;this._map=b;b.on({viewreset:this._update,moveend:this._update,zoomend:this._update},this);this._update()},_initContainer:function(){var a=this._map._panes.tilePane;this._animated=map._zoomAnimated;if(!this._container){this._container=DCI.DomUtil.create("div","dci-wmsLayer");this._container.style.zIndex=this.options.pzindex;this._updateZIndex();if(this._animated){var b="dci-wmsTile-container";this._bgBuffer=DCI.DomUtil.create("div",b,this._container);this._tileContainer=DCI.DomUtil.create("div",b,this._container)}else{this._tileContainer=this._container}a.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined){this._container.style.zIndex=this.options.zIndex}},_update:function(){if(!this._map){return}var c=this._map,b=c.getPixelBounds();this._tileContainer.innerHTML="";var a=document.createDocumentFragment();this._addTile(b,a);this._tileContainer.appendChild(a)},_createTile:function(){var a=DCI.DomUtil.create("img","dci-wmsTile");a.style.width=this.wmsParams.width+"px";a.style.height=this.wmsParams.height+"px";a.galleryimg="no";a.onselectstart=a.onmousemove=DCI.Util.falseFn;if(DCI.Browser.ielt9&&this.options.opacity!==undefined){DCI.DomUtil.setOpacity(a,this.options.opacity)}if(DCI.Browser.mobileWebkit3d){a.style.WebkitBackfaceVisibility="hidden"}return a},_animateZoom:function(f){if(this._animated){DCI.DomUtil.addClass(this._tileContainer,"dci-zoom-animated")}var c=this._tileContainer,a=DCI.DomUtil.TRANSFORM,b=f.delta?DCI.DomUtil.getTranslateString(f.delta):c.style[a],d=DCI.DomUtil.getScaleString(f.scale,f.origin);c.style[a]=f.backwards?d+" "+b:b+" "+d},_endZoomAnim:function(){DCI.Util.falseFn(this._tileContainer.offsetWidth);this._tileContainer.style[DCI.DomUtil.TRANSFORM]=""},_addTile:function(e,a){var b=this._map.getPixelOrigin();var c=e.min.clone().subtract(b);var d=this._getTile();DCI.DomUtil.setPosition(d,c,DCI.Browser.chrome);this._loadTile(d,e);if(d.parentNode!==this._tileContainer){a.appendChild(d)}},_loadTile:function(b,a){b._layer=this;b.onload=this._tileOnLoad;b.onerror=this._tileOnError;b.src=this.getTileUrl(a);var c=this.options.direction;if(c!=0||c!=null){switch(c){case 45:b.src+="&affine=0.7071067812,-0.7071067812,369183.124,0.3535533906,0.3535533906,24508.143,0.7071067812,1.414213562,-295711.6387,-0.7071067812,1.414213562,226392.1423";break;case 135:b.src+="&affine=-0.707106781186547,-0.707106781186548,1081624.507,0.353553390593274,-0.353553390593274,246139.8  ,-0.707106781186548,1.41421356237309,416729.780197455,-0.707106781186548,-1.41421356237309,1112918.26699706";break;case 225:b.src+="&affine=-0.707106781186548,0.707106781186548,638361.211,-0.353553390593274,-0.353553390593274,602360.532,-0.707106781186547,-1.41421356237309,1303255.97493723,0.707106781186547,-1.41421356237309,400476.892648116";break;case 315:b.src+="&affine=0.707106781186547,0.707106781186548,-74080.302,-0.353553390593274,0.353553390593274,380728.896,0.707106781186547,-1.4142135623731,590814.652207083,0.707106781186548,1.41421356237309,-486049.284413987";break}}this.fire("tileloadstart",{tile:b,url:b.src})},onRemove:function(a){this._container.parentNode.removeChild(this._container);a.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){a.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},getTileUrl:function(b){var d=this._map;var c=d.getBounds();var a=c.getNorthWest();se=c.getSouthEast();a=this._crs.project(a),se=this._crs.project(se),bbox=this._wmsVersion>=1.3&&this._crs===DCI.CRS.EPSG4326?[se.y,a.x,a.y,se.x].join(","):[a.x,se.y,se.x,a.y].join(","),url=DCI.Util.template(this._url);return url+DCI.Util.getParamString(this.wmsParams,url,true)+"&BBOX="+bbox},_getTile:function(){return this._createTile()},redraw:function(){if(this._map){this._update()}return this},setParams:function(b,a){DCI.extend(this.wmsParams,b);if(!a){this.redraw()}return this}});DCI.pubwmsLayer=function(b,a,c){return new DCI.PUBWMSLayer(b,a,c)};DCI.TileLayer.IE6=DCI.TileLayer.extend({_createTile:function(){var a=DCI.DomUtil.createforIE6("div","dci-tile");a.style.width=a.style.height=this._getTileSize()+"px";a.galleryimg="no";a.onselectstart=a.onmousemove=DCI.Util.falseFn;if(DCI.Browser.ielt9&&this.options.opacity!==undefined){DCI.DomUtil.setOpacity(a,this.options.opacity)}if(DCI.Browser.mobileWebkit3d){a.style.WebkitBackfaceVisibility="hidden"}return a},_loadTile:function(b,a){b._layer=this;b.onload=this._tileOnLoad;b.onerror=this._tileOnError;this._adjustTilePoint(a);b.src=this.getTileUrl(a);if(b.src.indexOf("TRAImage")!=-1||b.src.indexOf("wms")!=-1){b.style.position="absolute";b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"',sizingMethod='scale');"}this.fire("tileloadstart",{tile:b,url:b.src})}});DCI.tileLayer.ie6=function(b,a){return new DCI.TileLayer.IE6(b,a)};DCI.TileLayer.WMS=DCI.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false,crs:""},initialize:function(c,b){this._url=c;var a=DCI.extend({},this.defaultWmsParams),e=b.tileSize||this.options.tileSize;if(b.detectRetina&&DCI.Browser.retina){a.width=a.height=e*2}else{a.width=a.height=e}for(var d in b){if(!this.options.hasOwnProperty(d)&&d!=="crs"){a[d]=b[d]}}this.wmsParams=a;DCI.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";if(this._crs.code!=undefined){this.wmsParams[b]=this._crs.code}DCI.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(c){var b=this._map,k=this.options.tileSize,h=c.multiplyBy(k),f=h.add([k,k]),d=this._crs.project(b.unproject(h,c.z)),e=this._crs.project(b.unproject(f,c.z)),g=this._wmsVersion>=1.3&&this._crs===DCI.CRS.EPSG4326?[e.y,d.x,d.y,e.x].join(","):[d.x,e.y,e.x,d.y].join(","),a=DCI.Util.template(this._url,{s:this._getSubdomain(c)});return a+DCI.Util.getParamString(this.wmsParams,a,true)+"&BBOX="+g},setParams:function(b,a){DCI.extend(this.wmsParams,b);if(!a){this.redraw()}return this}});DCI.tileLayer.wms=function(c,b){if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a==6){return new DCI.TileLayer.WMS.IE6(c,b)}}return new DCI.TileLayer.WMS(c,b)};DCI.TileLayer.WMS.IE6=DCI.TileLayer.IE6.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false,crs:""},initialize:function(c,b){this._url=c;var a=DCI.extend({},this.defaultWmsParams),e=b.tileSize||this.options.tileSize;if(b.detectRetina&&DCI.Browser.retina){a.width=a.height=e*2}else{a.width=a.height=e}for(var d in b){if(!this.options.hasOwnProperty(d)&&d!=="crs"){a[d]=b[d]}}this.wmsParams=a;DCI.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";if(this._crs.code!=undefined){this.wmsParams[b]=this._crs.code}DCI.TileLayer.IE6.prototype.onAdd.call(this,a)},getTileUrl:function(c){var b=this._map,k=this.options.tileSize,h=c.multiplyBy(k),f=h.add([k,k]),d=this._crs.project(b.unproject(h,c.z)),e=this._crs.project(b.unproject(f,c.z)),g=this._wmsVersion>=1.3&&this._crs===DCI.CRS.EPSG4326?[e.y,d.x,d.y,e.x].join(","):[d.x,e.y,e.x,d.y].join(","),a=DCI.Util.template(this._url,{s:this._getSubdomain(c)});return a+DCI.Util.getParamString(this.wmsParams,a,true)+"&BBOX="+g},setParams:function(b,a){DCI.extend(this.wmsParams,b);if(!a){this.redraw()}return this}});DCI.tileLayer.wms.ie6=function(b,a){return new DCI.TileLayer.WMS.IE6(b,a)};DCI.TileLayer.WMTS=DCI.TileLayer.extend({initialize:function(b,a){$this_wmts=this;this.type=a.type||"Shiliang_2012";DCI.Ajax.ajaxService(b,this.callback)},callback:function(backResult){var xmlDoc=DCI.bindingDoc(backResult);var contents=xmlDoc.getElementsByTagName("Contents")[0];var text="text";if(contents.textContent){text="textContent"}var layers=contents.getElementsByTagName("Layer");var tileMatrixSets=contents.getElementsByTagName("TileMatrixSet");for(var i=0;i<layers.length;i++){var layer=layers[i];var titles=DCI.findByTagName(layer,"ows:Title","Title");if(titles==null||titles.length==0){continue}var title=titles[0][text];if(title==$this_wmts.type){var boundingBoxs=DCI.findByTagName(layer,"ows:BoundingBox","BoundingBox");if(boundingBoxs==null||boundingBoxs.length==0){continue}var boundingBox=boundingBoxs[0];$this_wmts.crs=boundingBox.getAttribute("crs");var lowerCorners=DCI.findByTagName(boundingBox,"ows:LowerCorner","LowerCorner");if(lowerCorners==null||lowerCorners.length==0){continue}var lowerCorner=lowerCorners[0][text].split(" ");var upperCorners=DCI.findByTagName(boundingBox,"ows:UpperCorner","UpperCorner");if(upperCorners==null||upperCorners.length==0){continue}var upperCorner=upperCorners[0][text].split(" ");var lowerLatLng=new DCI.LatLng(lowerCorner[0],lowerCorner[1]);var upperLatLng=new DCI.LatLng(upperCorner[0],upperCorner[1]);$this_wmts.bounds=new DCI.LatLngBounds(lowerLatLng,upperLatLng);var style=layer.getElementsByTagName("Style")[0];var styleTitles=DCI.findByTagName(style,"ows:Title","Title");if(styleTitles==null||styleTitles.length==0){continue}$this_wmts.styleTitle=styleTitles[0][text];var styleIdentifiers=DCI.findByTagName(style,"ows:Identifier","Identifier");if(styleIdentifiers==null||styleIdentifiers.length==0){continue}$this_wmts.styleIdentifier=styleIdentifiers[0][text];$this_wmts.format=layer.getElementsByTagName("Format")[0][text];$this_wmts.tileUrl=layer.getElementsByTagName("ResourceURL")[0].getAttribute("template");$this_wmts.tileMatrixSetLink=tileMatrixSets[i][text];break}}for(var i=layers.length;i<tileMatrixSets.length;i++){var tileMatrixSet=tileMatrixSets[i];var titles=DCI.findByTagName(tileMatrixSet,"ows:Title","Title");if(titles==null||titles.length==0){continue}var title=titles[0][text];if(title==$this_wmts.tileMatrixSetLink){var tileMatrix=tileMatrixSet.getElementsByTagName("TileMatrix");maxZoom=1,minZoom=1;$this_wmts.levelConfig=new Array();for(var j=0;j<tileMatrix.length;j++){var matrix=tileMatrix[j];var identifiers=DCI.findByTagName(matrix,"ows:Identifier","Identifier");if(identifiers==null||identifiers.length==0){continue}var level=parseInt(identifiers[0][text]);var scale=matrix.getElementsByTagName("ScaleDenominator")[0][text];var topLeft=matrix.getElementsByTagName("TopLeftCorner")[0][text].split(" ");var tileSize=matrix.getElementsByTagName("TileWidth")[0][text];if(level<minZoom){minZoom=level}if(level>maxZoom){maxZoom=level}var levels=eval("({zoom:"+level+",tileSize:"+tileSize+",scale:"+scale+",XOrigin:"+topLeft[0]+",YOrigin:"+topLeft[1]+"})");$this_wmts.levelConfig.push(levels)}$this_wmts.minZoom=minZoom;$this_wmts.maxZoom=maxZoom;break}}}});DCI.tileLayer.wmts=function(b,a){return new DCI.TileLayer.WMTS(b,a)};DCI.TileLayer.Canvas=DCI.TileLayer.extend({options:{async:false},initialize:function(a){DCI.setOptions(this,a)},redraw:function(){if(this._map){this._reset({hard:true});this._update()}for(var a in this._tiles){this._redrawTile(this._tiles[a])}return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=DCI.DomUtil.create("canvas","dci-tile");a.width=a.height=this.options.tileSize;a.onselectstart=a.onmousemove=DCI.Util.falseFn;return a},_loadTile:function(b,a){b._layer=this;b._tilePoint=a;this._redrawTile(b);if(!this.options.async){this.tileDrawn(b)}},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}});DCI.tileLayer.canvas=function(a){return new DCI.TileLayer.Canvas(a)};DCI.ImageOverlay=DCI.Class.extend({includes:DCI.Mixin.Events,options:{opacity:1},initialize:function(b,c,a){this._url=b;this._bounds=DCI.latLngBounds(c);DCI.setOptions(this,a)},onAdd:function(a){this._map=a;if(!this._image){this._initImage()}a._panes.overlayPane.appendChild(this._image);a.on("viewreset",this._reset,this);if(a.options.zoomAnimation&&DCI.Browser.any3d){a.on("zoomanim",this._animateZoom,this)}this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image);a.off("viewreset",this._reset,this);if(a.options.zoomAnimation){a.off("zoomanim",this._animateZoom,this)}},addTo:function(a){a.addLayer(this);return this},setOpacity:function(a){this.options.opacity=a;this._updateOpacity();return this},bringToFront:function(){if(this._image){this._map._panes.overlayPane.appendChild(this._image)}return this},bringToBack:function(){var a=this._map._panes.overlayPane;if(this._image){a.insertBefore(this._image,a.firstChild)}return this},setUrl:function(a){this._url=a;this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=DCI.DomUtil.create("img","dci-image-layer");if(this._map.options.zoomAnimation&&DCI.Browser.any3d){DCI.DomUtil.addClass(this._image,"dci-zoom-animated")}else{DCI.DomUtil.addClass(this._image,"dci-zoom-hide")}this._updateOpacity();DCI.extend(this._image,{galleryimg:"no",onselectstart:DCI.Util.falseFn,onmousemove:DCI.Util.falseFn,onload:DCI.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(f){var a=this._map,c=this._image,b=a.getZoomScale(f.zoom),d=this._bounds.getNorthWest(),g=this._bounds.getSouthEast(),k=a._latLngToNewLayerPoint(d,f.zoom,f.center),l=a._latLngToNewLayerPoint(g,f.zoom,f.center)._subtract(k),h=k._add(l._multiplyBy((1/2)*(1-1/b)));c.style[DCI.DomUtil.TRANSFORM]=DCI.DomUtil.getTranslateString(h)+" scale("+b+") "},_reset:function(){var c=this._image,b=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),a=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(b);DCI.DomUtil.setPosition(c,b);c.style.width=a.x+"px";c.style.height=a.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){DCI.DomUtil.setOpacity(this._image,this.options.opacity)}});DCI.imageOverlay=function(b,c,a){return new DCI.ImageOverlay(b,c,a)};(function(x){var w={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{0.25:"rgb(0,0,255)",0.55:"rgb(0,255,0)",0.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:0.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}};var v=function p(){var b=function e(c){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1;this._xField=c.xField||c.defaultXField;this._yField=c.yField||c.defaultYField;this._valueField=c.valueField||c.defaultValueField;if(c.radius){this._cfgRadius=c.radius}};var f=w.defaultRadius;b.prototype={_organiseData:function(F,E){var D=F[this._xField];var C=F[this._yField];var B=this._radi;var A=this._data;var z=this._max;var y=this._min;var l=F[this._valueField]||1;var c=F.radius||this._cfgRadius||f;if(!A[D]){A[D]=[];B[D]=[]}if(!A[D][C]){A[D][C]=l;B[D][C]=c}else{A[D][C]+=l}if(A[D][C]>z){if(!E){this._max=A[D][C]}else{this.setDataMax(A[D][C])}return false}else{return{x:D,y:C,value:l,radius:c,min:y,max:z}}},_unOrganizeData:function(){var h=[];var g=this._data;var y=this._radi;for(var l in g){for(var k in g[l]){h.push({x:l,y:k,radius:y[l][k],value:g[l][k]})}}return{min:this._min,max:this._max,data:h}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0){var g=arguments[0];var d=g.length;while(d--){this.addData.call(this,g[d])}}else{var h=this._organiseData(arguments[0],true);if(h){this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[h]})}}return this},setData:function(h){var g=h.data;var l=g.length;this._max=h.max;this._min=h.min||0;this._data=[];this._radi=[];for(var k=0;k<l;k++){this._organiseData(g[k],false)}this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},removeData:function(){},setDataMax:function(c){this._max=c;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setDataMin:function(c){this._min=c;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(c){this._coordinator=c},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}};return b}();var u=function o(){var f=function(l){var k=l.gradient||l.defaultGradient;var B=document.createElement("canvas");var A=B.getContext("2d");B.width=256;B.height=1;var z=A.createLinearGradient(0,0,256,1);for(var y in k){z.addColorStop(y,k[y])}A.fillStyle=z;A.fillRect(0,0,256,1);return A.getImageData(0,0,256,1).data};var e=function(l,k){var C=document.createElement("canvas");var B=C.getContext("2d");var A=l;var z=l;C.width=C.height=l*2;if(k==1){B.beginPath();B.arc(A,z,l,0,2*Math.PI,false);B.fillStyle="rgba(0,0,0,1)";B.fill()}else{var y=B.createRadialGradient(A,z,l*k,A,z,l);y.addColorStop(0,"rgba(0,0,0,1)");y.addColorStop(1,"rgba(0,0,0,0)");B.fillStyle=y;B.fillRect(0,0,2*l,2*l)}return C};var h=function(K){var J=[];var I=K.min;var H=K.max;var G=K.radi;var K=K.data;var F=Object.keys(K);var E=F.length;while(E--){var D=F[E];var C=Object.keys(K[D]);var B=C.length;while(B--){var A=C[B];var z=K[D][A];var y=G[D][A];J.push({x:D,y:A,value:z,radius:y})}}return{min:I,max:H,data:J}};function g(a){var A=a.container;var z=this.shadowCanvas=document.createElement("canvas");var y=this.canvas=a.canvas||document.createElement("canvas");var l=this._renderBoundaries=[10000,10000,0,0];var k=getComputedStyle(a.container)||{};y.className="heatmap-canvas";this._width=y.width=z.width=+k.width.replace(/px/,"");this._height=y.height=z.height=+k.height.replace(/px/,"");this.shadowCtx=z.getContext("2d");this.ctx=y.getContext("2d");y.style.cssText=z.style.cssText="position:absolute;left:0;top:0;";A.style.position="relative";A.appendChild(y);this._palette=f(a);this._templates={};this._setStyles(a)}g.prototype={renderPartial:function(b){this._drawAlpha(b);this._colorize()},renderAll:function(b){this._clear();this._drawAlpha(h(b));this._colorize()},_updateGradient:function(a){this._palette=f(a)},updateConfig:function(b){if(b.gradient){this._updateGradient(b)}this._setStyles(b)},setDimensions:function(d,c){this._width=d;this._height=c;this.canvas.width=this.shadowCanvas.width=d;this.canvas.height=this.shadowCanvas.height=c},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height);this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(b){this._blur=b.blur==0?0:b.blur||b.defaultBlur;if(b.backgroundColor){this.canvas.style.backgroundColor=b.backgroundColor}this._opacity=(b.opacity||0)*255;this._maxOpacity=(b.maxOpacity||b.defaultMaxOpacity)*255;this._minOpacity=(b.minOpacity||b.defaultMinOpacity)*255},_drawAlpha:function(K){var J=this._min=K.min;var I=this._max=K.max;var K=K.data||[];var H=K.length;var G=1-this._blur;while(H--){var F=K[H];var E=F.x;var D=F.y;var C=F.radius;var B=F.value;var A=E-C;var z=D-C;var y=this.shadowCtx;var b;if(!this._templates[C]){this._templates[C]=b=e(C,G)}else{b=this._templates[C]}y.globalAlpha=B/Math.abs(I-J);y.drawImage(b,A,z);if(A<this._renderBoundaries[0]){this._renderBoundaries[0]=A}if(z<this._renderBoundaries[1]){this._renderBoundaries[1]=z}if(A+2*C>this._renderBoundaries[2]){this._renderBoundaries[2]=A+2*C}if(z+2*C>this._renderBoundaries[3]){this._renderBoundaries[3]=z+2*C}}},_colorize:function(){var O=this._renderBoundaries[0];var N=this._renderBoundaries[1];var M=this._renderBoundaries[2]-O;var L=this._renderBoundaries[3]-N;var K=this._width;var J=this._height;var I=this._opacity;var H=this._maxOpacity;var G=this._minOpacity;if(O<0){O=0}if(N<0){N=0}if(O+M>K){M=K-O}if(N+L>J){L=J-N}var F=this.shadowCtx.getImageData(O,N,M,L);var E=F.data;var D=E.length;var C=this._palette;for(var B=3;B<D;B+=4){var A=E[B];var z=A*4;if(!z){continue}var y;if(I>0){y=I}else{if(A<H){if(A<G){y=G}else{y=A}}else{y=H}}E[B-3]=C[z];E[B-2]=C[z+1];E[B-1]=C[z+2];E[B]=y}F.data=E;this.ctx.putImageData(F,O,N);this._renderBoundaries=[1000,1000,0,0]},getValueAt:function(l){var k;var C=this.shadowCtx;var B=C.getImageData(l.x,l.y,1,1);var A=B.data[3];var z=this._max;var y=this._min;k=Math.abs(z-y)*(A/255)>>0;return k},getDataURL:function(){return this.canvas.toDataURL()}};return g}();var t=function n(){var b=false;if(w.defaultRenderer==="canvas2d"){b=u}return b}();var s={merge:function(){var g={};var f=arguments.length;for(var l=0;l<f;l++){var k=arguments[l];for(var h in k){g[h]=k[h]}}return g}};var r=function m(){var b=function c(){function d(){this.cStore={}}d.prototype={on:function(h,g,l){var k=this.cStore;if(!k[h]){k[h]=[]}k[h].push(function(y){return g.call(l,y)})},emit:function(h,g){var z=this.cStore;if(z[h]){var y=z[h].length;for(var l=0;l<y;l++){var k=z[h][l];k(g)}}}};return d}();var f=function(h){var g=h._renderer;var l=h._coordinator;var k=h._store;l.on("renderpartial",g.renderPartial,g);l.on("renderall",g.renderAll,g);l.on("extremachange",function(a){h._config.onExtremaChange&&h._config.onExtremaChange({min:a.min,max:a.max,gradient:h._config.gradient||h._config.defaultGradient})});k.setCoordinator(l)};function e(){var k=this._config=s.merge(w,arguments[0]||{});this._coordinator=new b;if(k.plugin){var d=k.plugin;if(!w.plugins[d]){throw new Error("Plugin '"+d+"' not found. Maybe it was not registered.")}else{var a=w.plugins[d];this._renderer=a.renderer;this._store=a.store}}else{this._renderer=new t(k);this._store=new v(k)}f(this)}e.prototype={addData:function(){this._store.addData.apply(this._store,arguments);return this},removeData:function(){this._store.removeData&&this._store.removeData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store,arguments);return this},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(d){this._config=s.merge(this._config,d);this._renderer.updateConfig(this._config);this._coordinator.emit("renderall",this._store._getInternalData());return this},repaint:function(){this._coordinator.emit("renderall",this._store._getInternalData());return this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(d){if(this._store.getValueAt){return this._store.getValueAt(d)}else{if(this._renderer.getValueAt){return this._renderer.getValueAt(d)}else{return null}}}};return e}();var q={create:function(b){return new r(b)},register:function(b,d){w.plugins[b]=d}};x.h337=q})(this||window);var HeatmapOverlay=DCI.Class.extend({initialize:function(a){this.cfg=a;this._el=DCI.DomUtil.create("div","leaflet-zoom-hide");this._data=[];this._max=1;this.cfg.container=this._el},onAdd:function(b){var a=b.getSize();this._map=b;this._width=a.x;this._height=a.y;this._el.style.width=a.x+"px";this._el.style.height=a.y+"px";this._resetOrigin();b.getPanes().overlayPane.appendChild(this._el);if(!this._heatmap){this._heatmap=h337.create(this.cfg)}b.on("viewreset",this._resetOrigin,this);b.on("dragend",this._draw,this);this._draw()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._el);a.off("viewreset",this._resetOrigin,this);a.off("dragend",this._draw,this)},_draw:function(){if(!this._map){return}var a=this._map.latLngToContainerPoint(this._origin);this._el.style[HeatmapOverlay.CSS_TRANSFORM]="translate("+-Math.round(a.x)+"px,"+-Math.round(a.y)+"px)";this._update()},_update:function(){var a,p,e;a=this._map.getBounds();p=this._map.getZoom();e=Math.pow(2,p);if(this._data.length==0){return}var g={max:this._max};var o=[];var f=this.cfg.scaleRadius?e:1;var d=0;var q=this.cfg.valueField;var k=this._data.length;while(k--){var n=this._data[k];var m=n[q];var b=n.latlng;if(!a.contains(b)){continue}if(m>d){d=m}var l=this._map.latLngToContainerPoint(b);var c={x:Math.round(l.x),y:Math.round(l.y)};c[q]=m;var h;if(n.radius){h=n.radius*f}else{h=(this.cfg.radius||2)*f}c.radius=h;o.push(c)}if(this.cfg.useLocalExtrema){g.max=d}g.data=o;this._heatmap.setData(g)},setData:function(c){this._max=c.max||this._max;var f=this.cfg.latField||"lat";var e=this.cfg.lngField||"lng";var l=this.cfg.valueField||"value";var c=c.data;var g=c.length;var h=[];while(g--){var k=c[g];var b=new DCI.LatLng(k[f],k[e]);var a={latlng:b};a[l]=k[l];if(k.radius){a.radius=k.radius}h.push(a)}this._data=h;this._draw()},addData:function(b){if(b.length>0){var a=b.length;while(a--){this.addData(b[a])}}else{var d=this.cfg.latField||"lat";var g=this.cfg.lngField||"lng";var e=this.cfg.valueField||"value";var f=b;var h=new DCI.LatLng(f[d],f[g]);var c={latlng:h};c[e]=f[e];this._max=Math.max(this._max,c[e]);if(f.radius){c.radius=f.radius}this._data.push(c);this._draw()}},_resetOrigin:function(){this._origin=this._map.layerPointToLatLng(new DCI.Point(0,0));this._draw()}});HeatmapOverlay.CSS_TRANSFORM=(function(){var d=document.createElement("div");var b=["transform","WebkitTransform","MozTransform","OTransform","msTransform"];for(var a=0;a<b.length;a++){var c=b[a];if(d.style[c]!==undefined){return c}}return b[0]})();DCI.Icon=DCI.Class.extend({options:{className:""},initialize:function(a){DCI.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createIconforIE6:function(a){return this._createIconforIE6("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(b,c){var d=this._getIconUrl(b);if(!d){if(b==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var a;if(!c||c.tagName!=="IMG"){a=this._createImg(d)}else{a=this._createImg(d,c)}this._setIconStyles(a,b);return a},_createIconforIE6:function(b,c){var d=this._getIconUrl(b);if(!d){if(b==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var a;if(!c){a=this._createImg(d)}else{a=this._createImg(d,c)}this._setIconStyles(a,b);return a},_setIconStyles:function(a,d){var c=this.options,e=DCI.point(c[d+"Size"]),b;if(d==="shadow"){b=DCI.point(c.shadowAnchor||c.iconAnchor)}else{b=DCI.point(c.iconAnchor)}if(!b&&e){b=e.divideBy(2,true)}a.className="dci-marker-"+d+" "+c.className;if(b){a.style.marginLeft=(-b.x)+"px";a.style.marginTop=(-b.y)+"px"}if(e){a.style.width=e.x+"px";a.style.height=e.y+"px"}},_createImg:function(b,a){a=a||document.createElement("img");a.src=b;return a},_getIconUrl:function(a){if(DCI.Browser.retina&&this.options[a+"RetinaUrl"]){return this.options[a+"RetinaUrl"]}return this.options[a+"Url"]}});DCI.icon=function(a){return new DCI.Icon(a)};DCI.Icon.Default=DCI.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(b){var c=b+"Url";if(this.options[c]){return this.options[c]}if(DCI.Browser.retina&&b==="icon"){b+="-2x"}var d=DCI.Icon.Default.imagePath;if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a==6){d="../../api/dist/images"}}if(!d){d="../dist/images"}return d+"/marker-"+b+".png"}});DCI.Icon.Default.imagePath=(function(){var c=document.getElementsByTagName("script"),b=/[\/^]dci[\-\._]?([\w\-\._]*)\.js\??/;var d,a,g,e,f;for(d=0,a=c.length;d<a;d++){g=c[d].src;e=g.match(b);if(e){f=g.split(b)[0];return(f?f+"/":"")+"images"}}}());DCI.Marker=DCI.Class.extend({includes:DCI.Mixin.Events,options:{icon:new DCI.Icon.Default(),title:"",alt:"",clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250},initialize:function(b,a){DCI.setOptions(this,a);this._latlng=DCI.latLng(b)},_pngImgProcess:function(){var e=document.getElementsByTagName("img");for(var c=0;c<e.length;c++){var d=e[c];var h=d.src.toUpperCase();if(h.substring(h.length-3,h.length)=="PNG"){var f=(d.id)?"id='"+d.id+"' ":"";var k=(d.className)?"class='"+d.className+"' ":"";var b=(d.title)?"title='"+d.title+"' ":"title=' "+d.alt+"' ";var g="display:inline-block;"+d.style.cssText;if(d.align=="left"){g="float:left;"+g}if(d.align=="right"){g="float:right;"+g}if(d.parentElement.href){g="cursor:hand;"+g}var a="<div "+f+k+b+' style="width:'+d.width+"px;height:"+d.height+"px;"+g+";filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d.src+"',sizingMethod='scale');\"></div>";d.outerHTML=a;c=c-1}}},onAdd:function(a){this._map=a;a.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");if(a.options.zoomAnimation&&a.options.markerZoomAnimation){a.on("zoomanim",this._animateZoom,this)}},addTo:function(a){a.addLayer(this);return this},onRemove:function(a){if(this.dragging){this.dragging.disable()}this._removeIcon();this._removeShadow();this.fire("remove");a.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){this._latlng=DCI.latLng(a);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){this.options.zIndexOffset=a;this.update();return this},setIcon:function(a){this.options.icon=a;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup)}return this},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var h=this.options,a=this._map,d=(a.options.zoomAnimation&&a.options.markerZoomAnimation),c=d?"dci-zoom-animated":"dci-zoom-hide";var g=h.icon.createIcon(this._icon),e=false;if(g!==this._icon){if(this._icon){this._removeIcon()}e=true;if(h.title){g.title=h.title}if(h.alt){g.alt=h.alt}}DCI.DomUtil.addClass(g,c);if(h.keyboard){g.tabIndex="0"}this._icon=g;this._initInteraction();if(h.riseOnHover){DCI.DomEvent.on(g,"mouseover",this._bringToFront,this).on(g,"mouseout",this._resetZIndex,this)}var k=h.icon.createShadow(this._shadow),b=false;if(k!==this._shadow){this._removeShadow();b=true}if(k){DCI.DomUtil.addClass(k,c)}this._shadow=k;if(h.opacity<1){this._updateOpacity()}var f=this._map._panes;if(e){f.markerPane.appendChild(this._icon)}if(k&&b){f.shadowPane.appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){DCI.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex)}this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){this._map._panes.shadowPane.removeChild(this._shadow)}this._shadow=null},setIconAngle:function(a){this._icon.style.transform+="rotate("+a+"deg)"},_setPos:function(a){DCI.DomUtil.setPosition(this._icon,a);if(this._shadow){DCI.DomUtil.setPosition(this._shadow,a)}this._zIndex=a.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(b)},_initInteraction:function(){if(!this.options.clickable){return}var c=this._icon,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];DCI.DomUtil.addClass(c,"dci-clickable");DCI.DomEvent.on(c,"click",this._onMouseClick,this);DCI.DomEvent.on(c,"keypress",this._onKeyPress,this);for(var a=0;a<b.length;a++){DCI.DomEvent.on(c,b[a],this._fireMouseEvent,this)}if(DCI.Handler.MarkerDrag){this.dragging=new DCI.Handler.MarkerDrag(this);if(this.options.draggable){this.dragging.enable()}}},_onMouseClick:function(b){var a=this.dragging&&this.dragging.moved();if(this.hasEventListeners(b.type)||a){DCI.DomEvent.stopPropagation(b)}if(a){return}if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved()){return}this.fire(b.type,{originalEvent:b,latlng:this._latlng})},_onKeyPress:function(a){if(a.keyCode===13){this.fire("click",{originalEvent:a,latlng:this._latlng})}},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng});if(a.type==="contextmenu"&&this.hasEventListeners(a.type)){DCI.DomEvent.preventDefault(a)}if(a.type!=="mousedown"){DCI.DomEvent.stopPropagation(a)}else{DCI.DomEvent.preventDefault(a)}},setOpacity:function(a){this.options.opacity=a;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){DCI.DomUtil.setOpacity(this._icon,this.options.opacity);if(this._shadow){DCI.DomUtil.setOpacity(this._shadow,this.options.opacity)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});DCI.marker=function(c,b){if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a==6){return new DCI.marker.ie6(c,b)}}return new DCI.Marker(c,b)};DCI.Marker.IE6=DCI.Marker.extend({_pngImgProcess:function(){var a=this._icon;var b=a.src.toUpperCase();if(b.substring(b.length-3,b.length)=="PNG"){this._icon.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"',sizingMethod='scale');"}},onAdd:function(b){this._map=b;b.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");if(b.options.zoomAnimation&&b.options.markerZoomAnimation){b.on("zoomanim",this._animateZoom,this)}if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a==6){this._pngImgProcess()}}},onRemove:function(a){if(this.dragging){this.dragging.disable()}this._removeIcon();this.fire("remove");a.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},_initIcon:function(){var a=this.options,g=this._map,e=(g.options.zoomAnimation&&g.options.markerZoomAnimation),d=e?"dci-zoom-animated":"dci-zoom-hide";var c=a.icon.createIconforIE6(document.createElement("div")),f=false;if(c!==this._icon){if(this._icon){this._removeIcon()}f=true;if(a.title){c.title=a.title}if(a.alt){c.alt=a.alt}}DCI.DomUtil.addClass(c,d);if(a.keyboard){c.tabIndex="0"}this._icon=c;this._initInteraction();if(a.riseOnHover){DCI.DomEvent.on(c,"mouseover",this._bringToFront,this).on(c,"mouseout",this._resetZIndex,this)}if(a.opacity<1){this._updateOpacity()}var b=this._map._panes;if(f){b.markerPane.appendChild(this._icon)}},_setPos:function(a){DCI.DomUtil.setPosition(this._icon,a);if(this._shadow){DCI.DomUtil.setPosition(this._shadow,a)}this._zIndex=a.y+this.options.zIndexOffset;this._resetZIndex()}});DCI.marker.ie6=function(b,a){return new DCI.Marker.IE6(b,a)};DCI.DivIcon=DCI.Icon.extend({options:{iconSize:[5,5],className:"dci-div-icon",html:false},createIcon:function(b){var c=(b&&b.tagName==="DIV")?b:document.createElement("div"),a=this.options;if(a.html!==false){c.innerHTML=a.html}else{c.innerHTML=""}if(a.bgPos){c.style.backgroundPosition=(-a.bgPos.x)+"px "+(-a.bgPos.y)+"px"}this._setIconStyles(c,"icon");return c},createShadow:function(){return null}});DCI.divIcon=function(a){return new DCI.DivIcon(a)};DCI.Map.mergeOptions({closePopupOnClick:true});DCI.Popup=DCI.Class.extend({includes:DCI.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,5],keepInView:false,className:"",zoomAnimation:true},initialize:function(a,b){DCI.setOptions(this,a);this._source=b;this._animated=DCI.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(b){this._map=b;if(!this._container){this._initLayout()}var a=b.options.fadeAnimation;if(a){DCI.DomUtil.setOpacity(this._container,0)}b._panes.popupPane.appendChild(this._container);b.on(this._getEvents(),this);this.update();if(a){DCI.DomUtil.setOpacity(this._container,1)}this.fire("open");b.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this})}},addTo:function(a){a.addLayer(this);return this},openOn:function(a){a.openPopup(this);return this},onRemove:function(a){a._panes.popupPane.removeChild(this._container);DCI.Util.falseFn(this._container.offsetWidth);a.off(this._getEvents(),this);if(a.options.fadeAnimation){DCI.DomUtil.setOpacity(this._container,0)}this._map=null;this.fire("close");a.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this})}},getLatLng:function(){return this._latlng},setLatLng:function(a){this._latlng=DCI.latLng(a);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(a){this._content=a;this.update();return this},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_getEvents:function(){var a={viewreset:this._updatePosition};if(this._animated){a.zoomanim=this._zoomAnimation}if("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){a.preclick=this._close}if(this.options.keepInView){a.moveend=this._adjustPan}return a},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var c="dci-popup",d=c+" "+this.options.className+" dci-zoom-"+(this._animated?"animated":"hide"),a=this._container=DCI.DomUtil.create("div",d),b;if(this.options.closeButton){b=this._closeButton=DCI.DomUtil.create("a",c+"-close-button",a);b.href="#close";b.innerHTML="&#215;";DCI.DomEvent.disableClickPropagation(b);DCI.DomEvent.on(b,"click",this._onCloseButtonClick,this)}var e=this._wrapper=DCI.DomUtil.create("div",c+"-content-wrapper",a);DCI.DomEvent.disableClickPropagation(e);this._contentNode=DCI.DomUtil.create("div",c+"-content",e);DCI.DomEvent.disableScrollPropagation(this._contentNode);DCI.DomEvent.on(e,"contextmenu",DCI.DomEvent.stopPropagation);this._tipContainer=DCI.DomUtil.create("div",c+"-tip-container",a);this._tip=DCI.DomUtil.create("div",c+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._contentNode.innerHTML=this._content}else{while(this._contentNode.hasChildNodes()){this._contentNode.removeChild(this._contentNode.firstChild)}this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var b=this._contentNode,d=b.style;d.width="";d.whiteSpace="nowrap";var c=b.offsetWidth;c=Math.min(c,this.options.maxWidth);c=Math.max(c,this.options.minWidth);d.width=(c+1)+"px";d.whiteSpace="";d.height="";var a=b.offsetHeight,e=this.options.maxHeight,f="dci-popup-scrolled";if(e&&a>e){d.height=e+"px";DCI.DomUtil.addClass(b,f)}else{DCI.DomUtil.removeClass(b,f)}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map){return}var c=this._map.latLngToLayerPoint(this._latlng),a=this._animated,b=DCI.point(this.options.offset);if(a){DCI.DomUtil.setPosition(this._container,c)}this._containerBottom=-b.y-(a?0:c.y);this._containerLeft=-Math.round(this._containerWidth/2)+b.x+(a?0:c.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);DCI.DomUtil.setPosition(this._container,b)},_adjustPan:function(){if(!this.options.autoPan){return}var b=this._map,m=this._container.offsetHeight,g=this._containerWidth,e=new DCI.Point(this._containerLeft,-m-this._containerBottom);if(this._animated){e._add(DCI.DomUtil.getPosition(this._container))}var d=b.layerPointToContainerPoint(e),f=DCI.point(this.options.autoPanPadding),c=DCI.point(this.options.autoPanPaddingTopLeft||f),a=DCI.point(this.options.autoPanPaddingBottomRight||f),l=b.getSize(),k=0,h=0;if(d.x+g+a.x>l.x){k=d.x+g-l.x+a.x}if(d.x-k-c.x<0){k=d.x-c.x}if(d.y+m+a.y>l.y){h=d.y+m-l.y+a.y}if(d.y-h-c.y<0){h=d.y-c.y}if(k||h){b.fire("autopanstart").panBy([k,h])}},_onCloseButtonClick:function(a){this._close();DCI.DomEvent.stop(a)}});DCI.popup=function(a,b){return new DCI.Popup(a,b)};DCI.Map.include({openPopup:function(a,d,b){this.closePopup();if(!(a instanceof DCI.Popup)){var c=a;a=new DCI.Popup(b).setLatLng(d).setContent(c)}a._isOpen=true;this._popup=a;return this.addLayer(a)},closePopup:function(a){if(!a||a===this._popup){a=this._popup;this._popup=null}if(a){this.removeLayer(a);a._isOpen=false}return this}});DCI.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(){if(this._popup){if(this._popup._isOpen){this.closePopup()}else{this.openPopup()}}return this},bindPopup:function(c,b){var a=DCI.point(this.options.icon.options.popupAnchor||[0,0]);a=a.add(DCI.Popup.prototype.options.offset);if(b&&b.offset){a=a.add(b.offset)}b=DCI.extend({offset:a},b);if(!this._popupHandlersAdded){this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);this._popupHandlersAdded=true}if(c instanceof DCI.Popup){DCI.setOptions(c,b);this._popup=c}else{this._popup=new DCI.Popup(b,this).setContent(c)}return this},setPopupContent:function(a){if(this._popup){this._popup.setContent(a)}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this);this._popupHandlersAdded=false}return this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}});DCI.LayerGroup=DCI.Class.extend({initialize:function(c){this._layers={};var b,a;if(c){for(b=0,a=c.length;b<a;b++){this.addLayer(c[b])}}},addLayer:function(a){var b=this.getLayerId(a);this._layers[b]=a;if(this._map){this._map.addLayer(a)}return this},removeLayer:function(a){var b=a in this._layers?a:this.getLayerId(a);if(this._map&&this._layers[b]){this._map.removeLayer(this._layers[b])}delete this._layers[b];return this},hasLayer:function(a){if(!a){return false}return(a in this._layers||this.getLayerId(a) in this._layers)},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(a){var b=Array.prototype.slice.call(arguments,1),d,c;for(d in this._layers){c=this._layers[d];if(c[a]){c[a].apply(c,b)}}return this},onAdd:function(a){this._map=a;this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a);this._map=null},addTo:function(a){a.addLayer(this);return this},eachLayer:function(c,b){for(var a in this._layers){c.call(b,this._layers[a])}return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var b=[];for(var a in this._layers){b.push(this._layers[a])}return b},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return DCI.stamp(a)}});DCI.layerGroup=function(a){return new DCI.LayerGroup(a)};DCI.FeatureGroup=DCI.LayerGroup.extend({includes:DCI.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){if(this.hasLayer(a)){return this}if("on" in a){a.on(DCI.FeatureGroup.EVENTS,this._propagateEvent,this)}DCI.LayerGroup.prototype.addLayer.call(this,a);if(this._popupContent&&a.bindPopup){a.bindPopup(this._popupContent,this._popupOptions)}return this.fire("layeradd",{layer:a})},removeLayer:function(a){if(!this.hasLayer(a)){return this}if(a in this._layers){a=this._layers[a]}a.off(DCI.FeatureGroup.EVENTS,this._propagateEvent,this);DCI.LayerGroup.prototype.removeLayer.call(this,a);if(this._popupContent){this.invoke("unbindPopup")}return this.fire("layerremove",{layer:a})},bindPopup:function(b,a){this._popupContent=b;this._popupOptions=a;return this.invoke("bindPopup",b,a)},openPopup:function(b){for(var a in this._layers){this._layers[a].openPopup(b);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new DCI.LatLngBounds();this.eachLayer(function(b){a.extend(b instanceof DCI.Marker?b.getLatLng():b.getBounds())});return a},_propagateEvent:function(a){a=DCI.extend({layer:a.target,target:this},a);this.fire(a.type,a)}});DCI.featureGroup=function(a){return new DCI.FeatureGroup(a)};DCI.CarLayer=DCI.Class.extend({initialize:function(a){this.latlngs=a.latlngs;this.interval=a.interval;this.intervalExist=false;this.icon=a.icon},addTo:function(c){this._map=c;this_lineStrConvert=new Array();this.converPath();this_map=this._map;this_eventRunning=false;this._map.on({zoomstart:this.clearMarker,zoomend:this.recovery});this_lastPosition=null;this_lastAngle=0;this_index=0;this_carRun=this.carRun;this_interval=this.interval;this_icon=this.icon;this_ielt10=false;if(DCI.Browser.ie){var a=DCI.Browser.getIEVersion();if(a<10){var b=DCI.Icon.Default.imagePath;if(a==6){b="../../api/dist/images"}if(!b){b="../dist/images"}this_ielt10=true;this_icon=null;this_icon=DCI.icon({iconUrl:b+"/color_wheel.png",iconSize:[16,16]})}}this.intervalExist=true;this_intervalID=setInterval(this_carRun,this_interval)},removeInterval:function(){if(this.intervalExist){clearInterval(this_intervalID);return true}else{if(this._map){return true}}return false},carRun:function(){if(this_eventRunning){return}if(this_index==this_lineStrConvert.length-1){clearInterval(this_intervalID);this.intervalExist=false}var c=this_lineStrConvert[this_index++];this_map.eachLayer(function(d){if(d instanceof DCI.Marker&&d.layer=="carPathLayer"){this_map.removeLayer(d)}});var a=new DCI.marker(c,{icon:this_icon,title:"cars"});a.layer="carPathLayer";this_map.addLayer(a);if(!this_ielt10){var b=0;if(this_lastPosition){b=DCI.calculateAngle(this_lastPosition,c,this_lastAngle)}this_lastAngle=b;this_lastPosition=c;a.setIconAngle(b)}},converPath:function(){var a=this.latlngs;for(var f=0;f<a.length-1;f++){var g=a[f];var d=a[f+1];this_lineStrConvert.push(g);var h=Math.ceil(Math.sqrt(Math.pow(Math.abs(d.lng-g.lng),2)+Math.pow(Math.abs(d.lat-g.lat),2))/10);for(var e=0;e<h;e++){var l=g.lng+((d.lng-g.lng)*(e/h));var k=g.lat+((d.lat-g.lat)*(e/h));var b=new DCI.LatLng(l,k);this_lineStrConvert.push(b)}}},clearMarker:function(a){this_eventRunning=true;this_map.eachLayer(function(b){if(b instanceof DCI.Marker&&b.layer=="carPathLayer"){this_map.removeLayer(b)}})},recovery:function(a){this_eventRunning=false}});DCI.carLayer=function(a){return new DCI.CarLayer(a)};DCI.Path=DCI.Class.extend({includes:[DCI.Mixin.Events],statics:{CLIP_PADDING:(function(){var a=DCI.Browser.mobile?1280:2000,b=(a/Math.max(window.outerWidth,window.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,b))})()},options:{stroke:true,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:0.5,fill:false,fillColor:null,fillOpacity:0.2,clickable:true},initialize:function(a){DCI.setOptions(this,a)},onAdd:function(a){this._map=a;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();if(this._container){this._map._pathRoot.appendChild(this._container)}this.fire("add");a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){a.addLayer(this);return this},onRemove:function(a){a._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(DCI.Browser.vml){this._container=null;this._stroke=null;this._fill=null}a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){DCI.setOptions(this,a);if(this._container){this._updateStyle()}return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});DCI.Map.include({_updatePathViewport:function(){var e=DCI.Path.CLIP_PADDING,d=this.getSize(),b=DCI.DomUtil.getPosition(this._mapPane),c=b.multiplyBy(-1)._subtract(d.multiplyBy(e)._round()),a=c.add(d.multiplyBy(1+e*2)._round());this._pathViewport=new DCI.Bounds(c,a)}});DCI.Path.SVG_NS="http://www.w3.org/2000/svg";DCI.Browser.svg=!!(document.createElementNS&&document.createElementNS(DCI.Path.SVG_NS,"svg").createSVGRect);DCI.Path=DCI.Path.extend({statics:{SVG:DCI.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,b=this._container;if(b&&a.lastChild!==b){a.appendChild(b)}return this},bringToBack:function(){var a=this._map._pathRoot,b=this._container,c=a.firstChild;if(b&&c!==b){a.insertBefore(b,c)}return this},getPathString:function(){},_createElement:function(a){return document.createElementNS(DCI.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");if(this.options.className){DCI.DomUtil.addClass(this._path,this.options.className)}this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}if(this.options.fill){this._path.setAttribute("fill-rule","evenodd")}if(this.options.pointerEvents){this._path.setAttribute("pointer-events",this.options.pointerEvents)}if(!this.options.clickable&&!this.options.pointerEvents){this._path.setAttribute("pointer-events","none")}this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);if(this.options.dashArray){this._path.setAttribute("stroke-dasharray",this.options.dashArray)}else{this._path.removeAttribute("stroke-dasharray")}if(this.options.lineCap){this._path.setAttribute("stroke-linecap",this.options.lineCap)}if(this.options.lineJoin){this._path.setAttribute("stroke-linejoin",this.options.lineJoin)}}else{this._path.setAttribute("stroke","none")}if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else{this._path.setAttribute("fill","none")}},_updatePath:function(){var a=this.getPathString();if(!a){a="M0 0"}this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){if(DCI.Browser.svg||!DCI.Browser.vml){DCI.DomUtil.addClass(this._path,"dci-clickable")}DCI.DomEvent.on(this._container,"click",this._onMouseClick,this);var b=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var a=0;a<b.length;a++){DCI.DomEvent.on(this._container,b[a],this._fireMouseEvent,this)}}},_onMouseClick:function(a){if(this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(a)},_fireMouseEvent:function(d){if(!this.hasEventListeners(d.type)){return}var c=this._map,b=c.mouseEventToContainerPoint(d),a=c.containerPointToLayerPoint(b),f=c.layerPointToLatLng(a);this.fire(d.type,{latlng:f,layerPoint:a,containerPoint:b,originalEvent:d});if(d.type==="contextmenu"){DCI.DomEvent.preventDefault(d)}if(d.type!=="mousemove"){DCI.DomEvent.stopPropagation(d)}}});DCI.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=DCI.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&DCI.Browser.any3d){DCI.DomUtil.addClass(this._pathRoot,"dci-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else{DCI.DomUtil.addClass(this._pathRoot,"dci-zoom-hide")}this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(a){var c=this.getZoomScale(a.zoom),b=this._getCenterOffset(a.center)._multiplyBy(-c)._add(this._pathViewport.min);this._pathRoot.style[DCI.DomUtil.TRANSFORM]=DCI.DomUtil.getTranslateString(b)+" scale("+c+") ";this._pathZooming=true},_endPathZoom:function(){this._pathZooming=false},_updateSvgViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var d=this._pathViewport,e=d.min,b=d.max,f=b.x-e.x,a=b.y-e.y,c=this._pathRoot,g=this._panes.overlayPane;if(DCI.Browser.mobileWebkit){g.removeChild(c)}DCI.DomUtil.setPosition(c,e);c.setAttribute("width",f);c.setAttribute("height",a);c.setAttribute("viewBox",[e.x,e.y,f,a].join(" "));if(DCI.Browser.mobileWebkit){g.appendChild(c)}}});DCI.Path.include({bindPopup:function(b,a){if(b instanceof DCI.Popup){this._popup=b}else{if(!this._popup||a){this._popup=new DCI.Popup(a,this)}this._popup.setContent(b)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=false}return this},openPopup:function(a){if(this._popup){a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:a})}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},_openPopup:function(a){this._popup.setLatLng(a.latlng);this._map.openPopup(this._popup)}});DCI.Browser.vml=!DCI.Browser.svg&&(function(){try{var c=document.createElement("div");c.innerHTML='<v:shape adj="1"/>';var a=c.firstChild;a.style.behavior="url(#default#VML)";return a&&(typeof a.adj==="object")}catch(b){return false}}());DCI.Path=DCI.Browser.svg||!DCI.Browser.vml?DCI.Path:DCI.Path.extend({statics:{VML:true,CLIP_PADDING:0.02},_createElement:(function(){try{document.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(b){return document.createElement("<lvml:"+b+' class="lvml">')}}catch(a){return function(b){return document.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),_initPath:function(){var a=this._container=this._createElement("shape");DCI.DomUtil.addClass(a,"dci-vml-shape"+(this.options.className?" "+this.options.className:""));if(this.options.clickable){DCI.DomUtil.addClass(a,"dci-clickable")}a.coordsize="1 1";this._path=this._createElement("path");a.appendChild(this._path);this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var d=this._stroke,c=this._fill,b=this.options,a=this._container;a.stroked=b.stroke;a.filled=b.fill;if(b.stroke){if(!d){d=this._stroke=this._createElement("stroke");d.endcap="round";a.appendChild(d)}d.weight=b.weight+"px";d.color=b.color;d.opacity=b.opacity;if(b.dashArray){d.dashStyle=DCI.Util.isArray(b.dashArray)?b.dashArray.join(" "):b.dashArray.replace(/( *, *)/g," ")}else{d.dashStyle=""}if(b.lineCap){d.endcap=b.lineCap.replace("butt","flat")}if(b.lineJoin){d.joinstyle=b.lineJoin}}else{if(d){a.removeChild(d);this._stroke=null}}if(b.fill){if(!c){c=this._fill=this._createElement("fill");a.appendChild(c)}c.color=b.fillColor||b.color;c.opacity=b.fillOpacity}else{if(c){a.removeChild(c);this._fill=null}}},_updatePath:function(){var a=this._container.style;a.display="none";this._path.v=this.getPathString()+" ";a.display=""}});DCI.Map.include(DCI.Browser.svg||!DCI.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot){return}var a=this._pathRoot=document.createElement("div");a.className="dci-vml-container";this._panes.overlayPane.appendChild(a);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});(function(){L_PREFER_CANVAS=true;function a(){var b=document.getElementsByTagName("script");for(var d=0;d<b.length;d++){var e=b[d].src;if(e){var c=e.match(/^(.*)dmap\.js$/);if(c){return c[1]}}}}DCI_LOCATION=a();document.writeln('<script defer>DCI.Icon.Default.imagePath = "'+DCI_LOCATION+'../api/dist/images";<\/script>')})();function getRandomLatLng(f){var e=f.getBounds(),c=e.getSouthWest(),a=e.getNorthEast(),b=a.lng-c.lng,d=a.lat-c.lat;return new DCI.LatLng(c.lat+d*Math.random(),c.lng+b*Math.random())}function logEvent(a){console.log(a.type)}DCI.Browser.canvas=(function(){return !!document.createElement("canvas").getContext}());DCI.Path=(DCI.Path.SVG&&!window.L_PREFER_CANVAS)||!DCI.Browser.canvas?DCI.Path:DCI.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(a){DCI.setOptions(this,a);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this.fire("remove");this._map=null},_requestUpdate:function(){if(this._map&&!DCI.Path._updateRequest){DCI.Path._updateRequest=DCI.Util.requestAnimFrame(this._fireMapMoveEnd,this._map)}},_fireMapMoveEnd:function(){DCI.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;if(a.stroke){this._ctx.lineWidth=a.weight;this._ctx.strokeStyle=a.color;if(a.dashArray&&this._ctx.setLineDash){this._ctx.setLineDash(a.dashArray)}}if(a.fill){this._ctx.fillStyle=a.fillColor||a.color}},_drawPath:function(){var f,e,b,c,a,d;this._ctx.beginPath();for(f=0,b=this._parts.length;f<b;f++){for(e=0,c=this._parts[f].length;e<c;e++){a=this._parts[f][e];d=(e===0?"move":"line")+"To";this._ctx[d](a.x,a.y)}if(this instanceof DCI.Polygon){this._ctx.closePath()}}},_drawDashPath:function(){var c,b;var a=this.options.dashArray;this._ctx.beginPath();for(i=0,len=this._parts.length;i<len;i++){for(j=0,len2=this._parts[i].length;j<len2-1;j++){c=this._parts[i][j];b=this._parts[i][j+1];this.dashedLineTo(c.x,c.y,b.x,b.y,a)}if(this instanceof DCI.Polygon){c=this._parts[i][len2-1];b=this._parts[i][0];this.dashedLineTo(c.x,c.y,b.x,b.y,a)}}},dashedLineTo:function(u,s,b,a,c){var z=0;if(c==null||c.length==0){z=5}else{for(var v=0;v<c.length;v++){z+=parseFloat(c[v])}}var q=(b-u);var o=(a-s);var d=Math.floor(Math.sqrt(q*q+o*o));var g=(z<=0)?d:(d/z);var y=(o/d)*z;var n=(q/d)*z;if(c.length==1){for(var x=0;x<g;x++){if(x%2){this._ctx.lineTo(u+x*n,s+x*y)}else{this._ctx.moveTo(u+x*n,s+x*y)}}}else{for(var x=0;x<g;x++){var A=0,e=0,f=0;for(var r=0;r<c.length;r++){var m=n*x+f;var l=y*x+e;var w=Math.floor(Math.sqrt(m*m+l*l));var k=u+m;var h=s+l;if(w>d){k=b;h=a}if(r%2){this._ctx.lineTo(k,h)}else{this._ctx.moveTo(k,h)}A+=c[r];e=(o/d)*A;f=(q/d)*A}}}},_checkIfEmpty:function(){return !this._parts.length},_updatePath:function(){if(this._checkIfEmpty()){return}var a=this._ctx,b=this.options;if(b.dashArray&&!this._ctx.setLineDash){this._drawDashPath()}else{this._drawPath()}a.save();this._updateStyle();if(b.fill){a.globalAlpha=b.fillOpacity;a.fill()}if(b.stroke){a.globalAlpha=b.opacity;a.stroke()}if(b.dashArray&&!this._ctx.setLineDash){this._drawPath();if(b.fill){a.globalAlpha=b.fillOpacity;a.fill()}}a.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_initEvents_self:function(){if(this.options.clickable){this._map.on("mousedown",this._onMouseDown_self,this);this._map.on("mouseup",this._onMouseUp_self,this)}},_onClick:function(a){if(this._containsPoint(a.layerPoint)){this.fire("click",a)}},_onMouseMove:function(a){if(!this._map||this._map._animatingZoom){return}if(this._containsPoint(a.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=true;this.fire("mouseover",a)}else{if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=false;this.fire("mouseout",a)}}},_onMouseDown_self:function(a){if(this._containsPoint(a.layerPoint)){this.fire("mousedown",a)}},_onMouseMove_self:function(a){if(this._containsPoint(a.layerPoint)){this.fire("mousemove",a)}},_onMouseUp_self:function(a){if(this._containsPoint(a.layerPoint)){this.fire("mouseup",a)}}});DCI.Map.include((DCI.Path.SVG&&!window.L_PREFER_CANVAS)||!DCI.Browser.canvas?{}:{_initPathRoot:function(){var b=this._pathRoot,a;if(!b){b=this._pathRoot=document.createElement("canvas");b.style.position="absolute";a=this._canvasCtx=b.getContext("2d");a.lineCap="round";a.lineJoin="round";this._panes.overlayPane.appendChild(b);if(this.options.zoomAnimation){this._pathRoot.className="dci-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var b=this._pathViewport,d=b.min,c=b.max.subtract(d),a=this._pathRoot;DCI.DomUtil.setPosition(a,d);a.width=c.x;a.height=c.y;a.getContext("2d").translate(-d.x,-d.y)},_getElement:function(){return this._pathRoot}});DCI.LineUtil={simplify:function(c,a){if(!a||!c.length){return c.slice()}var b=a*a;c=this._reducePoints(c,b);c=this._simplifyDP(c,b);return c},pointToSegmentDistance:function(b,c,a){return Math.sqrt(this._sqClosestPointOnSegment(b,c,a,true))},closestPointOnSegment:function(b,c,a){return this._sqClosestPointOnSegment(b,c,a)},_simplifyDP:function(e,b){var a=e.length,d=typeof Uint8Array!==undefined+""?Uint8Array:Array,g=new d(a);g[0]=g[a-1]=1;this._simplifyDPStep(e,g,b,0,a-1);var c,f=[];for(c=0;c<a;c++){if(g[c]){f.push(e[c])}}return f},_simplifyDPStep:function(k,b,a,f,h){var c=0,g,d,e;for(d=f+1;d<=h-1;d++){e=this._sqClosestPointOnSegment(k[d],k[f],k[h],true);if(e>c){g=d;c=e}}if(c>a){b[g]=1;this._simplifyDPStep(k,b,a,f,g);this._simplifyDPStep(k,b,a,g,h)}},_reducePoints:function(d,b){var f=[d[0]];for(var c=1,e=0,a=d.length;c<a;c++){if(this._sqDist(d[c],d[e])>b){f.push(d[c]);e=c}}if(e<a-1){f.push(d[a-1])}return f},clipSegment:function(l,k,c,m){var g=m?this._lastCode:this._getBitCode(l,c),e=this._getBitCode(k,c),f,d,h;this._lastCode=e;while(true){if(!(g|e)){return[l,k]}else{if(g&e){return false}else{f=g||e;d=this._getEdgeIntersection(l,k,f,c);h=this._getBitCode(d,c);if(f===g){l=d;g=h}else{k=d;e=h}}}}},_getEdgeIntersection:function(f,d,l,k){var g=d.x-f.x,e=d.y-f.y,h=k.min,c=k.max;if(l&8){return new DCI.Point(f.x+g*(c.y-f.y)/e,c.y)}else{if(l&4){return new DCI.Point(f.x+g*(h.y-f.y)/e,h.y)}else{if(l&2){return new DCI.Point(c.x,f.y+e*(c.x-f.x)/g)}else{if(l&1){return new DCI.Point(h.x,f.y+e*(h.x-f.x)/g)}}}}},_getBitCode:function(c,b){var a=0;if(c.x<b.min.x){a|=1}else{if(c.x>b.max.x){a|=2}}if(c.y<b.min.y){a|=4}else{if(c.y>b.max.y){a|=8}}return a},_sqDist:function(d,c){var b=c.x-d.x,a=c.y-d.y;return b*b+a*a},_sqClosestPointOnSegment:function(b,g,f,c){var e=g.x,d=g.y,l=f.x-e,k=f.y-d,a=l*l+k*k,h;if(a>0){h=((b.x-e)*l+(b.y-d)*k)/a;if(h>1){e=f.x;d=f.y}else{if(h>0){e+=l*h;d+=k*h}}}l=b.x-e;k=b.y-d;return c?l*l+k*k:new DCI.Point(e,d)}};DCI.Polyline=DCI.Path.extend({initialize:function(a,b){DCI.Path.prototype.initialize.call(this,b);this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var b=0,a=this._latlngs.length;b<a;b++){this._originalPoints[b]=this._map.latLngToLayerPoint(this._latlngs[b])}},getPathString:function(){for(var b=0,a=this._parts.length,c="";b<a;b++){c+=this._getPathPartStr(this._parts[b])}return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){this._latlngs=this._convertLatLngs(a);return this.redraw()},addLatLng:function(a){this._latlngs.push(DCI.latLng(a));return this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return a},closestLayerPoint:function(a){var k=Infinity,b=this._parts,m,l,g=null;for(var c=0,n=b.length;c<n;c++){var h=b[c];for(var d=1,f=h.length;d<f;d++){m=h[d-1];l=h[d];var e=DCI.LineUtil._sqClosestPointOnSegment(a,m,l,true);if(e<k){k=e;g=DCI.LineUtil._sqClosestPointOnSegment(a,m,l)}}}if(g){g.distance=Math.sqrt(k)}return g},getBounds:function(){return new DCI.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(b,c){var d,a,e=c?b:[];for(d=0,a=b.length;d<a;d++){if(DCI.Util.isArray(b[d])&&typeof b[d][0]!=="number"){return}e[d]=DCI.latLng(b[d])}return e},_initEvents:function(){DCI.Path.prototype._initEvents.call(this)},_getPathPartStr:function(d){var b=DCI.Path.VML;for(var c=0,a=d.length,f="",e;c<a;c++){e=d[c];if(b){e._round()}f+=(c?"L":"M")+e.x+" "+e.y}return f},_clipPoints:function(){var e=this._originalPoints,a=e.length,d,c,f;if(this.options.noClip){this._parts=[e];return}this._parts=[];var g=this._parts,b=this._map._pathViewport,h=DCI.LineUtil;for(d=0,c=0;d<a-1;d++){f=h.clipSegment(e[d],e[d+1],b,d);if(!f){continue}g[c]=g[c]||[];g[c].push(f[0]);if((f[1]!==e[d+1])||(d===a-2)){g[c].push(f[1]);c++}}},_simplifyPoints:function(){var c=this._parts,d=DCI.LineUtil;for(var b=0,a=c.length;b<a;b++){c[b]=d.simplify(c[b],this.options.smoothFactor)}},_updatePath:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();DCI.Path.prototype._updatePath.call(this)},gml:function(){var a=this._latlngs;var c="";for(var b=0;b<a.length;b++){c+=a[b].lng+","+a[b].lat+" "}c=c.substr(0,c.length-1);return"<MultiLineString><lineStringMember><LineString><coordinates>"+c+"</coordinates></LineString></lineStringMember></MultiLineString>"},getPathLength:function(){var b=[];for(var c=0;c<this._latlngs.length;c++){b[c]=this._latlngs[c].clone()}if(this._map.options.crs.code=="EPSG:990001"){for(var c=0;c<b.length;c++){b[c]=new DCI.point([b[c].lng,b[c].lat])}}var a=0;for(var c=0;c<b.length-1;c++){a+=b[c+1].distanceTo(b[c])}return a}});DCI.polyline=function(a,b){return new DCI.Polyline(a,b)};DCI.Polyline.include({initEditor:function(a){$thispl=this;plspoints=null;plslatlngs=a;pl_pEditstate=false;pl_img_catch=null;pl_rubberlineGraph=null;if(this.options.clickable){this._map.on("mousemove",function(c){if(this._containsPoint&&this._containsPoint(c.layerPoint)){this.fire("mousemove",c)}else{var b=this.getBounds();if(b.contains(c.latlng)){this.fire("mousemove",c)}}},this)}},createMenu:function(){var a;a=document.createElement("div");a.id="div_imgRightMenu";a.style.zIndex="3";a.style.textAligh="left";a.style.cursor="default";a.style.position="absolute";a.style.backgroundColor="#FAFFF8";a.style.width="75px";a.style.height="auto";a.style.border="1px solid gray";a.style.paddingLeft="10px";a.style.paddingTop="2px";a.style.display="none";a.style.fontSize="9pt";a.innerHTML="删除节点";$thispl.menuelement=a},mapClickCallback:function(a){if($thispl.menuelement){$thispl.menuelement.style.display="none"}if(plnodeImageDIV&&pl_pEditstate==false){plnodeImageDIV.style.display="none"}pl_pEditstate=false},getVertexCount:function(){var a=this.fromStringToLatLngArray(plslatlngs);return a.length},insertVertex:function(b,e){var d=this.fromStringToLatLngArray(plslatlngs);var c=[];for(var a=0;a<b;a++){c.push(d[a])}c.push(e);for(var a=b;a<d.length;a++){c.push(d[a])}$thispl.points=c;plslatlngs=c.join(",");$thispl.updatePosition();pl_pEditstate=true;plnodeImageDIV.style.display=""},deleteVertex:function(b){var d=[];var c=this.fromStringToLatLngArray(plslatlngs);if(b>0){for(var a=0;a<b;a++){d.push(c[a])}}if(b<c.length){for(var a=b+1;a<c.length;a++){d.push(c[a])}}if(d.length<=1){d=[]}$thispl.points=d;plslatlngs=d.join(",");$thispl.updatePosition(true);pl_pEditstate=true;plnodeImageDIV.style.display=""},getVertex:function(a){var b=this.fromStringToLatLngArray(plslatlngs);return b[a]},fromStringToLatLngArray:function(f){if(typeof(f)=="string"){var e=[];if(f==""){return e}f=f.substr(0,f.length-1);var h=f.split("),");for(var b=0;b<h.length;b++){var d=h[b].replace("LatLng(","");var a=d.split(",");var g=new DCI.LatLng(a[0],a[1]);e.push(g)}return e}else{return f}},enableEditing:function(){plnodeImageDIV=document.getElementById("nodeImageDIV");var a=this._map.getSize();plnodeImageDIV.style.width=a.x+"px";plnodeImageDIV.style.height=a.y+"px";DCI.DomEvent.on(this,"click",this.polyline_click);DCI.DomEvent.on(this._map,"click",this.mapClickCallback);DCI.DomEvent.on(this._map,"zoomend",this.mapZoomEnd);DCI.DomEvent.on(this._map,"dragstart",this.mapDragStart);DCI.DomEvent.on(this._map,"dragend",this.mapDragEnd);this.enableEdit=true;this.updatePosition()},disableEditing:function(){if(!plnodeImageDIV){return}DCI.DomEvent.off(this,"click",this.polyline_click);DCI.DomEvent.off(this,"mousemove",this.polyline_mousemove);DCI.DomEvent.off(this._map,"click",this.mapClickCallback);DCI.DomEvent.off(this._map,"zoomend",this.mapZoomEnd);DCI.DomEvent.off(this._map,"dragstart",this.mapDragStart);DCI.DomEvent.off(this._map,"dragend",this.mapDragEnd);plnodeImageDIV.style.display="none";this.updatePosition();this.enableEdit=false},mapZoomEnd:function(a){$thispl.updatePosition()},mapDragEnd:function(a){$thispl.updatePosition()},mapDragStart:function(a){if($thispl.menuelement){$thispl.menuelement.style.display="none"}if(plnodeImageDIV){plnodeImageDIV.style.display="none"}},polyline_click:function(c){DCI.DomEvent.on($thispl,"mousemove",$thispl.polyline_mousemove);var a=c||window.Event;if(DCI.Browser.ie){window.event.cancelBubble=true}else{a.originalEvent.cancelBubble=true;DCI.DomEvent.stop(a)}plnodeImageDIV.style.display=""},polyline_mousemove:function(b){b=b||window.Event;var d=b.latlng;var q=$thispl._map.latLngToContainerPoint(d);if(!pl_img_catch){pl_img_catch=document.createElement("div");pl_img_catch.style.position="absolute";pl_img_catch.style.width="13px";pl_img_catch.style.height="13px";pl_img_catch.style.fontSize="5px";pl_img_catch.style.backgroundColor="#F0ff00";pl_img_catch.style.border="1px solid gray";pl_img_catch.style.zIndex=-1;if(!DCI.Browser.canvas){pl_img_catch.style["z-index"]=2}}var c=plspoints;var k=-3;var l=0;var r;var p=new DMath();function e(){pl_img_catch.style.display="none"}function f(){pl_img_catch.style.display=""}function n(){pl_img_catch.style.display=""}function a(){var t=new DCI.point(parseInt(pl_img_catch.x),parseInt(pl_img_catch.y));var s=$thispl._map.containerPointToLatLng(t);$thispl.insertVertex(k+1,s)}if(pl_img_catch){pl_img_catch.onclick=a;pl_img_catch.onmouseout=e;pl_img_catch.onmouseover=n}for(var h=0;h<c.length-1;h++){var g=p.CalculateThreePoint(c[h].x,c[h].y,c[h+1].x,c[h+1].y,q.x,q.y,10);if(g==3){k=h;var m=p.verPToALine(c[h].x,c[h].y,c[h+1].x,c[h+1].y,q.x,q.y);var o=p.CalculateDis4(q.x,q.y,m.x,m.y);if(l>0&&o<l){l=o}r=m}else{if(g==1){k=h;var m=c[h];var o=p.CalculateDis4(q.x,q.y,m.x,m.y);if(l>0&&o<l){l=o}r=m}else{if(g==2){k=h;var m=c[h+1];var o=p.CalculateDis4(q.x,q.y,m.x,m.y);r=m}else{if(pl_img_catch){pl_img_catch.style.display="none"}}}}}if(r){plnodeImageDIV.appendChild(pl_img_catch);pl_img_catch.style.display="";pl_img_catch.style.top=(r.y-6)+"px";pl_img_catch.style.left=(r.x-6)+"px";pl_img_catch.y=r.y;pl_img_catch.x=r.x}},updatePosition:function(){if(this.enableEdit==false){return}var e=this.fromStringToLatLngArray(plslatlngs);$thispl.setLatLngs(e);var c=[];for(var b=0;b<e.length;b++){var a=$thispl._map.latLngToContainerPoint(e[b]);c.push(a)}plspoints=c;while(plnodeImageDIV.childNodes.length>0){plnodeImageDIV.removeChild(plnodeImageDIV.childNodes[0])}plnodeImageDIV.style.position="absolute";plnodeImageDIV.style.zIndex=10;if(!DCI.Browser.canvas){plnodeImageDIV.style["z-index"]=10}plnodeImageDIV.style.zoom=1;plnodeImageDIV.style.display="none";for(var b=0;b<c.length;b++){var f=document.createElement("div");d(f,b)}function d(h){h.arrayposition=b;h.style.width="11px";h.style.height="11px";h.style.fontSize="5px";h.style.backgroundColor="#CCffcc";h.style.border="1px solid gray";h.style.zIndex=0;if(!DCI.Browser.canvas){h.style["z-index"]=6}h.title="拖拽此点";h.style.position="absolute";var l=c[b];h.style.top=(l.y-5)+"px";h.style.left=(l.x-5)+"px";h.onmouseover=k;h.onmouseout=p;h.onmousedown=m;plnodeImageDIV.appendChild(h);function m(r){r=r||window.event;if(h.setCapture){h.setCapture()}plnodeImageDIV.style.display="";var q=0;q=r.button;if(q==2){h.oncontextmenu=n}else{$thispl._map.dragging.disable();document.onmousemove=o;document.onmouseup=g}return false}function o(r){r=r||window.event;var u=$thispl._map.mouseEventToLatLng(r);h.style.cursor="pointer";!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();var t=0;t=1;if(t==1){if(pl_rubberlineGraph){$thispl._map.removeLayer(pl_rubberlineGraph);pl_rubberlineGraph=null}var q=h.arrayposition;if(q==0){pl_rubberlineGraph=new DCI.Polyline([u,e[h.arrayposition+1]],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}else{if(q==e.length-1){pl_rubberlineGraph=new DCI.Polyline([e[h.arrayposition-1],u],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}else{pl_rubberlineGraph=new DCI.Polyline([e[h.arrayposition-1],u,e[h.arrayposition+1]],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}}$thispl._map.addLayer(pl_rubberlineGraph)}var s=$thispl._map.latLngToContainerPoint(u);h.style.top=s.y-5+"px";h.style.left=s.x-5+"px";if(pl_img_catch){pl_img_catch.style.display="none"}}function g(q){q=q||window.event;h.onmouseover=k;var r=0;r=1;if(r==1){if(pl_rubberlineGraph){$thispl._map.removeLayer(pl_rubberlineGraph);pl_rubberlineGraph=null}var s=$thispl._map.mouseEventToLatLng(q);e[h.arrayposition]=s;plslatlngs=e;$thispl.points=plslatlngs;$thispl.setLatLngs(plslatlngs);$thispl.updatePosition()}document.onmousemove="";document.onmouseup="";plnodeImageDIV.style.display="";$thispl._map.dragging.enable()}function n(r){var q=$thispl.getVertexCount();if(q==2){alert("不少于两个点");return}r=r||window.event;if(!$thispl.menuelement){$thispl.createMenu()}if(plnodeImageDIV){plnodeImageDIV.appendChild($thispl.menuelement)}DCI.DomEvent.on($thispl._map,"click",function(){if($thispl.menuelement){$thispl.menuelement.style.display="none"}},this);$thispl.menuelement.onmousedown=u;function u(v){$thispl.menuelement.style.display="none";$thispl.deleteVertex(h.arrayposition);$thispl.menuelement.onmousedown=""}var t=$thispl.menuelement;t.style.display="";var s=$thispl._map.mouseEventToContainerPoint(r);t.style.left=s.x+5+"px";t.style.top=s.y+5+"px";if(document.releaseCapture){document.releaseCapture()}return false}function k(q){plnodeImageDIV.style.display="";if(pl_img_catch){pl_img_catch.style.display="";pl_img_catch.style.top=parseInt(h.style.top)-1+"px";pl_img_catch.style.left=parseInt(h.style.left)-1+"px"}}function p(q){plnodeImageDIV.style.display="";if(pl_img_catch){pl_img_catch.style.display="none"}}}}});DCI.PolyUtil={};DCI.PolyUtil.clipPolygon=function(s,c){var o,l=[1,4,2,8],m,h,g,r,q,n,e,d,f=DCI.LineUtil;for(m=0,n=s.length;m<n;m++){s[m]._code=f._getBitCode(s[m],c)}for(g=0;g<4;g++){e=l[g];o=[];for(m=0,n=s.length,h=n-1;m<n;h=m++){r=s[m];q=s[h];if(!(r._code&e)){if(q._code&e){d=f._getEdgeIntersection(q,r,e,c);d._code=f._getBitCode(d,c);o.push(d)}o.push(r)}else{if(!(q._code&e)){d=f._getEdgeIntersection(q,r,e,c);d._code=f._getBitCode(d,c);o.push(d)}}}s=o}return s};DCI.Polygon=DCI.Polyline.extend({options:{fill:true},initialize:function(a,b){DCI.Polyline.prototype.initialize.call(this,a,b);this._initWithHoles(a)},_initWithHoles:function(b){var c,a,d;if(b&&DCI.Util.isArray(b[0])&&(typeof b[0][0]!=="number")){this._latlngs=this._convertLatLngs(b[0]);this._holes=b.slice(1);for(c=0,a=this._holes.length;c<a;c++){d=this._holes[c]=this._convertLatLngs(this._holes[c]);if(d[0].equals(d[d.length-1])){d.pop()}}}b=this._latlngs;if(b.length>=2&&b[0].equals(b[b.length-1])){b.pop()}},projectLatlngs:function(){DCI.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes){return}var d,c,a,b;for(d=0,a=this._holes.length;d<a;d++){this._holePoints[d]=[];for(c=0,b=this._holes[d].length;c<b;c++){this._holePoints[d][c]=this._map.latLngToLayerPoint(this._holes[d][c])}}},setLatLngs:function(a){if(a&&DCI.Util.isArray(a[0])&&(typeof a[0][0]!=="number")){this._initWithHoles(a);return this.redraw()}else{return DCI.Polyline.prototype.setLatLngs.call(this,a)}},_clipPoints:function(){var d=this._originalPoints,e=[];this._parts=[d].concat(this._holePoints);if(this.options.noClip){return}for(var c=0,b=this._parts.length;c<b;c++){var a=DCI.PolyUtil.clipPolygon(this._parts[c],this._map._pathViewport);if(a.length){e.push(a)}}this._parts=e},_getPathPartStr:function(a){var b=DCI.Polyline.prototype._getPathPartStr.call(this,a);return b+(DCI.Browser.svg?"z":"x")},gml:function(){var a=this._latlngs;var c="";for(var b=0;b<a.length;b++){c+=a[b].lng+" "+a[b].lat+" "}c+=a[0].lng+" "+a[0].lat;return"<Polygon><exterior><LinearRing><posList>"+c+"</posList></LinearRing></exterior></Polygon>"},getSphericalArea:function(){var e=[],d=[];var b=Math.PI/180;if(this._map.options.crs.code=="EPSG:990001"){b=1}for(var a=0;a<this._latlngs.length;a++){e[a]=this._latlngs[a].lat*b;d[a]=this._latlngs[a].lng*b}var c=DMath.SphericalPolygonArea(d,e,true);return c}});DCI.polygon=function(a,b){return new DCI.Polygon(a,b)};DCI.Polygon.include({initEditor:function(a){$thispg=this;pgspoints=null;pgslatlngs=a;pg_pEditstate=false;pg_img_catch=null;pg_rubberpolygonGraph=null;if(this.options.clickable){this._map.on("mousemove",function(c){if(this._containsPoint&&this._containsPoint(c.layerPoint)){this.fire("mousemove",c)}else{var b=this.getBounds();if(b.contains(c.latlng)){this.fire("mousemove",c)}}},this)}},createMenu:function(){var a;a=document.createElement("div");a.id="div_imgRightMenu";a.style.zIndex=3;if(!DCI.Browser.canvas){a.style["z-index"]=3}a.style.textAligh="left";a.style.cursor="default";a.style.position="absolute";a.style.backgroundColor="#FAFFF8";a.style.width="75px";a.style.height="auto";a.style.border="1px solid gray";a.style.paddingLeft="10px";a.style.paddingTop="2px";a.style.display="none";a.style.fontSize="9pt";a.innerHTML="删除节点";$thispg.menuelement=a},mapClickCallback:function(a){if($thispg.menuelement){$thispg.menuelement.style.display="none"}if(pgnodeImageDIV&&pg_pEditstate==false){pgnodeImageDIV.style.display="none"}pg_pEditstate=false},getVertexCount:function(){var a=this.fromStringToLatLngArray(pgslatlngs);return a.length},insertVertex:function(b,e){var d=this.fromStringToLatLngArray(pgslatlngs);var c=[];for(var a=0;a<b;a++){c.push(d[a])}c.push(e);for(var a=b;a<d.length;a++){c.push(d[a])}$thispg.points=c;pgslatlngs=c.join(",");$thispg.updatePosition();pg_pEditstate=true;pgnodeImageDIV.style.display=""},deleteVertex:function(b){var d=[];var c=this.fromStringToLatLngArray(pgslatlngs);if(b>0){for(var a=0;a<b;a++){d.push(c[a])}}if(b<c.length){for(var a=b+1;a<c.length;a++){d.push(c[a])}}if(d.length<3){d=[]}$thispg.points=d;pgslatlngs=d.join(",");$thispg.updatePosition(true);pg_pEditstate=true;pgnodeImageDIV.style.display=""},getVertex:function(a){var b=this.fromStringToLatLngArray(pgslatlngs);return b[a]},fromStringToLatLngArray:function(f){if(typeof(f)=="string"){var e=[];if(f==""){return e}f=f.substr(0,f.length-1);var h=f.split("),");for(var b=0;b<h.length;b++){var d=h[b].replace("LatLng(","");var a=d.split(",");var g=new DCI.LatLng(a[0],a[1]);e.push(g)}return e}else{return f}},enableEditing:function(){pgnodeImageDIV=document.getElementById("nodeImageDIV");var a=this._map.getSize();pgnodeImageDIV.style.width=a.x+"px";pgnodeImageDIV.style.height=a.y+"px";DCI.DomEvent.on(this,"click",this.polygon_click);DCI.DomEvent.on(this._map,"click",this.mapClickCallback);DCI.DomEvent.on(this._map,"zoomend",this.mapZoomEnd);DCI.DomEvent.on(this._map,"dragstart",this.mapDragStart);DCI.DomEvent.on(this._map,"dragend",this.mapDragEnd);this.enableEdit=true;this.updatePosition()},disableEditing:function(){if(!pgnodeImageDIV){return}DCI.DomEvent.off(this,"click",this.polygon_click);DCI.DomEvent.off(this,"mousemove",this.polygon_mousemove);DCI.DomEvent.off(this._map,"click",this.mapClickCallback);DCI.DomEvent.off(this._map,"zoomend",this.mapZoomEnd);DCI.DomEvent.off(this._map,"dragstart",this.mapDragStart);DCI.DomEvent.off(this._map,"dragend",this.mapDragEnd);pgnodeImageDIV.style.display="none";this.updatePosition();this.enableEdit=false},mapZoomEnd:function(a){$thispg.updatePosition()},mapDragEnd:function(a){$thispg.updatePosition()},mapDragStart:function(a){if($thispg.menuelement){$thispg.menuelement.style.display="none"}if(pgnodeImageDIV){pgnodeImageDIV.style.display="none"}},polygon_click:function(c){DCI.DomEvent.on($thispg,"mousemove",$thispg.polygon_mousemove);pgnodeImageDIV.style.display="";var a=c||window.Event;if(DCI.Browser.ie){window.event.cancelBubble=true}else{a.originalEvent.cancelBubble=true;DCI.DomEvent.stop(a)}},polygon_mousemove:function(p){p=p||window.Event;var f=p.latlng;var n=$thispg._map.latLngToContainerPoint(f);if(!pg_img_catch){pg_img_catch=document.createElement("div");pg_img_catch.style.width="13px";pg_img_catch.style.height="13px";pg_img_catch.style.fontSize="5px";pg_img_catch.style.backgroundColor="#F0ff00";pg_img_catch.style.border="1px solid gray";pg_img_catch.style.zIndex=3;if(!DCI.Browser.canvas){pg_img_catch.style["z-index"]=3}pg_img_catch.style.position="absolute"}var k=pgspoints;var d=-3;var r=0;var l;var o=new DMath();function c(){pg_img_catch.style.display="none"}function t(){pg_img_catch.style.display=""}function b(){pg_img_catch.style.display=""}function m(){var v=new DCI.point(parseInt(pg_img_catch.x),parseInt(pg_img_catch.y));var u=$thispg._map.containerPointToLatLng(v);$thispg.insertVertex(d+1,u);if(window.event){window.event.cancelBubble=false}}function e(){pg_img_catch.style.display="";if(pgnodeImageDIV){pgnodeImageDIV.style.display=""}}if(pg_img_catch){pg_img_catch.onclick=m;pg_img_catch.onmouseout=c;pg_img_catch.onmouseover=b;pg_img_catch.onmouseup=e}for(var q=0;q<k.length;q++){var g;if(q<k.length-1){g=k[q+1]}else{g=k[0]}var a=o.CalculateThreePoint(k[q].x,k[q].y,g.x,g.y,n.x,n.y,10);if(a==3){d=q;var s=o.verPToALine(k[q].x,k[q].y,g.x,g.y,n.x,n.y);var h=o.CalculateDis4(n.x,n.y,s.x,s.y);if(r>0&&h<r){r=h}l=s}else{if(a==1){d=q;var s=k[q];var h=o.CalculateDis4(n.x,n.y,s.x,s.y);if(r>0&&h<r){r=h}l=s}else{if(a==2){d=q;var s=g;var h=o.CalculateDis4(n.x,n.y,s.x,s.y);l=s}else{if(pg_img_catch){pg_img_catch.style.display="none"}}}}}if(l){pgnodeImageDIV.appendChild(pg_img_catch);pg_img_catch.style.display="";pg_img_catch.style.top=(l.y-6)+"px";pg_img_catch.style.left=(l.x-6)+"px";pg_img_catch.y=l.y;pg_img_catch.x=l.x}},updatePosition:function(){if(this.enableEdit==false){return}var e=this.fromStringToLatLngArray(pgslatlngs);$thispg.setLatLngs(e);var c=[];for(var b=0;b<e.length;b++){var a=$thispg._map.latLngToContainerPoint(e[b]);c.push(a)}pgspoints=c;while(pgnodeImageDIV.childNodes.length>0){pgnodeImageDIV.removeChild(pgnodeImageDIV.childNodes[0])}pgnodeImageDIV.style.position="absolute";pgnodeImageDIV.style.zIndex=10;if(!DCI.Browser.canvas){pgnodeImageDIV.style["z-index"]=10}pgnodeImageDIV.style.zoom=1;pgnodeImageDIV.style.display="none";for(var b=0;b<c.length;b++){var f=document.createElement("div");d(f,b)}function d(h){h.arrayposition=b;h.style.width="11px";h.style.height="11px";h.style.fontSize="5px";h.style.backgroundColor="#CCffcc";h.style.border="1px solid gray";h.style.zIndex=4;if(!DCI.Browser.canvas){h.style["z-index"]=4}h.title="拖拽此点";h.style.position="absolute";var l=c[b];h.style.top=(l.y-5)+"px";h.style.left=(l.x-5)+"px";h.onmouseover=k;h.onmouseout=p;h.onmousedown=m;pgnodeImageDIV.appendChild(h);function m(r){r=r||window.event;if(h.setCapture){h.setCapture()}pgnodeImageDIV.style.display="";var q=0;q=r.button;if(q==2){h.oncontextmenu=n}else{$thispg._map.dragging.disable();document.onmousemove=o;document.onmouseup=g}return false}function o(r){r=r||window.event;var u=$thispg._map.mouseEventToLatLng(r);h.style.cursor="pointer";!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();var t=0;t=1;if(t==1){if(pg_rubberpolygonGraph){$thispg._map.removeLayer(pg_rubberpolygonGraph);pg_rubberpolygonGraph=null}var q=h.arrayposition;if(q==0){pg_rubberpolygonGraph=new DCI.Polygon([e[1],u,e[e.length-1]],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}else{if(q==e.length-1){pg_rubberpolygonGraph=new DCI.Polygon([e[0],u,e[e.length-2]],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}else{pg_rubberpolygonGraph=new DCI.Polygon([e[h.arrayposition-1],u,e[h.arrayposition+1]],{color:"#9ed2f3",weight:3,opacity:0.8,dashArray:[5,5]})}}$thispg._map.addLayer(pg_rubberpolygonGraph)}var s=$thispg._map.latLngToContainerPoint(u);h.style.top=s.y-5+"px";h.style.left=s.x-5+"px";if(pg_img_catch){pg_img_catch.style.display="none"}}function g(q){q=q||window.event;h.onmouseover=k;var r=0;r=1;if(r==1){if(pg_rubberpolygonGraph){$thispg._map.removeLayer(pg_rubberpolygonGraph);pg_rubberpolygonGraph=null}var s=$thispg._map.mouseEventToLatLng(q);e[h.arrayposition]=s;pgslatlngs=e;$thispg.points=pgslatlngs;$thispg.setLatLngs(pgslatlngs);$thispg.updatePosition()}document.onmousemove="";document.onmouseup="";pgnodeImageDIV.style.display="";$thispg._map.dragging.enable()}function n(r){var q=$thispg.getVertexCount();if(q==3){alert("多边形不少于三个个点");return}r=r||window.event;if(!$thispg.menuelement){$thispg.createMenu()}if(pgnodeImageDIV){pgnodeImageDIV.appendChild($thispg.menuelement)}DCI.DomEvent.on($thispg._map,"click",function(){if($thispg.menuelement){$thispg.menuelement.style.display="none"}},this);$thispg.menuelement.onmousedown=u;function u(v){$thispg.menuelement.style.display="none";$thispg.deleteVertex(h.arrayposition);$thispg.menuelement.onmousedown=""}var t=$thispg.menuelement;t.style.display="";var s=$thispg._map.mouseEventToContainerPoint(r);t.style.left=s.x+5+"px";t.style.top=s.y+5+"px";if(document.releaseCapture){document.releaseCapture()}return false}function k(q){pgnodeImageDIV.style.display="";if(pg_img_catch){pg_img_catch.style.display="";pg_img_catch.style.top=parseInt(h.style.top)-1+"px";pg_img_catch.style.left=parseInt(h.style.left)-1+"px"}}function p(q){pgnodeImageDIV.style.display="";if(pg_img_catch){pg_img_catch.style.display="none"}}}}});(function(){function a(b){return DCI.FeatureGroup.extend({initialize:function(c,d){this._layers={};this._options=d;this.setLatLngs(c)},setLatLngs:function(d){var e=0,c=d.length;this.eachLayer(function(f){if(e<c){f.setLatLngs(d[e++])}else{this.removeLayer(f)}},this);while(e<c){this.addLayer(new b(d[e++],this._options))}return this},getLatLngs:function(){var c=[];this.eachLayer(function(d){c.push(d.getLatLngs())});return c}})}DCI.MultiPolyline=a(DCI.Polyline);DCI.MultiPolygon=a(DCI.Polygon);DCI.multiPolyline=function(b,c){return new DCI.MultiPolyline(b,c)};DCI.multiPolygon=function(b,c){return new DCI.MultiPolygon(b,c)}}());DCI.Rectangle=DCI.Polygon.extend({initialize:function(b,a){DCI.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(b),a)},addEventList:function(a){for(var b=0;b<a.length;b++){this._map.on(a[b],function(d){var c=this.getBounds();if(c.contains(d.latlng)){this.fire(a[b],d)}},this)}},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){a=DCI.latLngBounds(a);return[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]},gml:function(){var b=this.getBounds();var a=b.getSouthWest();var c=b.getNorthEast();var d=a.lng+","+a.lat+" "+c.lng+","+c.lat;return"<Box><coordinates>"+d+"</coordinates></Box>"}});DCI.rectangle=function(b,a){return new DCI.Rectangle(b,a)};DCI.Circle=DCI.Path.extend({initialize:function(c,a,b){DCI.Path.prototype.initialize.call(this,b);this._latlng=DCI.latLng(c);this._mRadius=a},options:{fill:true},setLatLng:function(a){this._latlng=DCI.latLng(a);return this.redraw()},setRadius:function(a){this._mRadius=a;return this.redraw()},projectLatlngs:function(){var c=this._getLngRadius(),b=this._latlng,a=this._map.latLngToLayerPoint([b.lng-c,b.lat]);this._point=this._map.latLngToLayerPoint(b);this._radius=Math.max(this._point.x-a.x,1)},getBounds:function(){var c=this._getLngRadius(),a=(this._mRadius/40075017)*360,b=this._latlng;return new DCI.LatLngBounds([b.lng-c,b.lat-a],[b.lng+c,b.lat+a])},getLatLng:function(){return this._latlng},getPathString:function(){var b=this._point,a=this._radius;if(this._checkIfEmpty()){return""}if(DCI.Browser.svg){return"M"+b.x+","+(b.y-a)+"A"+a+","+a+",0,1,1,"+(b.x-0.1)+","+(b.y-a)+" z"}else{b._round();a=Math.round(a);return"AL "+b.x+","+b.y+" "+a+","+a+" 0,"+(65535*360)}},getRadius:function(){return this._mRadius},_getLatRadius:function(){return(this._mRadius/40075017)*360},_getLngRadius:function(){if(this._map.options.crs.code=="EPSG:990001"){return this.getRadius()}return this._getLatRadius()/Math.cos(DCI.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map){return false}var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y},gml:function(){return"<Point><coordinates>"+this._latlng.lng+","+this._latlng.lat+"</coordinates></Point>"}});DCI.circle=function(c,a,b){return new DCI.Circle(c,a,b)};DCI.CircleMarker=DCI.Circle.extend({options:{radius:10,weight:2},initialize:function(b,a){DCI.Circle.prototype.initialize.call(this,b,null,a);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){DCI.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setLatLng:function(a){DCI.Circle.prototype.setLatLng.call(this,a);if(this._popup&&this._popup._isOpen){this._popup.setLatLng(a)}return this},setRadius:function(a){this.options.radius=this._radius=a;return this.redraw()},getRadius:function(){return this._radius}});DCI.circleMarker=function(b,a){return new DCI.CircleMarker(b,a)};DCI.Cascading=DCI.Class.extend({initialize:function(a){},cascade:function(c,e,o){var k=DCI.Util.isArray(e);if(c==null||c==undefined){throw new Error("map cannot be null!");return}if(!k){throw new Error("Invalid GeoJSON object.");return}for(var p=0;p<e.length;p++){var f=e[p];var l=f.coordinates;switch(f.type){case"point":for(var g=0;g<l.length;g++){var q=new DCI.marker(new DCI.LatLng(l[g][0],l[g][1]));DCI.DomEvent.on(q,"click",o);c.addLayer(q)}break;case"polyline":for(var g=0;g<l.length;g++){var b=[];for(var d=0;d<l[g].length;d++){b.push(new DCI.LatLng(l[g][d][0],l[g][d][1]))}var q=new DCI.Polyline(b,f.options);DCI.DomEvent.on(q,"click",o);c.addLayer(q)}break;case"polygon":for(var g=0;g<l.length;g++){var b=[];for(var d=0;d<l[g].length;d++){b.push(new DCI.LatLng(l[g][d][0],l[g][d][1]))}var q=new DCI.Polygon(b,f.options);DCI.DomEvent.on(q,"click",o);c.addLayer(q)}break;case"rectangle":for(var g=0;g<l.length;g++){var n=new DCI.LatLng(l[g][0][0],l[g][0][1]);var m=new DCI.LatLng(l[g][1][0],l[g][1][1]);var a=new DCI.LatLngBounds(n,m);var q=new DCI.Rectangle(a,f.options);DCI.DomEvent.on(q,"click",o);c.addLayer(q)}break;case"circle":var h=f.options;for(var g=0;g<l.length;g++){var q=new DCI.circle(new DCI.LatLng(l[g].point[0],l[g].point[1]),l[g].radius,h);DCI.DomEvent.on(q,"click",o);c.addLayer(q)}break;default:throw new Error("Invalid GeoJSON object.")}}}});DCI.cascading=function(a){return new DCI.Cascading(a)};DCI.Polyline.include(!DCI.Path.CANVAS?{}:{_containsPoint:function(a,g){var f,e,c,h,d,l,b,m=this.options.weight/2;if(DCI.Browser.touch){m+=10}for(f=0,h=this._parts.length;f<h;f++){b=this._parts[f];for(e=0,d=b.length,c=d-1;e<d;c=e++){if(!g&&(e===0)){continue}l=DCI.LineUtil.pointToSegmentDistance(a,b[c],b[e]);if(l<=m){return true}}}return false}});DCI.Polygon.include(!DCI.Path.CANVAS?{}:{_containsPoint:function(a){var c=false,b,m,l,g,f,e,h,d;if(DCI.Polyline.prototype._containsPoint.call(this,a,true)){return true}for(g=0,h=this._parts.length;g<h;g++){b=this._parts[g];for(f=0,d=b.length,e=d-1;f<d;e=f++){m=b[f];l=b[e];if(((m.y>a.y)!==(l.y>a.y))&&(a.x<(l.x-m.x)*(a.y-m.y)/(l.y-m.y)+m.x)){c=!c}}}return c}});DCI.Circle.include(!DCI.Path.CANVAS?{}:{_drawPath:function(){var a=this._point;this._ctx.beginPath();this._ctx.arc(a.x,a.y,this._radius,0,Math.PI*2,false)},_drawDashPath:function(){var g=this._point;var f=Math.PI*2;var c=this.options.dashArray;this._ctx.beginPath();if(c==null||c.length==0){this._ctx.arc(g.x,g.y,this._radius,0,f,false)}else{var h=f*this._radius;var b=0;var e=c.length;var a=0;while(a<f){var d=c[b%e];if(b%2==0){if(a<=Math.PI/2){this._ctx.moveTo(g.x+this._radius*Math.cos(a),g.y+this._radius*Math.sin(a))}else{if(a<=Math.PI&&a>Math.PI/2){this._ctx.moveTo(g.x-this._radius*Math.cos(Math.PI-a),g.y+this._radius*Math.sin(Math.PI-a))}else{if(a<=3*Math.PI/2&&a>Math.PI){this._ctx.moveTo(g.x-this._radius*Math.cos(a-Math.PI),g.y-this._radius*Math.sin(a-Math.PI))}else{this._ctx.moveTo(g.x+this._radius*Math.cos(2*Math.PI-a),g.y-this._radius*Math.sin(2*Math.PI-a))}}}this._ctx.arc(g.x,g.y,this._radius,a,a+d/h*f,false)}a+=d/h*f;b++}}},_containsPoint:function(c){var b=this._point,a=this.options.stroke?this.options.weight/2:0;return(c.distanceTo(b)<=this._radius+a)}});DCI.CircleMarker.include(!DCI.Path.CANVAS?{}:{_updateStyle:function(){DCI.Path.prototype._updateStyle.call(this)}});DCI.GeoJSON=DCI.FeatureGroup.extend({initialize:function(b,a){DCI.setOptions(this,a);this._layers={};if(b){this.addData(b)}},addData:function(c){var g=DCI.Util.isArray(c)?c:c.features,f,a,e;if(g){for(f=0,a=g.length;f<a;f++){e=g[f];if(e.geometries||e.geometry||e.features||e.coordinates){this.addData(g[f])}}return this}var b=this.options;if(b.filter&&!b.filter(c)){return}var d=DCI.GeoJSON.geometryToLayer(c,b.pointToLayer,b.coordsToLatLng,b);d.feature=DCI.GeoJSON.asFeature(c);d.defaultOptions=d.options;this.resetStyle(d);if(b.onEachFeature){b.onEachFeature(c,d)}return this.addLayer(d)},resetStyle:function(a){var b=this.options.style;if(b){DCI.Util.extend(a.options,a.defaultOptions);this._setLayerStyle(a,b)}},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){if(typeof b==="function"){b=b(a.feature)}if(a.setStyle){a.setStyle(b)}}});DCI.extend(DCI.GeoJSON,{geometryToLayer:function(b,c,d,h){var l=b.type==="Feature"?b.geometry:b,m=l.coordinates,g=[],e,a,f,k;d=d||this.coordsToLatLng;switch(l.type){case"Point":e=d(m);return c?c(b,e):new DCI.Marker(e);case"MultiPoint":for(f=0,k=m.length;f<k;f++){e=d(m[f]);g.push(c?c(b,e):new DCI.Marker(e))}return new DCI.FeatureGroup(g);case"LineString":a=this.coordsToLatLngs(m,0,d);return new DCI.Polyline(a,h);case"Polygon":if(m.length===2&&!m[1].length){throw new Error("Invalid GeoJSON object.")}a=this.coordsToLatLngs(m,1,d);return new DCI.Polygon(a,h);case"MultiLineString":a=this.coordsToLatLngs(m,1,d);return new DCI.MultiPolyline(a,h);case"MultiPolygon":a=this.coordsToLatLngs(m,2,d);return new DCI.MultiPolygon(a,h);case"GeometryCollection":for(f=0,k=l.geometries.length;f<k;f++){g.push(this.geometryToLayer({geometry:l.geometries[f],type:"Feature",properties:b.properties},c,d,h))}return new DCI.FeatureGroup(g);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new DCI.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(e,d,g){var f,c,b,a=[];for(c=0,b=e.length;c<b;c++){f=d?this.coordsToLatLngs(e[c],d-1,g):(g||this.coordsToLatLng)(e[c]);a.push(f)}return a},latLngToCoords:function(b){var a=[b.lng,b.lat];if(b.alt!==undefined){a.push(b.alt)}return a},latLngsToCoords:function(d){var c=[];for(var b=0,a=d.length;b<a;b++){c.push(DCI.GeoJSON.latLngToCoords(d[b]))}return c},getFeature:function(b,a){return b.feature?DCI.extend({},b.feature,{geometry:a}):DCI.GeoJSON.asFeature(a)},asFeature:function(a){if(a.type==="Feature"){return a}return{type:"Feature",properties:{},geometry:a}}});var PointToGeoJSON={toGeoJSON:function(){return DCI.GeoJSON.getFeature(this,{type:"Point",coordinates:DCI.GeoJSON.latLngToCoords(this.getLatLng())})}};DCI.Marker.include(PointToGeoJSON);DCI.Circle.include(PointToGeoJSON);DCI.CircleMarker.include(PointToGeoJSON);DCI.Polyline.include({toGeoJSON:function(){return DCI.GeoJSON.getFeature(this,{type:"LineString",coordinates:DCI.GeoJSON.latLngsToCoords(this.getLatLngs())})}});DCI.Polygon.include({toGeoJSON:function(){var d=[DCI.GeoJSON.latLngsToCoords(this.getLatLngs())],b,a,c;d[0].push(d[0][0]);if(this._holes){for(b=0,a=this._holes.length;b<a;b++){c=DCI.GeoJSON.latLngsToCoords(this._holes[b]);c.push(c[0]);d.push(c)}}return DCI.GeoJSON.getFeature(this,{type:"Polygon",coordinates:d})}});(function(){function a(b){return function(){var c=[];this.eachLayer(function(d){c.push(d.toGeoJSON().geometry.coordinates)});return DCI.GeoJSON.getFeature(this,{type:b,coordinates:c})}}DCI.MultiPolyline.include({toGeoJSON:a("MultiLineString")});DCI.MultiPolygon.include({toGeoJSON:a("MultiPolygon")});DCI.LayerGroup.include({toGeoJSON:function(){var e=this.feature&&this.feature.geometry,d=[],c;if(e&&e.type==="MultiPoint"){return a("MultiPoint").call(this)}var b=e&&e.type==="GeometryCollection";this.eachLayer(function(f){if(f.toGeoJSON){c=f.toGeoJSON();d.push(b?c.geometry:DCI.GeoJSON.asFeature(c))}});if(b){return DCI.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"})}return{type:"FeatureCollection",features:d}}})}());DCI.geoJson=function(b,a){return new DCI.GeoJSON(b,a)};DCI.DomEvent={addListener:function(d,f,g,b){var a=DCI.stamp(g),h="_dci_"+f+a,k,e,c;if(d[h]){return this}k=function(l){return g.call(b||d,l||DCI.DomEvent._getEvent())};if(DCI.Browser.pointer&&f.indexOf("touch")===0){return this.addPointerListener(d,f,k,a)}if(DCI.Browser.touch&&(f==="dblclick")&&this.addDoubleTapListener){this.addDoubleTapListener(d,k,a)}if("addEventListener" in d){if(f==="mousewheel"){d.addEventListener("DOMMouseScroll",k,false);d.addEventListener(f,k,false)}else{if((f==="mouseenter")||(f==="mouseleave")){e=k;c=(f==="mouseenter"?"mouseover":"mouseout");k=function(l){if(!DCI.DomEvent._checkMouse(d,l)){return}return e(l)};d.addEventListener(c,k,false)}else{if(f==="click"&&DCI.Browser.android){e=k;k=function(l){return DCI.DomEvent._filterClick(l,e)};d.addEventListener(f,k,false)}else{d.addEventListener(f,k,false)}}}}else{if("attachEvent" in d){d.attachEvent("on"+f,k)}}d[h]=k;return this},removeListener:function(e,d,c){var f=DCI.stamp(c),a="_dci_"+d+f,b=e[a];if(!b){return this}if(DCI.Browser.pointer&&d.indexOf("touch")===0){this.removePointerListener(e,d,f)}else{if(DCI.Browser.touch&&(d==="dblclick")&&this.removeDoubleTapListener){this.removeDoubleTapListener(e,f)}else{if("removeEventListener" in e){if(d==="mousewheel"){e.removeEventListener("DOMMouseScroll",b,false);e.removeEventListener(d,b,false)}else{if((d==="mouseenter")||(d==="mouseleave")){e.removeEventListener((d==="mouseenter"?"mouseover":"mouseout"),b,false)}else{e.removeEventListener(d,b,false)}}}else{if("detachEvent" in e){e.detachEvent("on"+d,b)}}}}e[a]=null;return this},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}DCI.DomEvent._skipped(a);return this},disableScrollPropagation:function(b){var a=DCI.DomEvent.stopPropagation;return DCI.DomEvent.on(b,"mousewheel",a).on(b,"MozMousePixelScroll",a)},disableClickPropagation:function(c){var b=DCI.DomEvent.stopPropagation;for(var a=DCI.Draggable.START.length-1;a>=0;a--){DCI.DomEvent.on(c,DCI.Draggable.START[a],b)}return DCI.DomEvent.on(c,"click",DCI.DomEvent._fakeStop).on(c,"dblclick",b)},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}return this},stop:function(a){return DCI.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(c,a){if(!a){return new DCI.Point(c.clientX,c.clientY)}var b=a.getBoundingClientRect();return new DCI.Point(c.clientX-b.left-a.clientLeft,c.clientY-b.top-a.clientTop)},getWheelDelta:function(a){var b=0;if(a.wheelDelta){b=a.wheelDelta/120}if(a.detail){b=-a.detail/3}return b},_skipEvents:{},_fakeStop:function(a){DCI.DomEvent._skipEvents[a.type]=true},_skipped:function(b){var a=this._skipEvents[b.type];this._skipEvents[b.type]=false;return a},_checkMouse:function(a,d){var c=d.relatedTarget;if(!c){return true}try{while(c&&(c!==a)){c=c.parentNode}}catch(b){return false}return(c!==a)},_getEvent:function(){var b=window.event;if(!b){var a=arguments.callee.caller;while(a){b=a["arguments"][0];if(b&&window.Event===b.constructor){break}a=a.caller}}return b},_filterClick:function(d,c){var b=(d.timeStamp||d.originalEvent.timeStamp),a=DCI.DomEvent._lastClick&&(b-DCI.DomEvent._lastClick);if((a&&a>100&&a<500)||(d.target._simulatedClick&&!d._simulated)){DCI.DomEvent.stop(d);return}DCI.DomEvent._lastClick=b;return c(d)}};DCI.DomEvent.on=DCI.DomEvent.addListener;DCI.DomEvent.off=DCI.DomEvent.removeListener;DCI.Draggable=DCI.Class.extend({includes:DCI.Mixin.Events,statics:{START:DCI.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b){this._element=a;this._dragStartTarget=b||a},enable:function(){if(this._enabled){return}for(var a=DCI.Draggable.START.length-1;a>=0;a--){DCI.DomEvent.on(this._dragStartTarget,DCI.Draggable.START[a],this._onDown,this)}this._enabled=true},disable:function(){if(!this._enabled){return}for(var a=DCI.Draggable.START.length-1;a>=0;a--){DCI.DomEvent.off(this._dragStartTarget,DCI.Draggable.START[a],this._onDown,this)}this._enabled=false;this._moved=false},_onDown:function(a){this._moved=false;if(a.shiftKey||((a.which!==1)&&(a.button!==1)&&!a.touches)){return}DCI.DomEvent.stopPropagation(a);if(DCI.Draggable._disabled){return}DCI.DomUtil.disableImageDrag();DCI.DomUtil.disableTextSelection();if(this._moving){return}var b=a.touches?a.touches[0]:a;this._startPoint=new DCI.Point(b.clientX,b.clientY);this._startPos=this._newPos=DCI.DomUtil.getPosition(this._element);DCI.DomEvent.on(document,DCI.Draggable.MOVE[a.type],this._onMove,this).on(document,DCI.Draggable.END[a.type],this._onUp,this)},_onMove:function(b){if(b.touches&&b.touches.length>1){this._moved=true;return}var d=(b.touches&&b.touches.length===1?b.touches[0]:b),a=new DCI.Point(d.clientX,d.clientY),c=a.subtract(this._startPoint);if(!c.x&&!c.y){return}if(DCI.Browser.touch&&Math.abs(c.x)+Math.abs(c.y)<3){return}DCI.DomEvent.preventDefault(b);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=DCI.DomUtil.getPosition(this._element).subtract(c);DCI.DomUtil.addClass(document.body,"dci-dragging");this._lastTarget=b.target||b.srcElement;DCI.DomUtil.addClass(this._lastTarget,"dci-drag-target")}this._newPos=this._startPos.add(c);this._moving=true;DCI.Util.cancelAnimFrame(this._animRequest);this._animRequest=DCI.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");DCI.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(){DCI.DomUtil.removeClass(document.body,"dci-dragging");if(this._lastTarget){DCI.DomUtil.removeClass(this._lastTarget,"dci-drag-target");this._lastTarget=null}for(var a in DCI.Draggable.MOVE){DCI.DomEvent.off(document,DCI.Draggable.MOVE[a],this._onMove).off(document,DCI.Draggable.END[a],this._onUp)}DCI.DomUtil.enableImageDrag();DCI.DomUtil.enableTextSelection();if(this._moved&&this._moving){DCI.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false}});DCI.Handler=DCI.Class.extend({initialize:function(a){this._map=a},enable:function(){if(this._enabled){return}this._enabled=true;this.addHooks()},disable:function(){if(!this._enabled){return}this._enabled=false;this.removeHooks()},enabled:function(){return !!this._enabled}});DCI.Map.mergeOptions({dragging:true,inertia:!DCI.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:DCI.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:false});DCI.Map.Drag=DCI.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new DCI.Draggable(a._mapPane,a._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(a.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);a.on("viewreset",this._onViewReset,this);a.whenReady(this._onViewReset,this)}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;if(a._panAnim){a._panAnim.stop()}a.fire("movestart").fire("dragstart");if(a.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date(),b=this._lastPos=this._draggable._newPos;this._positions.push(b);this._times.push(a);if(a-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var b=this._map.getSize()._divideBy(2),a=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=a.subtract(b).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var g=this._worldWidth,f=Math.round(g/2),b=this._initialWorldOffset,a=this._draggable._newPos.x,d=(a-f+b)%g+f-b,c=(a+f+b)%g-f-b,e=Math.abs(d+b)<Math.abs(c+b)?d:c;this._draggable._newPos.x=e},_onDragEnd:function(m){var b=this._map,q=b.options,l=+new Date()-this._lastTime,a=!q.inertia||l>q.inertiaThreshold||!this._positions[0];b.fire("dragend",m);if(a){b.fire("moveend")}else{var n=this._lastPos.subtract(this._positions[0]),h=(this._lastTime+l-this._times[0])/1000,g=q.easeLinearity,f=n.multiplyBy(g/h),d=f.distanceTo([0,0]),p=Math.min(q.inertiaMaxSpeed,d),o=f.multiplyBy(p/d),c=p/(q.inertiaDeceleration*g),k=o.multiplyBy(-c/2).round();if(!k.x||!k.y){b.fire("moveend")}else{k=b._limitOffset(k,b.options.maxBounds);DCI.Util.requestAnimFrame(function(){b.panBy(k,{duration:c,easeLinearity:g,noMoveStart:true})})}}}});DCI.Map.addInitHook("addHandler","dragging",DCI.Map.Drag);DCI.Map.mergeOptions({doubleClickZoom:true});DCI.Map.DoubleClickZoom=DCI.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(c){var b=this._map,a=b.getZoom()+(c.originalEvent.shiftKey?-1:1);if(b.options.doubleClickZoom==="center"){b.setZoom(a)}else{b.setZoomAround(c.containerPoint,a)}}});DCI.Map.addInitHook("addHandler","doubleClickZoom",DCI.Map.DoubleClickZoom);DCI.Map.mergeOptions({scrollWheelZoom:true});DCI.Map.ScrollWheelZoom=DCI.Handler.extend({addHooks:function(){DCI.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);DCI.DomEvent.on(this._map._container,"MozMousePixelScroll",DCI.DomEvent.preventDefault);this._delta=0},removeHooks:function(){DCI.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);DCI.DomEvent.off(this._map._container,"MozMousePixelScroll",DCI.DomEvent.preventDefault)},_onWheelScroll:function(b){var c=DCI.DomEvent.getWheelDelta(b);this._delta+=c;this._lastMousePos=this._map.mouseEventToContainerPoint(b);if(!this._startTime){this._startTime=+new Date()}var a=Math.max(40-(+new Date()-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(DCI.bind(this._performZoom,this),a);DCI.DomEvent.preventDefault(b);DCI.DomEvent.stopPropagation(b)},_performZoom:function(){var b=this._map,c=this._delta,a=b.getZoom();c=c>0?Math.ceil(c):Math.floor(c);c=Math.max(Math.min(c,4),-4);c=b._limitZoom(a+c)-a;this._delta=0;this._startTime=null;if(!c){return}if(b.options.scrollWheelZoom==="center"){b.setZoom(a+c)}else{b.setZoomAround(this._lastMousePos,a+c)}}});DCI.Map.addInitHook("addHandler","scrollWheelZoom",DCI.Map.ScrollWheelZoom);DCI.extend(DCI.DomEvent,{_touchstart:DCI.Browser.msPointer?"MSPointerDown":DCI.Browser.pointer?"pointerdown":"touchstart",_touchend:DCI.Browser.msPointer?"MSPointerUp":DCI.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(f,p,a){var o,k=false,g=250,e,c="_dci_",h=this._touchstart,n=this._touchend,m=[];function d(s){var r;if(DCI.Browser.pointer){m.push(s.pointerId);r=m.length}else{r=s.touches.length}if(r>1){return}var q=Date.now(),t=q-(o||q);e=s.touches?s.touches[0]:s;k=(t>0&&t<=g);o=q}function l(t){if(DCI.Browser.pointer){var r=m.indexOf(t.pointerId);if(r===-1){return}m.splice(r,1)}if(k){if(DCI.Browser.pointer){var q={},u;for(var s in e){u=e[s];if(typeof u==="function"){q[s]=u.bind(e)}else{q[s]=u}}e=q}e.type="dblclick";p(e);o=null}}f[c+h+a]=d;f[c+n+a]=l;var b=DCI.Browser.pointer?document.documentElement:f;f.addEventListener(h,d,false);b.addEventListener(n,l,false);if(DCI.Browser.pointer){b.addEventListener(DCI.DomEvent.POINTER_CANCEL,l,false)}return this},removeDoubleTapListener:function(b,c){var a="_dci_";b.removeEventListener(this._touchstart,b[a+this._touchstart+c],false);(DCI.Browser.pointer?document.documentElement:b).removeEventListener(this._touchend,b[a+this._touchend+c],false);if(DCI.Browser.pointer){document.documentElement.removeEventListener(DCI.DomEvent.POINTER_CANCEL,b[a+this._touchend+c],false)}return this}});DCI.extend(DCI.DomEvent,{POINTER_DOWN:DCI.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:DCI.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:DCI.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:DCI.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:false,addPointerListener:function(c,b,a,d){switch(b){case"touchstart":return this.addPointerListenerStart(c,b,a,d);case"touchend":return this.addPointerListenerEnd(c,b,a,d);case"touchmove":return this.addPointerListenerMove(c,b,a,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(g,e,d,h){var f="_dci_",b=this._pointers;var a=function(m){DCI.DomEvent.preventDefault(m);var l=false;for(var k=0;k<b.length;k++){if(b[k].pointerId===m.pointerId){l=true;break}}if(!l){b.push(m)}m.touches=b.slice();m.changedTouches=[m];d(m)};g[f+"touchstart"+h]=a;g.addEventListener(this.POINTER_DOWN,a,false);if(!this._pointerDocumentListener){var c=function(l){for(var k=0;k<b.length;k++){if(b[k].pointerId===l.pointerId){b.splice(k,1);break}}};document.documentElement.addEventListener(this.POINTER_UP,c,false);document.documentElement.addEventListener(this.POINTER_CANCEL,c,false);this._pointerDocumentListener=true}return this},addPointerListenerMove:function(f,c,b,g){var e="_dci_",d=this._pointers;function a(k){if((k.pointerType===k.MSPOINTER_TYPE_MOUSE||k.pointerType==="mouse")&&k.buttons===0){return}for(var h=0;h<d.length;h++){if(d[h].pointerId===k.pointerId){d[h]=k;break}}k.touches=d.slice();k.changedTouches=[k];b(k)}f[e+"touchmove"+g]=a;f.addEventListener(this.POINTER_MOVE,a,false);return this},addPointerListenerEnd:function(f,c,b,g){var e="_dci_",d=this._pointers;var a=function(k){for(var h=0;h<d.length;h++){if(d[h].pointerId===k.pointerId){d.splice(h,1);break}}k.touches=d.slice();k.changedTouches=[k];b(k)};f[e+"touchend"+g]=a;f.addEventListener(this.POINTER_UP,a,false);f.addEventListener(this.POINTER_CANCEL,a,false);return this},removePointerListener:function(d,b,e){var c="_dci_",a=d[c+b+e];switch(b){case"touchstart":d.removeEventListener(this.POINTER_DOWN,a,false);break;case"touchmove":d.removeEventListener(this.POINTER_MOVE,a,false);break;case"touchend":d.removeEventListener(this.POINTER_UP,a,false);d.removeEventListener(this.POINTER_CANCEL,a,false);break}return this}});DCI.Map.mergeOptions({touchZoom:DCI.Browser.touch&&!DCI.Browser.android23,bounceAtZoomLimits:true});DCI.Map.TouchZoom=DCI.Handler.extend({addHooks:function(){DCI.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){DCI.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var c=this._map;if(!d.touches||d.touches.length!==2||c._animatingZoom||this._zooming){return}var f=c.mouseEventToLayerPoint(d.touches[0]),b=c.mouseEventToLayerPoint(d.touches[1]),a=c._getCenterLayerPoint();this._startCenter=f.add(b)._divideBy(2);this._startDist=f.distanceTo(b);this._moved=false;this._zooming=true;this._centerOffset=a.subtract(this._startCenter);if(c._panAnim){c._panAnim.stop()}DCI.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this);DCI.DomEvent.preventDefault(d)},_onTouchMove:function(c){var b=this._map;if(!c.touches||c.touches.length!==2||!this._zooming){return}var d=b.mouseEventToLayerPoint(c.touches[0]),a=b.mouseEventToLayerPoint(c.touches[1]);this._scale=d.distanceTo(a)/this._startDist;this._delta=d._add(a)._divideBy(2)._subtract(this._startCenter);if(this._scale===1){return}if(!b.options.bounceAtZoomLimits){if((b.getZoom()===b.getMinZoom()&&this._scale<1)||(b.getZoom()===b.getMaxZoom()&&this._scale>1)){return}}if(!this._moved){DCI.DomUtil.addClass(b._mapPane,"dci-touching");b.fire("movestart").fire("zoomstart");this._moved=true}DCI.Util.cancelAnimFrame(this._animRequest);this._animRequest=DCI.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);DCI.DomEvent.preventDefault(c)},_updateOnMove:function(){var d=this._map,b=this._getScaleOrigin(),a=d.layerPointToLatLng(b),c=d.getScaleZoom(this._scale);d._animateZoom(a,c,this._startCenter,this._scale,this._delta,false,true)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}var g=this._map;this._zooming=false;DCI.DomUtil.removeClass(g._mapPane,"dci-touching");DCI.Util.cancelAnimFrame(this._animRequest);DCI.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var c=this._getScaleOrigin(),b=g.layerPointToLatLng(c),f=g.getZoom(),a=g.getScaleZoom(this._scale)-f,d=(a>0?Math.ceil(a):Math.floor(a)),e=g._limitZoom(f+d),h=g.getZoomScale(e)/this._scale;g._animateZoom(b,e,c,h)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}});DCI.Map.addInitHook("addHandler","touchZoom",DCI.Map.TouchZoom);DCI.Map.mergeOptions({tap:true,tapTolerance:15});DCI.Map.Tap=DCI.Handler.extend({addHooks:function(){DCI.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){DCI.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(b){if(!b.touches){return}DCI.DomEvent.preventDefault(b);this._fireClick=true;if(b.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var c=b.touches[0],a=c.target;this._startPos=this._newPos=new DCI.Point(c.clientX,c.clientY);if(a.tagName&&a.tagName.toLowerCase()==="a"){DCI.DomUtil.addClass(a,"dci-active")}this._holdTimeout=setTimeout(DCI.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",c)}},this),1000);DCI.DomEvent.on(document,"touchmove",this._onMove,this).on(document,"touchend",this._onUp,this)},_onUp:function(b){clearTimeout(this._holdTimeout);DCI.DomEvent.off(document,"touchmove",this._onMove,this).off(document,"touchend",this._onUp,this);if(this._fireClick&&b&&b.changedTouches){var c=b.changedTouches[0],a=c.target;if(a&&a.tagName&&a.tagName.toLowerCase()==="a"){DCI.DomUtil.removeClass(a,"dci-active")}if(this._isTapValid()){this._simulateEvent("click",c)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var b=a.touches[0];this._newPos=new DCI.Point(b.clientX,b.clientY)},_simulateEvent:function(a,c){var b=document.createEvent("MouseEvents");b._simulated=true;c.target._simulatedClick=true;b.initMouseEvent(a,true,true,window,1,c.screenX,c.screenY,c.clientX,c.clientY,false,false,false,false,0,null);c.target.dispatchEvent(b)}});if(DCI.Browser.touch&&!DCI.Browser.pointer){DCI.Map.addInitHook("addHandler","tap",DCI.Map.Tap)}DCI.Map.mergeOptions({boxZoom:true});DCI.Map.BoxZoom=DCI.Handler.extend({initialize:function(a){this._map=a;this._container=a._container;this._pane=a._panes.overlayPane;this._moved=false},addHooks:function(){DCI.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){DCI.DomEvent.off(this._container,"mousedown",this._onMouseDown);this._moved=false},moved:function(){return this._moved},_onMouseDown:function(a){this._moved=false;if(!a.shiftKey||((a.which!==1)&&(a.button!==1))){return false}DCI.DomUtil.disableTextSelection();DCI.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(a);DCI.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this)},_onMouseMove:function(f){if(!this._moved){this._box=DCI.DomUtil.create("div","dci-zoom-box",this._pane);DCI.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";this._map.fire("boxzoomstart")}var d=this._startLayerPoint,c=this._box,a=this._map.mouseEventToLayerPoint(f),g=a.subtract(d),b=new DCI.Point(Math.min(a.x,d.x),Math.min(a.y,d.y));DCI.DomUtil.setPosition(c,b);this._moved=true;c.style.width=(Math.max(0,Math.abs(g.x)-4))+"px";c.style.height=(Math.max(0,Math.abs(g.y)-4))+"px"},_finish:function(){if(this._moved){this._pane.removeChild(this._box);this._container.style.cursor=""}DCI.DomUtil.enableTextSelection();DCI.DomUtil.enableImageDrag();DCI.DomEvent.off(document,"mousemove",this._onMouseMove).off(document,"mouseup",this._onMouseUp).off(document,"keydown",this._onKeyDown)},_onMouseUp:function(d){this._finish();var c=this._map,a=c.mouseEventToLayerPoint(d);if(this._startLayerPoint.equals(a)){return}var b=new DCI.LatLngBounds(c.layerPointToLatLng(this._startLayerPoint),c.layerPointToLatLng(a));c.fitBounds(b);c.fire("boxzoomend",{boxZoomBounds:b})},_onKeyDown:function(a){if(a.keyCode===27){this._finish()}}});DCI.Map.addInitHook("addHandler","boxZoom",DCI.Map.BoxZoom);DCI.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});DCI.Map.Keyboard=DCI.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a;this._setPanOffset(a.options.keyboardPanOffset);this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;if(a.tabIndex===-1){a.tabIndex="0"}DCI.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;DCI.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused){return}var a=document.body,d=document.documentElement,c=a.scrollTop||d.scrollTop,b=a.scrollLeft||d.scrollLeft;this._map._container.focus();window.scrollTo(b,c)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(e){var d=this._panKeys={},b=this.keyCodes,c,a;for(c=0,a=b.left.length;c<a;c++){d[b.left[c]]=[-1*e,0]}for(c=0,a=b.right.length;c<a;c++){d[b.right[c]]=[e,0]}for(c=0,a=b.down.length;c<a;c++){d[b.down[c]]=[0,e]}for(c=0,a=b.up.length;c<a;c++){d[b.up[c]]=[0,-1*e]}},_setZoomOffset:function(e){var d=this._zoomKeys={},b=this.keyCodes,c,a;for(c=0,a=b.zoomIn.length;c<a;c++){d[b.zoomIn[c]]=e}for(c=0,a=b.zoomOut.length;c<a;c++){d[b.zoomOut[c]]=-e}},_addHooks:function(){DCI.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){DCI.DomEvent.off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(c){var a=c.keyCode,b=this._map;if(a in this._panKeys){if(b._panAnim&&b._panAnim._inProgress){return}b.panBy(this._panKeys[a]);if(b.options.maxBounds){b.panInsideBounds(b.options.maxBounds)}}else{if(a in this._zoomKeys){b.setZoom(b.getZoom()+this._zoomKeys[a])}else{return}}DCI.DomEvent.stop(c)}});DCI.Map.addInitHook("addHandler","keyboard",DCI.Map.Keyboard);DCI.Handler.MarkerDrag=DCI.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;if(!this._draggable){this._draggable=new DCI.Draggable(a,a)}this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable();DCI.DomUtil.addClass(this._marker._icon,"dci-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable();DCI.DomUtil.removeClass(this._marker._icon,"dci-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var a=this._marker,d=a._shadow,b=DCI.DomUtil.getPosition(a._icon),c=a._map.layerPointToLatLng(b);if(d){DCI.DomUtil.setPosition(d,b)}a._latlng=c;a.fire("move",{latlng:c}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}});DCI.Control=DCI.Class.extend({options:{position:"topright"},initialize:function(a){DCI.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;if(b){b.removeControl(this)}this.options.position=a;if(b){b.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(c){this._map=c;var a=this._container=this.onAdd(c),d=this.getPosition(),b=c._controlCorners[d];DCI.DomUtil.addClass(a,"dci-control");if(d.indexOf("bottom")!==-1){b.insertBefore(a,b.firstChild)}else{b.appendChild(a)}return this},removeFrom:function(b){var c=this.getPosition(),a=b._controlCorners[c];a.removeChild(this._container);this._map=null;if(this.onRemove){this.onRemove(b)}return this},_refocusOnMap:function(){if(this._map){this._map.getContainer().focus()}}});DCI.control=function(a){return new DCI.Control(a)};DCI.Map.include({addControl:function(a){a.addTo(this);return this},removeControl:function(a){a.removeFrom(this);return this},_initControlPos:function(){var c=this._controlCorners={},b="dci-",a=this._controlContainer=DCI.DomUtil.create("div",b+"control-container",this._container);function d(f,g){var e=b+f+" "+b+g;c[f+g]=DCI.DomUtil.create("div",e,a)}d("top","left");d("top","right");d("bottom","left");d("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});DCI.Control.Zoom=DCI.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out",OffsetX:50,OffsetY:50,levelpx:10,mapCenter:null},onAdd:function(b){var c="dci-control-zoom",a=DCI.DomUtil.create("div",c+" dci-bar");this._map=b;if(b.getMaxZoom()!="Infinity"){this.createLevelControl(a)}return a},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(d,h,f,a,e,c){var g=DCI.DomUtil.create("a",f,a);g.innerHTML=d;g.href="#";g.title=h;var b=DCI.DomEvent.stopPropagation;DCI.DomEvent.on(g,"click",b).on(g,"mousedown",b).on(g,"dblclick",b).on(g,"click",DCI.DomEvent.preventDefault).on(g,"mouseup",b).on(g,"click",e,c).on(g,"click",this._refocusOnMap,c);return g},_createLevelControl:function(a,h,f,b,e,d){var g=DCI.DomUtil.create(a,f,b);g.href="#";g.title=h;var c=DCI.DomEvent.stopPropagation;DCI.DomEvent.on(g,"click",c).on(g,"mousedown",c).on(g,"dblclick",c).on(g,"click",DCI.DomEvent.preventDefault).on(g,"mouseup",c).on(g,"click",e,d).on(g,"click",this._refocusOnMap,d);return g},createLevelControl:function(o){var h=false;if(DCI.Browser.ie){var f=DCI.Browser.getIEVersion();if(f==6||f==7){h=true}}var v=DCI.DomUtil.create("div","map-level-box",o);if(this.options.OffsetX){v.style.left=this.options.OffsetX+"px"}if(this.options.OffsetY){v.style.top=this.options.OffsetY+"px"}var E=DCI.DomUtil.create("div","map-level-pointer",o);var m;if(h){m=DCI.DomUtil.create("div","map-level-pointer-image-ie6",o)}else{m=DCI.DomUtil.create("div","map-level-pointer-image",o)}if(DCI.Browser.ie){var g=DCI.Browser.getIEVersion();if(g<8){m.style.position="relative";m.style["margin-left"]="0px"}}var s=false;var C=this._map;var p=this.options;var z=(this._map.getMaxZoom()-this._map.getMinZoom()+1)*this.options.levelpx;var d=this._createLevelControl("div","向上平移","map-level-pointer-top",o,function(F){this._map.panBy([0,-25])},this);var u=this._createLevelControl("div","向左平移","map-level-pointer-left",o,function(F){this._map.panBy([-25,0])},this);if(!this.options.mapCenter){this.options.mapCenter=this._map.getCenter()}var x=this.options.mapCenter.lng;var c=this.options.mapCenter.lat;var D=this._createLevelControl("div","居中","map-level-pointer-middle",o,function(F){this._map.panTo([x,c])},this);var r=this._createLevelControl("div","向右平移","map-level-pointer-right",o,function(F){this._map.panBy([25,0])},this);var l=this._createLevelControl("div","向下平移","map-level-pointer-bottom",o,function(F){this._map.panBy([0,25])},this);E.appendChild(m);E.appendChild(d);E.appendChild(u);E.appendChild(r);E.appendChild(l);E.appendChild(D);var k=DCI.DomUtil.create("div","map-level-zoom",o);var A;if(h){A=DCI.DomUtil.create("div","map-level-zoomimage-ie6",o)}else{A=DCI.DomUtil.create("div","map-level-zoomimage",o)}if(DCI.Browser.ie){var g=DCI.Browser.getIEVersion();if(g<8){k.style["text-align"]="left"}}k.appendChild(A);var y;if(h){y=DCI.DomUtil.create("div","map-level-scroll-ie6",o)}else{y=DCI.DomUtil.create("div","map-level-scroll",o)}y.style.height=z+"px";var B=DCI.DomUtil.create("div","map-level-move",o);var e;if(h){e=DCI.DomUtil.create("img","map-level-moveimage-ie6",o)}else{e=DCI.DomUtil.create("img","map-level-moveimage",o)}B.appendChild(e);var w=this._map.getZoom();var b=1-this._map.getMinZoom();B.style.top=(z-((w+b)*this.options.levelpx))+"px";scrollMovecurTop=(w*this.options.levelpx);defaultMovecurTop=(w*this.options.levelpx);DCI.DomEvent.on(C,"zoomend",function(F){zoom=C.getZoom();B.style.top=(z-((zoom+b)*p.levelpx))+"px"});DCI.DomEvent.on(k,"mousedown",function(G){C.doubleClickZoom.disable();var F=C.getZoom();if(F<C.getMaxZoom()){C.setZoom(F+1)}DCI.DomEvent.stop(G)});DCI.DomEvent.on(y,"mousedown",function(I){C.doubleClickZoom.disable();var G=Math.round((I.offsetX/p.levelpx));var H;var F=C.getMaxZoom();if(DCI.Browser.ie){H=F-Math.floor((I.offsetY/p.levelpx))}else{H=F-Math.floor((I.layerY/p.levelpx))}C.setZoom(H);DCI.DomEvent.stop(I);draglick=true});DCI.DomEvent.on(B,"mousedown",function(G){C.doubleClickZoom.disable();if(DCI.Browser.ie){var H=DCI.Browser.getIEVersion();var F=0;if(H<9){F=1}if(G.button==F&&G.srcElement.tagName.toUpperCase()=="IMG"){s=true;startEventY=G.clientY;if(B.style.top!=""){scrollMovecurTop=parseInt(B.style.top)}}}else{if(G.button==0&&G.target.localName.toUpperCase()=="IMG"){s=true;startEventY=G.clientY;if(B.style.top!=""){scrollMovecurTop=parseInt(B.style.top)}}}DCI.DomEvent.stop(G);DCI.DomEvent.on(document.body,"mouseup",q);return false});function q(I){var H=parseInt(B.style.top);var G=C.getMaxZoom();var F=G-Math.round((H/p.levelpx));C.setZoom(F);s=false;DCI.DomEvent.stop(I);DCI.DomEvent.off(document.body,"mouseup",q);return false}DCI.DomEvent.on(C,"mousemove",function(H){if(s){var F=C.latLngToContainerPoint(H.latlng);var G=scrollMovecurTop+10+(F.y-startEventY);if(G<=(z-10)&&G>=0){B.style.top=G+"px"}}DCI.DomEvent.stop(H)});var a=DCI.DomUtil.create("div","map-level-scroll-back",o);a.id="scrollback";y.appendChild(B);y.appendChild(a);var n=DCI.DomUtil.create("div","map-level-narrow",o);var t;if(h){t=DCI.DomUtil.create("div","map-level-narrowimage-ie6",o)}else{t=DCI.DomUtil.create("div","map-level-narrowimage",o)}if(DCI.Browser.ie){var g=DCI.Browser.getIEVersion();if(g<8){n.style["text-align"]="left"}}n.appendChild(t);DCI.DomEvent.on(n,"mousedown",function(G){C.doubleClickZoom.disable();var F=C.getZoom();if(F>C.getMinZoom()){C.setZoom(F-1)}DCI.DomEvent.stop(G)});v.appendChild(E);v.appendChild(k);v.appendChild(y);v.appendChild(n);return v},_updateDisabled:function(){var b=this._map,a="dci-disabled";DCI.DomUtil.removeClass(this._zoomInButton,a);DCI.DomUtil.removeClass(this._zoomOutButton,a);if(b._zoom===b.getMinZoom()){DCI.DomUtil.addClass(this._zoomOutButton,a)}if(b._zoom===b.getMaxZoom()){DCI.DomUtil.addClass(this._zoomInButton,a)}}});DCI.Map.mergeOptions({zoomControl:true});DCI.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new DCI.Control.Zoom();this.addControl(this.zoomControl)}});DCI.control.zoom=function(a){return new DCI.Control.Zoom(a)};DCI.Control.Attribution=DCI.Control.extend({options:{},initialize:function(a){DCI.setOptions(this,a);this._attributions={}},onAdd:function(b){this._container=DCI.DomUtil.create("div","dci-control-attribution");DCI.DomEvent.disableClickPropagation(this._container);for(var a in b._layers){if(b._layers[a].getAttribution){this.addAttribution(b._layers[a].getAttribution())}}b.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){this.options.prefix=a;this._update();return this},addAttribution:function(a){if(!a){return}if(!this._attributions[a]){this._attributions[a]=0}this._attributions[a]++;this._update();return this},removeAttribution:function(a){if(!a){return}if(this._attributions[a]){this._attributions[a]--;this._update()}return this},_update:function(){if(!this._map){return}var c=[];for(var a in this._attributions){if(this._attributions[a]){c.push(a)}}var b=[];if(this.options.prefix){b.push(this.options.prefix)}if(c.length){b.push(c.join(", "))}this._container.innerHTML=b.join(" | ")},_onLayerAdd:function(a){if(a.layer.getAttribution){this.addAttribution(a.layer.getAttribution())}},_onLayerRemove:function(a){if(a.layer.getAttribution){this.removeAttribution(a.layer.getAttribution())}}});DCI.Map.mergeOptions({attributionControl:true});DCI.Map.addInitHook(function(){if(this.options.attributionControl){this.attributionControl=(new DCI.Control.Attribution()).addTo(this)}});DCI.control.attribution=function(a){return new DCI.Control.Attribution(a)};DCI.Control.Scale=DCI.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:false,updateWhenIdle:false,coordType:""},onAdd:function(d){this._map=d;var c="dci-control-scale",a=DCI.DomUtil.create("div",c),b=this.options;this._addScales(b,c,a);d.on(b.updateWhenIdle?"moveend":"move",this._update,this);d.whenReady(this._update,this);return a},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(b,c,a){if(b.metric){this._mScale=DCI.DomUtil.create("div",c+"-line",a)}if(b.imperial){this._iScale=DCI.DomUtil.create("div",c+"-line",a)}},_update:function(){var a=this._map.getBounds();centerLat=a.getCenter().lat;halfWorldMeters=6378137*Math.PI*Math.cos(centerLat*Math.PI/180),dist=halfWorldMeters*(a.getNorthEast().lng-a.getSouthWest().lng)/180;if(this._map.options.crs.code=="EPSG:990001"){dist=a.getNorthEast().lng-a.getSouthWest().lng}size=this._map.getSize(),options=this.options,maxMeters=0;if(size.x>0){maxMeters=dist*(options.maxWidth/size.x)}this._updateScales(options,maxMeters)},_updateScales:function(a,b){if(a.metric&&b){this._updateMetric(b)}if(a.imperial&&b){this._updateImperial(b)}},_updateMetric:function(b){var a=this._getRoundNum(b);this._mScale.style.width=this._getScaleWidth(a/b)+"px";this._mScale.innerHTML=a<1000?a+" m":(a/1000)+" km"},_updateImperial:function(e){var d=e*3.2808399,f=this._iScale,c,b,a;if(d>5280){c=d/5280;b=this._getRoundNum(c);f.style.width=this._getScaleWidth(b/c)+"px";f.innerHTML=b+" mi"}else{a=this._getRoundNum(d);f.style.width=this._getScaleWidth(a/d)+"px";f.innerHTML=a+" ft"}},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(b){var a=Math.pow(10,(Math.floor(b)+"").length-1),c=b/a;c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1;return a*c}});DCI.control.scale=function(a){return new DCI.Control.Scale(a)};DCI.Control.Layers=DCI.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(d,c,a){DCI.setOptions(this,a);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var b in d){this._addLayer(d[b],b)}for(b in c){this._addLayer(c[b],b,true)}},onAdd:function(a){this._initLayout();this._update();a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(b,a){this._addLayer(b,a);this._update();return this},addOverlay:function(b,a){this._addLayer(b,a,true);this._update();return this},removeLayer:function(a){var b=DCI.stamp(a);delete this._layers[b];this._update();return this},_initLayout:function(){var b="dci-control-layers",a=this._container=DCI.DomUtil.create("div",b);a.setAttribute("aria-haspopup",true);if(!DCI.Browser.touch){DCI.DomEvent.disableClickPropagation(a).disableScrollPropagation(a)}else{DCI.DomEvent.on(a,"click",DCI.DomEvent.stopPropagation)}var d=this._form=DCI.DomUtil.create("form",b+"-list");if(this.options.collapsed){if(!DCI.Browser.android){DCI.DomEvent.on(a,"mouseover",this._expand,this).on(a,"mouseout",this._collapse,this)}var c=this._layersLink=DCI.DomUtil.create("a",b+"-toggle",a);c.href="#";c.title="Layers";if(DCI.Browser.touch){DCI.DomEvent.on(c,"click",DCI.DomEvent.stop).on(c,"click",this._expand,this)}else{DCI.DomEvent.on(c,"focus",this._expand,this)}DCI.DomEvent.on(d,"click",function(){setTimeout(DCI.bind(this._onInputClick,this),0)},this);this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=DCI.DomUtil.create("div",b+"-base",d);this._separator=DCI.DomUtil.create("div",b+"-separator",d);this._overlaysList=DCI.DomUtil.create("div",b+"-overlays",d);a.appendChild(d)},_addLayer:function(c,b,a){var d=DCI.stamp(c);this._layers[d]={layer:c,name:b,overlay:a};if(this.options.autoZIndex&&c.setZIndex){this._lastZIndex++;c.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return}this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var a=false,c=false,b,d;for(b in this._layers){d=this._layers[b];this._addItem(d);c=c||d.overlay;a=a||!d.overlay}this._separator.style.display=c&&a?"":"none"},_onLayerChange:function(c){var b=this._layers[DCI.stamp(c.layer)];if(!b){return}if(!this._handlingClick){this._update()}var a=b.overlay?(c.type==="layeradd"?"overlayadd":"overlayremove"):(c.type==="layeradd"?"baselayerchange":null);if(a){this._map.fire(a,b)}},_createRadioElement:function(a,d){var c='<input type="radio" class="dci-control-layers-selector" name="'+a+'"';if(d){c+=' checked="checked"'}c+="/>";var b=document.createElement("div");b.innerHTML=c;return b.firstChild},_addItem:function(f){var d=document.createElement("label"),b,e=this._map.hasLayer(f.layer);if(f.overlay){b=document.createElement("input");b.type="checkbox";b.className="dci-control-layers-selector";b.defaultChecked=e}else{b=this._createRadioElement("dci-base-layers",e)}b.layerId=DCI.stamp(f.layer);DCI.DomEvent.on(b,"click",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+f.name;d.appendChild(b);d.appendChild(c);var a=f.overlay?this._overlaysList:this._baseLayersList;a.appendChild(d);return d},_onInputClick:function(){var c,b,e,a=this._form.getElementsByTagName("input"),d=a.length;this._handlingClick=true;for(c=0;c<d;c++){b=a[c];e=this._layers[b.layerId];if(b.checked&&!this._map.hasLayer(e.layer)){this._map.addLayer(e.layer)}else{if(!b.checked&&this._map.hasLayer(e.layer)){this._map.removeLayer(e.layer)}}}this._handlingClick=false;this._refocusOnMap()},_expand:function(){DCI.DomUtil.addClass(this._container,"dci-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" dci-control-layers-expanded","")}});DCI.control.layers=function(c,b,a){return new DCI.Control.Layers(c,b,a)};DCI.LayerSwitch=DCI.Class.extend({initialize:function(d,e,a){if(!a){a={}}this.backgroundColor=a.backgroundColor||"#CCFFCC";this.selectedColor=a.selectedColor||"#044E05";this.left=a.left||(d.getSize().x-270);this.top=a.top||"20";this._layers={};this._switchs={};this._map=d;this.TileLayerDiv=null;for(var b in e){this._addLayer(e[b],b)}var c=this._map.getSize();this.TileLayerDiv=document.createElement("div");this.TileLayerDiv.style.width=c.x+"px";this.TileLayerDiv.style.height=c.y+"px";this._initLayout();this._map._container.appendChild(this.layerSwitchDiv)},_addLayer:function(b,a){var c=DCI.stamp(b);this._layers[c]={layer:b,name:a}},_initLayout:function(){var e=this;this.layerSwitchDiv=this.TileLayerDiv;var f=0;for(var a in this._layers){var d=document.createElement("div");d.style.cssText="position:absolute;width:80px;height:25px;border:1px solid gray;text-align:center;line-height:20px;fontSize:20px;";d.style.backgroundColor=this.backgroundColor;d.style.left=(this.left+80*f)+"px";d.style.top=this.top+"px";d.style.zIndex=1000;d.innerHTML=this._layers[a].name;d.id=a;d.style.color="#000";d.onclick=b;this._switchs[a]=d;if(this._map.hasLayer(this._layers[a].layer)){d.style.backgroundColor=this.selectedColor;d.style.color="#FFF"}this.layerSwitchDiv.appendChild(d);f++}function b(){var h=this.id;for(var c in e._layers){var g=e._layers[c];if(c==h&&!e._map.hasLayer(g.layer)){e._switchs[c].style.backgroundColor=e.selectedColor;e._switchs[c].style.color="#FFF";e._map.addLayer(g.layer)}else{if(c!=h&&e._map.hasLayer(g.layer)){e._switchs[c].style.color="#000";e._switchs[c].style.backgroundColor=e.backgroundColor;e._map.removeLayer(g.layer)}}}}}});DCI.layerSwitch=function(b,c,a){return new DCI.LayerSwitch(b,c,a)};DCI.Control.Eagleeye=DCI.Control.extend({options:{position:"bottomright",baseURL:""},onAdd:function(a){this.map=a;this.eagleeyeinnerbox=document.createElement("div");this.eagleeyeinnerbox.id="eagleeye";this.eaglegroup=document.createElement("div");this.showeagleeye=document.createElement("div");this.eagleeyebox=document.createElement("div");this.flag=false;if(!this.element){this._CreateEagleeye();this._redraw()}return this.element},hide:function(){if(this.element){this.element.style.display="none"}},show:function(){if(this.element){this.element.style.display="block"}},open:function(){this.openEagleeye()},close:function(){this.closeEagleeye()},_redraw:function(){var d=this;d._dMap=new DCI.map(d.eagleeyeinnerbox,{crs:this.map.options.crs});d._dMap.setContainerSize(161,161);var a=this.map.getZoom();this._setEagleMapZoom(a);var c;if(this._map.options.crs.code=="EPSG:990001"){c="gov"}else{if(this._map.options.crs.code=="EPSG:990002"){c="pub"}}DCI.tileLayer(c,{year:this._map.options.year}).addTo(d._dMap);var b=this.map.getBounds();this._setEagleRectangle(b);DCI.DomEvent.on(d.map,"zoomend",function(){var f=d.map.getZoom();d._setEagleMapZoom(f);var g=d.map.getBounds();d._setEagleRectangle(g)});DCI.DomEvent.on(d.map,"move",function(){if(!d.flag){return}var f=d.map.getBounds();d._setEagleRectangle(f)});DCI.DomEvent.on(d.map,"moveend",function(){if(!d.flag){return}var f=d.map.getBounds();d._dMap.panTo(f.getCenter())});DCI.DomEvent.on(d.map,"drag",function(){var f=d.map.getBounds();d._setEagleRectangle(f)});DCI.DomEvent.on(d.map,"dragend",function(){var f=d.map.getBounds();d._dMap.panTo(f.getCenter())});var e=false;DCI.DomEvent.on(d._dMap,"mousedown",function(f){mousedownPoint=new DCI.latLng(f.latlng.lng,f.latlng.lat);e=true;DCI.DomEvent.stop(f)});DCI.DomEvent.on(d._dMap,"mousemove",function(h){if(e){var k=h.latlng.lat-mousedownPoint.lat;var f=h.latlng.lng-mousedownPoint.lng;d.newp1=new DCI.latLng([d.initp1.lng-f,d.initp1.lat+k]);d.newp2=new DCI.latLng([d.initp2.lng-f,d.initp2.lat+k]);d.initp1=d.newp1;d.initp2=d.newp2;var g=new DCI.latLngBounds(d.newp1,d.newp2);d.dr.setBounds([d.newp1,d.newp2]);d.map.panTo(g.getCenter())}});DCI.DomEvent.on(d._dMap,"mouseup",function(f){e=false});DCI.DomEvent.on(d._dMap,"zoomend",function(){var f=d._dMap.getZoom();d._setMapZoom(f)});d.eagleeyebox.appendChild(d.eagleeyeinnerbox);d.eaglegroup.appendChild(d.eagleeyebox);d.eaglegroup.appendChild(d.showeagleeye)},_setEagleMapZoom:function(a){var c=this.map.getMinZoom();var b=Math.max(a-3,c);this._dMap.setView(this.map.getCenter(),b)},_setMapZoom:function(b){var c=this._dMap.getMaxZoom();var a=Math.min(b+3,c);this.map.setView(this._dMap.getCenter(),a)},_setEagleMapDrag:function(a){this._dMap.panTo(a.getCenter())},_setEagleRectangle:function(c){var h=this;this.initp1=c.getSouthWest();this.initp2=c.getNorthEast();var e;var g;var a=false;if(h.dr){h.dr.setBounds([h.initp1,h.initp2])}else{var f=new DCI.LatLngBounds(h.initp1,h.initp2);this.dr=new DCI.Rectangle(f,{color:"#205AA7",weight:2,opacity:0.5});this._dMap.addLayer(h.dr);if(h.dr._map._getElement){g=h.dr._map._getElement()}else{g=h.dr}DCI.DomEvent.on(g,"mousedown",function(l){h.flag=false;a=true;if(l.clientX){var k=new DCI.Point(l.clientX,l.clientY);e=h._dMap.containerPointToLatLng(k)}else{e=l.latlng}DCI.DomEvent.on(g,"mousemove",b);DCI.DomEvent.on(document.body,"mouseup",d);DCI.DomEvent.stop(l);return false})}function b(l){if(a){var m;if(l.clientX){var k=new DCI.Point(l.clientX,l.clientY);m=h._dMap.containerPointToLatLng(k)}else{m=l.latlng}var o=(m.lng-e.lng);var n=(m.lat-e.lat);h.newp1=new DCI.latLng([h.initp1.lng+o,h.initp1.lat+n]);h.newp2=new DCI.latLng([h.initp2.lng+o,h.initp2.lat+n]);h.dr.setBounds([h.newp1,h.newp2]);DCI.DomEvent.stop(l)}return false}function d(l){if(a){h.initp1=h.newp1;h.initp2=h.newp2;var k=new DCI.latLngBounds(h.newp1,h.newp2);h.map.panTo(k.getCenter());h._dMap.panTo(k.getCenter());DCI.DomEvent.stop(l);h.flag=true;a=false}}},_CreateEagleeye:function(){var a=this;if(DCI_LOCATION&&_applicationName&&a.options.baseURL==""){if(DCI_LOCATION.indexOf(_applicationName)>0){a.options.baseURL=DCI_LOCATION.substring(0,DCI_LOCATION.indexOf(_applicationName)+_applicationName.length)}else{a.options.baseURL=DCI_LOCATION.substring(0,DCI_LOCATION.indexOf("js")-1)}a.options.baseURL+="/images"}a.eaglegroup.className="map-eagleeye-group";a.showeagleeye.className="map-show-eagleeye";a.eagleeyebox.className="map-eagleeye-box";a.eagleeyeinnerbox.className="map-eagleeye-innerbox";a.eagleeyeinnerbox.style.height="161px";a.eagleeyeinnerbox.style.width="161px";DCI.DomEvent.on(a.showeagleeye,"click",function(b){if(a.showeagleeye.style.backgroundImage.indexOf("hiddeneagle.png")>0){a.closeEagleeye()}else{a.openEagleeye()}DCI.DomEvent.stop(b);return false});this.element=a.eaglegroup},openEagleeye:function(){var a=this;a.eagleeyebox.style.display="block";a.showeagleeye.style.backgroundImage="url("+a.options.baseURL+"/hiddeneagle.png)";if(DCI.Browser.ie){if(a.element.parentElement){if(a.element.parentElement.nextSibling){a.element.parentElement.nextSibling.style.right="175px"}}}else{if(a.element.parentNode){if(a.element.parentNode.nextSibling){a.element.parentNode.nextSibling.style.right="175px"}}}},closeEagleeye:function(){var a=this;a.eagleeyebox.style.display="none";a.showeagleeye.style.backgroundImage="url("+a.options.baseURL+"/showeagle.png)";if(DCI.Browser.ie){if(a.eaglegroup.parentElement){if(a.eaglegroup.parentElement.nextSibling){a.eaglegroup.parentElement.nextSibling.style.right="15px"}}}else{if(a.eaglegroup.parentNode){if(a.eaglegroup.parentNode.nextSibling){a.eaglegroup.parentNode.nextSibling.style.right="15px"}}}}});DCI.control.eagleeye=function(a){return new DCI.Control.Eagleeye(a)};DCI.graphStyle={};DCI.graphStyle.color=[{color:"#000000"},{color:"#993300"},{color:"#333300"},{color:"#003300"},{color:"#003366"},{color:"#000080"},{color:"#333399"},{color:"#333333"},{color:"#800000"},{color:"#FF6600"},{color:"#808000"},{color:"#008000"},{color:"#008080"},{color:"#0000FF"},{color:"#666699"},{color:"#808080"},{color:"#FF0000"},{color:"#FF9900"},{color:"#99CC00"},{color:"#339966"},{color:"#33CCCC"},{color:"#3366FF"},{color:"#800080"},{color:"#999999"},{color:"#FF00FF"},{color:"#FFCC00"},{color:"#FFFF00"},{color:"#00FF00"},{color:"#00FFFF"},{color:"#00CCFF"},{color:"#993366"},{color:"#C0C0C0"},{color:"#FF99CC"},{color:"#FFCC99"},{color:"#FFFF99"},{color:"#CCFFCC"},{color:"#CCFFFF"},{color:"#99CCFF"},{color:"#CC99FF"},{color:"#FFFFFF"}];DCI.graphStyle.cleanWhitespace=function(b){for(var a=0;a<b.childNodes.length;a++){var c=b.childNodes[a];if(c.nodeType==3&&!/\S/.test(c.nodeValue)){c.parentNode.removeChild(c)}}};DCI.graphStyle.reset=function(a){if(!DCI.Browser.canvas){a._updateStyle()}else{a.redraw()}};DCI.graphStyle.ColorDivAdd=function(e,d){var c=false;if(d.id=="fillColor"){e.style.left="75px"}else{if(d.id=="lineColor"){e.style.left="32px"}}var h="";e.onmousemove=function(){e.style.visibility="visible"};e.onmouseout=function(){if(curpg){if(d.id=="fillColor"){curpg.options.fillColor=h;DCI.graphStyle.reset(curpg)}else{if(d.id=="lineColor"){curpg.options.color=h;DCI.graphStyle.reset(curpg)}}}e.style.visibility="hidden"};for(var b=0;b<DCI.graphStyle.color.length;b++){var k=document.createElement("div");k.className="likuai";k.style.width="11px";k.style.height="11px";e.style.height="135px";a(e,k);k.style.backgroundColor=DCI.graphStyle.color[b].color}e.style.visibility="hidden";function a(f,l){l.onmouseover=function(){DCI.graphStyle.cleanWhitespace(f);for(var m=0;m<f.childNodes.length;m++){f.childNodes[m].style.borderColor="white"}l.style.borderColor="blue";if(d.id=="fillColor"){if(curpg){curpg.options.fillColor=l.style.backgroundColor;DCI.graphStyle.reset(curpg)}}else{if(d.id=="lineColor"){if(curpg){curpg.options.color=l.style.backgroundColor;DCI.graphStyle.reset(curpg)}}}g(h)};l.onclick=function(){if(curpg){if(d.id=="fillColor"){h=l.style.backgroundColor}else{if(d.id=="lineColor"){h=l.style.backgroundColor}}}DCI.DomEvent.stop(event)};f.appendChild(l)}d.onclick=function(){e.style.visibility="visible";c=true;if(curpg){if(d.id=="fillColor"){h=curpg.options.fillColor}else{if(d.id=="lineColor"){h=curpg.options.color}}g()}else{h=""}};function g(){if(!h){return}for(var f=0;f<DCI.graphStyle.color.length;f++){if(h.toUpperCase()==DCI.graphStyle.color[f].color.toUpperCase()){e.childNodes[f].style.borderColor="red"}}}d.onmouseout=function(){if(c){if(curpg){if(d.id=="fillColor"){curpg.options.fillColor=h;DCI.graphStyle.reset(curpg)}else{if(d.id=="lineColor"){curpg.options.color=h;DCI.graphStyle.reset(curpg)}}}}e.style.visibility="hidden";c=false};d.onmousemove=function(){if(c){e.style.visibility="visible"}}};DCI.PosAnimation=DCI.Class.extend({includes:DCI.Mixin.Events,run:function(b,a,c,d){this.stop();this._el=b;this._inProgress=true;this._newPos=a;this.fire("start");b.style[DCI.DomUtil.TRANSITION]="all "+(c||0.25)+"s cubic-bezier(0,0,"+(d||0.5)+",1)";DCI.DomEvent.on(b,DCI.DomUtil.TRANSITION_END,this._onTransitionEnd,this);DCI.DomUtil.setPosition(b,a);DCI.Util.falseFn(b.offsetWidth);this._stepTimer=setInterval(DCI.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress){return}DCI.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();DCI.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var a=this._getPos();if(!a){this._onTransitionEnd();return}this._el._dci_pos=a;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,d,c,b=this._el,a=window.getComputedStyle(b);if(DCI.Browser.any3d){c=a[DCI.DomUtil.TRANSFORM].match(this._transformRe);if(!c){return}e=parseFloat(c[1]);d=parseFloat(c[2])}else{e=parseFloat(a.left);d=parseFloat(a.top)}return new DCI.Point(e,d,true)},_onTransitionEnd:function(){DCI.DomEvent.off(this._el,DCI.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress){return}this._inProgress=false;this._el.style[DCI.DomUtil.TRANSITION]="";this._el._dci_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});DCI.Map.include({setView:function(a,d,b){d=d===undefined?this._zoom:this._limitZoom(d);a=this._limitCenter(DCI.latLng(a),d,this.options.maxBounds);b=b||{};if(this._panAnim){this._panAnim.stop()}if(this._loaded&&!b.reset&&b!==true){if(b.animate!==undefined){b.zoom=DCI.extend({animate:b.animate},b.zoom);b.pan=DCI.extend({animate:b.animate},b.pan)}var c=(this._zoom!==d)?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,d,b.zoom):this._tryAnimatedPan(a,b.pan);if(c){clearTimeout(this._sizeTimer);return this}}this._resetView(a,d);return this},panBy:function(c,a){c=DCI.point(c).round();a=a||{};if(!c.x&&!c.y){return this}if(!this._panAnim){this._panAnim=new DCI.PosAnimation();this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!a.noMoveStart){this.fire("movestart")}if(a.animate!==false){DCI.DomUtil.addClass(this._mapPane,"dci-pan-anim");var b=this._getMapPanePos().subtract(c);this._panAnim.run(this._mapPane,b,a.duration||0.25,a.easeLinearity)}else{this._rawPanBy(c);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){DCI.DomUtil.removeClass(this._mapPane,"dci-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();if((b&&b.animate)!==true&&!this.getSize().contains(c)){return false}this.panBy(c,b);return true}});DCI.PosAnimation=DCI.DomUtil.TRANSITION?DCI.PosAnimation:DCI.PosAnimation.extend({run:function(b,a,c,d){this.stop();this._el=b;this._inProgress=true;this._duration=c||0.25;this._easeOutPower=1/Math.max(d||0.5,0.2);this._startPos=DCI.DomUtil.getPosition(b);this._offset=a.subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step();this._complete()},_animate:function(){this._animId=DCI.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var a=(+new Date())-this._startTime,b=this._duration*1000;if(a<b){this._runFrame(this._easeOut(a/b))}else{this._runFrame(1);this._complete()}},_runFrame:function(a){var b=this._startPos.add(this._offset.multiplyBy(a));DCI.DomUtil.setPosition(this._el,b);this.fire("step")},_complete:function(){DCI.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}});DCI.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(DCI.DomUtil.TRANSITION){DCI.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&DCI.DomUtil.TRANSITION&&DCI.Browser.any3d&&!DCI.Browser.android23&&!DCI.Browser.mobileOpera;if(this._zoomAnimated){DCI.DomEvent.on(this._mapPane,DCI.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}})}DCI.Map.include(!DCI.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(a){if(this._animatingZoom&&a.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return !this._container.getElementsByClassName("dci-zoom-animated").length},_tryAnimatedZoom:function(a,d,c){if(this._animatingZoom){return true}c=c||{};if(!this._zoomAnimated||c.animate===false||this._nothingToAnimate()||Math.abs(d-this._zoom)>this.options.zoomAnimationThreshold){return false}var f=this.getZoomScale(d),e=this._getCenterOffset(a)._divideBy(1-1/f),b=this._getCenterLayerPoint()._add(e);if(c.animate!==true&&!this.getSize().contains(e)){return false}this.fire("movestart").fire("zoomstart");this._animateZoom(a,d,b,f,null,true);return true},_animateZoom:function(a,e,c,f,g,b,d){if(!d){this._animatingZoom=true}DCI.DomUtil.addClass(this._mapPane,"dci-zoom-anim");this._animateToCenter=a;this._animateToZoom=e;if(DCI.Draggable){DCI.Draggable._disabled=true}DCI.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:a,zoom:e,origin:c,scale:f,delta:g,backwards:b})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=false;DCI.DomUtil.removeClass(this._mapPane,"dci-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(DCI.Draggable){DCI.Draggable._disabled=false}}});DCI.TileLayer.include({_animateZoom:function(f){if(!this._animating){this._animating=true;this._prepareBgBuffer()}var c=this._bgBuffer,a=DCI.DomUtil.TRANSFORM,b=f.delta?DCI.DomUtil.getTranslateString(f.delta):c.style[a],d=DCI.DomUtil.getScaleString(f.scale,f.origin);c.style[a]=f.backwards?d+" "+b:b+" "+d},_endZoomAnim:function(){var b=this._tileContainer,a=this._bgBuffer;b.style.visibility="";b.parentNode.appendChild(b);DCI.Util.falseFn(a.offsetWidth);this._animating=false},_clearBgBuffer:function(){var a=this._map;if(a&&!a._animatingZoom&&!a.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[DCI.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var c=this._tileContainer,b=this._bgBuffer;var a=this._getLoadedTilesPercentage(b),d=this._getLoadedTilesPercentage(c);if(b&&a>0.5&&d<0.5){c.style.visibility="hidden";this._stopLoadingImages(c);return}b.style.visibility="hidden";b.style[DCI.DomUtil.TRANSFORM]="";this._tileContainer=b;b=this._bgBuffer=c;this._stopLoadingImages(b);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(b){var c=b.getElementsByTagName("img"),d,a,e=0;for(d=0,a=c.length;d<a;d++){if(c[d].complete){e++}}return e/a},_stopLoadingImages:function(b){var c=Array.prototype.slice.call(b.getElementsByTagName("img")),d,a,e;for(d=0,a=c.length;d<a;d++){e=c[d];if(!e.complete){e.onload=DCI.Util.falseFn;e.onerror=DCI.Util.falseFn;e.src=DCI.Util.emptyImageUrl;e.parentNode.removeChild(e)}}}});DCI.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:10000,maximumAge:0,enableHighAccuracy:false},locate:function(a){a=this._locateOptions=DCI.extend(this._defaultLocateOptions,a);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var c=DCI.bind(this._handleGeolocationResponse,this),b=DCI.bind(this._handleGeolocationError,this);if(a.watch){this._locationWatchId=navigator.geolocation.watchPosition(c,b,a)}else{navigator.geolocation.getCurrentPosition(c,b,a)}return this},stopLocate:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(a){var d=a.code,b=a.message||(d===1?"permission denied":(d===2?"position unavailable":"timeout"));if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:d,message:"Geolocation error: "+b+"."})},_handleGeolocationResponse:function(g){var f=g.coords.latitude,k=g.coords.longitude,b=new DCI.LatLng(k,f),h=180*g.coords.accuracy/40075017,c=h/Math.cos(DCI.LatLng.DEG_TO_RAD*f),a=DCI.latLngBounds([k-c,f-h],[k+c,f+h]),m=this._locateOptions;if(m.setView){var l=Math.min(this.getBoundsZoom(a),m.maxZoom);this.setView(b,l)}var e={latlng:b,bounds:a,timestamp:g.timestamp};for(var d in g.coords){if(typeof g.coords[d]==="number"){e[d]=g.coords[d]}}this.fire("locationfound",e)}});(function(){DCI.Ajax={create:function(){this.xmlHttp=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();if(this.xmlHttp.overrideMimeType){this.xmlHttp.overrideMimeType("text/xml")}if(!this.xmlHttp){alert("对不起，您的浏览器不支持XMLHttpRequest对象，不能正常使用本网站！");window.opener="ParentWindow";window.close();return this.xmlHttp}else{return this.xmlHttp}},ajaxService:function(d,g,b,c){this.create();var e=this.xmlHttp;var f=this;var a=null;if(b==="POST"||b==="post"){a=c;this.xmlHttp.open("POST",d,false)}else{if(c==null){this.xmlHttp.open("GET",d,false)}else{this.xmlHttp.open("GET",d+"?"+c,false)}}this.xmlHttp.onreadystatechange=function(){if(e.readyState==4){if(e.status==200){var h=e.responseXML;if(h==null){g(e.responseText)}else{h=e.responseXML.xml;if(h==null||h==""){g(e.responseText)}else{g(h)}}}else{var k="ajax请求失败。\n";k+="Http Status "+e.status+" "+e.statusText;k+="\n URL:"+d;g(k)}}};this.xmlHttp.send(a)}}}());DCI.DOM=DCI.Class.extend({initialize:function(g){if(typeof g=="object"){this.dom=g;return}var a=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","Microsoft.XMLDOM"];if(!window.DOMParser&&window.ActiveXObject){for(var c=0;c<a.length;c++){try{var d=new ActiveXObject(a[c]);break}catch(f){continue}}d.async=false;d.loadXML(g);this.dom=d;return}else{var b=new DOMParser();var d=b.parseFromString(g,"text/xml");this.dom=d;return}},getTagName:function(){var a=this.dom.tagName;return a||""},getSiblings:function(){var b=[];var a=function(c){b.push(new DCI.DOM(c));if(c.nextSibling){a(c.nextSibling)}};a(this.dom);return b},getChildNodes:function(){var b=[];var a=function(c){b.push(new DCI.DOM(c));if(c.nextSibling){a(c.nextSibling)}};if(DCI.Browser.ie){if(this.dom.firstChild){a(this.dom.childNodes[1].firstChild)}}else{if(this.dom.childNodes[0]){a(this.dom.childNodes[1].childNodes[0])}}return b},getsecondNodes:function(){var b=[];var a=function(c){b.push(new DCI.DOM(c));if(c.nextSibling){a(c.nextSibling)}};if(DCI.Browser.ie){if(this.dom.firstChild){a(this.dom.firstChild)}}else{if(this.dom.childNodes[0]){a(this.dom.childNodes[0])}}return b},getSameSiblings:function(){var a=[];var c=this.dom.tagName;if(c){var d;if(c.indexOf(":")>0){d=DCI.findByTagName(this.dom.parentNode,c,c.substring(c.indexOf(":")+1,c.length))}else{d=this.dom.parentNode.getElementsByTagName(c)}for(var b=0;b<d.length;b++){a.push(d[b])}}else{a.push(this.dom)}return a},find:function(c){if(!c){return}var b=void (0);var a;if(c.indexOf(":")>0){a=DCI.findByTagName(this.dom,c,c.substring(c.indexOf(":")+1,c.length))}else{a=this.dom.getElementsByTagName(c)}if(a.length>0){b=a[0];return new DCI.DOM(b)}else{return}},each:function(d){var c=this.getSameSiblings.call(this);if(DCI.Browser.mozilla&&c[0].textContent!=""){for(var a=0;a<c.length;a++){var b=c[a];d.call(b)}}else{if(c[0]){for(var a=0;a<c.length;a++){var b=c[a];d.call(b)}}}},every:function(d){var c=getSameSiblings.call(this);if(DCI.Browser.mozilla&&c[0].textContent!=""){}else{for(var a=0;a<c.length;a++){var b=c[a];d.call(b)}}},text:function(){if(this.dom.text){return this.dom.text}else{return this.dom.textContent}},attribute:function(a){return this.dom.getAttribute(a)}});DCI.dom=function(a){return new DCI.DOM(a)};DCI.bindingDoc=function(d){try{if(typeof ActiveXObject!="undefined"&&typeof GetObject!="undefined"){var c=new ActiveXObject("Microsoft.XMLDOM");c.loadXML(d);return c}else{if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"text/xml")}else{return voidFunc(d)}}}catch(a){}try{return voidFunc(d)}catch(a){return document.createElement("div")}};DDom=DCI.dom;DCI.Search=DCI.Class.extend({});DCI.Search.AddrCode=DCI.Search.extend({addrCode_indistinct:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("commandType=0&AddrName="+b.name+"&IsAccurate="+b.isAccurate+"&AddrType="+b.addrType+"&Start="+b.start+"&Nums="+b.count+"&encode=gbk"),a)},addrCode_point:function(a,b){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("commandType=30&X="+a.x+"&Y="+a.y+"&encode=gbk"),b)},addrCode_circle:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("commandType=40&X="+b.x+"&Y="+b.y+"&Radius="+b.radius+"&Start="+b.start+"&Nums="+b.count+"&encode=gbk"),a)},addrCode_rectangle:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("commandType=50&X1="+b.x1+"&Y1="+b.y1+"&X2="+b.x2+"&Y2="+b.y2+"&Count="+b.count+"&encode=gbk"),a)},addrCode:function(c,b){var a=c.request;if(a==1){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("request="+c.request+"&q="+c.q+"&service="+c.service),b)}else{if(a==2){DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode/cmd?"+encodeURIComponent("request="+c.request+"&service="+c.service+"&x="+c.x+"&y="+c.y+"&dis="+c.dis),b)}}}});DAddrCode=function(){return new DCI.Search.AddrCode()};DCI.Search.BusService=DCI.Search.extend({busService_busLineID:function(a,c,b){if(!b){DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BusLine&resType=xml&encode=gbk&value="+a+"&coordtype=1"),c)}else{DCI.Ajax.ajaxService("/"+_applicationName+"/pbusService?"+encodeURIComponent("config=BusLine&ids="+a),c)}},busService_busLineName:function(b,c,a){if(!a){DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BusLine&resType=xml&encode=gbk&value="+b+"&coordtype=2"),c)}else{DCI.Ajax.ajaxService("/"+_applicationName+"/pbusService?"+encodeURIComponent("config=BusLine&number=10&busName="+b),c)}},busService_busStation:function(a,c,b){if(!b){DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BusLine&resType=xml&encode=gbk&value="+a+"&coordtype=3"),c)}else{DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BusLine&number=10&stationName="+a),c)}},busService_busRoute_backup:function(g,d,f){$this=this;var e=new Array();var a=function(m,o){var l=["startName","endName","passDepotName","busName","driverLength","footLength","passDepotCount","coordinateList","passDepotCoordinate"];var h=new Array();var k=0;try{k=DCI.dom(m).find("count").text()}catch(n){k=0}if(k!=0){DCI.dom(m).find("bus").each(function(){var p=DCI.dom(this).find("footEndLength").text();var s=DCI.dom(this).find("bounds").text();var r=new DCI.latLng(e[1],e[0]);var t=new DCI.latLng(e[3],e[2]);var u=[];DCI.dom(this).find("segmentList").each(function(){DCI.dom(this).find("segment").each(function(){var w=new Object();for(var v=0;v<l.length;v++){var x=l[v];try{w[x]=DCI.dom(this).find(x).text()}catch(y){}}u.push(w)})});var q={footEndLength:p,bounds:s,startLonLat:r,endLonLat:t,segmentList:u};h.push(q)})}f(h,o)};var b=function(k,l){var h=DCI.dom(k).find("x").text();var m=DCI.dom(k).find("y").text();e.push(h);e.push(m);DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BR&x1="+e[0]+"&y1="+e[1]+"&x2="+e[2]+"&y2="+e[3]+"&routeType=0&ver=2.0&encode=gbk"),a)};this.busService_poi(g,c);function c(k,l){var h=DCI.dom(k).find("x").text();var m=DCI.dom(k).find("y").text();e.push(h);e.push(m);$this.busService_poi(d,b)}},stationCheck:function(a){var b=false;a=this.trimOverride(a);if(a==null||a==""){b=true}else{while(a.indexOf("，")!=-1){a=a.replace("，",",")}var c=a.split(",");if(c.length==0){b=true}}return b},trimOverride:function(a){if(a.trim){var b=a.trim();return b}while(a.indexOf(" ")!=-1){a=a.replace(" ","")}return a},busService_busRoute:function(d,c,b,k){var h=this;var e=new Array();var f=function(o,r){var n=["startName","endName","passDepotName","busName","driverLength","footLength","passDepotCount","coordinateList","passDepotCoordinate"];var l=new Array();var m=0;try{m=DCI.dom(o).find("count").text()}catch(q){m=0}if(m!=0){var p=false;if(h.stationCheck(b)){p=true}else{while(b.indexOf("，")!=-1){b=b.replace("，",",")}b=h.trimOverride(b).split(",")}DCI.dom(o).find("bus").each(function(){var v=DCI.dom(this).find("footEndLength").text();var s=DCI.dom(this).find("bounds").text();var x=new DCI.latLng(e[1],e[0]);var z=new DCI.latLng(e[3],e[2]);var w=[];var A=true;var t=new Array(b.length);DCI.dom(this).find("segmentList").each(function(){if(!p){for(var B=0;B<b.length;B++){t[B]=0}}DCI.dom(this).find("segment").each(function(){var F=new Object();for(var C=0;C<n.length;C++){var G=n[C];try{F[G]=DCI.dom(this).find(G).text()}catch(H){}}var E=" "+DCI.dom(this).find("startName").text()+" "+DCI.dom(this).find("passDepotName").text()+" "+DCI.dom(this).find("endName").text()+" ";if(!p){for(var C=0;C<b.length;C++){var D=h.trimOverride(b[C]);if((D!=""&&E.indexOf(" "+D+" ")!=-1)||D==""){t[C]=1}}}w.push(F)})});if(!p){for(var u=0;u<t.length;u++){if(t[u]==0){A=false}}}var y={footEndLength:v,bounds:s,startLonLat:x,endLonLat:z,segmentList:w};if(A){l.push(y)}})}k(l,r)};var g=function(m,n){var l=DCI.dom(m).find("x").text();var o=DCI.dom(m).find("y").text();e.push(l);e.push(o);DCI.Ajax.ajaxService("/"+_applicationName+"/busService?"+encodeURIComponent("config=BR&x1="+e[0]+"&y1="+e[1]+"&x2="+e[2]+"&y2="+e[3]+"&routeType=0&ver=2.0&encode=gbk"),f)};this.busService_poi(d,a);function a(m,n){var l=DCI.dom(m).find("x").text();var o=DCI.dom(m).find("y").text();e.push(l);e.push(o);h.busService_poi(c,g)}},busService_poi:function(a,c,b){if(!b){DCI.Ajax.ajaxService("/"+_applicationName+"/Navigation?"+encodeURIComponent("request=poi&type=BESN&citycode=010&keyword="+a+"&number=20&batch=1&memo=&highlight=false&keytype=&field=&encode=gbk"),c)}else{DCI.Ajax.ajaxService("/"+_applicationName+"/Navigation?"+encodeURIComponent("config=BR&ver=2.0&x1="+a.x1+"&y1="+a.y1+"+&x2="+a.x2+"&y2="+a.y2),c)}},busService_navigation:function(g,b,f){$this=this;var e=new Array();var a=function(l,n){var k=new Object();if(l==""){f(k,l);return}try{var h=DCI.dom(l).find("navigationBaseInfo").each(function(){k.segmentNum=DCI.dom(this).find("segmentNum").text();k.drivingDistance=DCI.dom(this).find("drivingDistance").text();k.drivingPierod=DCI.dom(this).find("drivingPierod").text()});k.segmentList=[];DCI.dom(l).find("segmentNavigationInfo").each(function(){var p=new Object();p.roadLength=DCI.dom(this).find("length").text();var o=DCI.dom(this).find("roadDetailData").each(function(){p.direction=DCI.dom(this).find("direction").text();p.coordinates=DCI.dom(this).find("coordinates").text();p.roadName=DCI.dom(this).find("roadNames").text()});var q=DCI.dom(this).find("baseNavigationInfo").each(function(){p.action=DCI.dom(this).find("action").text()});k.segmentList.push(p)});f(k,l)}catch(m){f(k,l);throw (m)}};var d=function(k,l){var h=DCI.dom(k).find("x").text();var m=DCI.dom(k).find("y").text();e.push(h);e.push(m);DCI.Ajax.ajaxService("/"+_applicationName+"/Navigation?"+encodeURIComponent("request=navigating&sx="+e[0]+"&sy="+e[1]+"&ex="+e[2]+"&ey="+e[3]+"&flag=131072&type=0&coordtype=0&encode=UTF-8"),a)};this.busService_poi(g,c);function c(k,l){var h=DCI.dom(k).find("x").text();var m=DCI.dom(k).find("y").text();e.push(h);e.push(m);$this.busService_poi(b,d)}}});DBusService=function(){return new DCI.Search.BusService()};DCI.Search.Directory=DCI.Search.extend({queryService:function(a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=QueryService",a)},getAll:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=GetAll&ServiceName="+b.serviceName,a)},getCatalog:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=GetCatalog&type="+b.type,a)},getSubDirectory:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=GetSubDirectory&catalogid="+b.catalogId,a)},getNextLevel:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=GetNextLevel&catalogid="+b.catalogId,a)},getMetaData:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=GetMetaData&properties="+b.property+"&value="+b.value+"&isDetail="+b.isDetail,a)},queryMeta:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=QueryMeta&metadatafile="+b.metadatafile+"&dataname="+b.dataname+"&nowstarttime="+b.nowstarttime+"&nowendtime="+b.nowendtime+"&resourcetype="+b.resourcetype+"&dept="+b.dept+"&format="+b.format+"&productiontime="+b.productiontime+"&isDetail="+b.isDetail,a)},getChild:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=getChild&NodeId="+b.nodeID+"&level="+b.level+"&isVector="+b.isVector,a)},getSubTree:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=getSubTree&NodeId="+b.nodeID+"&isVector="+b.isVector,a)},getAllTree:function(a){DCI.Ajax.ajaxService("/"+_applicationName+"/Directory?request=getAll&isVector=false",a)},getAllGZ:function(b,a){return"request=GetAll&type="+b.type},getBusiness:function(){return"request=GetBusiness"},queryLayerAccsStast:function(b,a){return"request=QueryLayerAccsStast&Layer="+b.layer+"&StartTime="+b.starttime+"&EndTime="+b.endtime}});DDirectory=function(){return new DCI.Search.Directory()};DCI.Search.MapSearch=DCI.Search.extend({getDescription:function(a,b){DCI.Ajax.ajaxService("/"+_applicationName+"/BJMapSearch?"+encodeURIComponent("request=GetDescription&"+a),b)},searchEngine:function(a,b){DCI.Ajax.ajaxService("/"+_applicationName+"/BJMapSearch?"+encodeURIComponent(a),b)}});DMapSearch=function(){return new DCI.Search.MapSearch()};DCI.Search.Thematic=DCI.Search.extend({thematic:function(a){DCI.Ajax.ajaxService("/"+_applicationName+"/Thematic?"+encodeURIComponent("request=chart&layers=&styles=&srs=&bbox=447762.94189453125,274986.3720703125,559885.6948242187,334352.0654296875&WIDTH=1001&HEIGHT=530&typename=L682&field=objectid,objectid&size=15&mode=pie&fillcolor=255,0,255;255,0,0&time="),a)}});DThematic=function(){return new DCI.Search.Thematic()};DCI.Search.UserInteract=DCI.Search.extend({bugFix:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/interact?request=bugfix",b,"POST",encodeURIComponent(a))},feedBack:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/interact?request=feedback",b,"POST",encodeURIComponent(a))}});DUserInteract=function(){return new DCI.Search.UserInteract()};DCI.Search.WFSService=DCI.Search.extend({getCapabilities:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?request=getcapabilities&service="+b.service+"&version="+b.version,a)},geoSearch:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?request=Geosearch&service="+b.service+"&version="+b.version+"&recbox="+b.recbox+"&typename="+b.typename+"&searchType="+b.searchtype+"&MAPSERVICE="+b.mapservice,a)},spaceSearch:function(c,b,a){if(!a){DCI.Ajax.ajaxService("/"+_applicationName+"/SpatialSearch?VERSION="+c.version+"&SERVICE="+c.service+"&REQUEST=GetFeature&TYPENAME="+c.typename+"&MaxFeatures="+c.maxFeatures+"&Filter="+c.filter,b)}else{if(a==="point"){DCI.Ajax.ajaxService("/"+_applicationName+"/PBJMapSearch?l=p&s=5,7,"+c+",200)*&p=0,10&t=json",b)}else{if(a==="line"){DCI.Ajax.ajaxService("/"+_applicationName+"/PBJMapSearch?request=SpaceSearch&l=p&s=*)*&line="+c+"&radius=2000&p=0,10&t=json",b)}else{if(a==="polygon"){DCI.Ajax.ajaxService("/"+_applicationName+"/PBJMapSearch?request=SpaceSearch&l=p&s=*)*&polygon="+c+"&p=0,10&t=json",b)}else{if(a==="mpolygon"){DCI.Ajax.ajaxService("/"+_applicationName+"/PBJMapSearch?request=SpaceSearch&l=p&s=*)*&polygon="+c+"&radius=1000&p=0,10&t=json",b)}}}}}},describeFeatureType:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?request=describefeaturetype&service="+b.service+"&version="+b.version+"&layername="+b.layername+"&mapservice="+b.mapservice,a)},getFeatureExact:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?service="+b.service+"&version="+b.version+"&typename="+b.typename+"&request=GetFeatureExact&field="+b.field+"&keyword="+b.keyword+"&MAPSERVICE="+b.mapservice,a)},getFeatureFuzzy:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?request=GetFeatureFuzzy&service="+b.service+"&version="+b.version+"&typename="+b.typename+"&field="+b.field+"&keyword="+b.keyword+"&MAPSERVICE="+b.mapservice,a)},bufferWFS:function(b,a){DCI.Ajax.ajaxService("/"+_applicationName+"/GovEMap/wfs?service="+b.service+"&typename="+b.typename+"&field="+b.field+"&keyword="+b.keyword+"&targetlayer="+b.targetlayer+"&distance="+b.distance+"&MAPSERVICE="+b.mapservice+"&bufferunit="+b.bufferunit,a)},SpaceSearch:function(c,b){var a="VERSION=1.0.0&SERVICE=WFS&REQUEST=GetFeature&TYPENAME="+c.layer+"&MaxFeatures=1&Filter=<Filter ><DIntersects><PropertyName>SHAPE</PropertyName><Point><coordinates>"+c.lng+","+c.lat+"</coordinates></Point><Distance>1</Distance></DIntersects></Filter>";DCI.Ajax.ajaxService("/"+_applicationName+"/SpaceSearch",b,"GET",encodeURIComponent(a))},AddrCode:function(c,b){var a="AddrCode/cmd?commandType=40&X="+c.x+"&Y="+c.y+"&Radius=100&Start=0&Nums=1&encode=gbk";DCI.Ajax.ajaxService("/"+_applicationName+"/AddrCode",b,"GET",encodeURIComponent(a))}});DWFSService=function(){return new DCI.Search.WFSService()};DCI.Search.WholeSearch=DCI.Search.extend({wholeSearch_keyWord:function(c,a,b,d){DCI.Ajax.ajaxService("/"+_applicationName+"/WholeSearch?"+encodeURIComponent("request=Key&keyword="+a+"&start=0&num="+b+"&servicename="+c+"&encode=gbk"),d)},wholeSearch_getPoint:function(a,b,c){DCI.Ajax.ajaxService("/"+_applicationName+"/WholeSearch?"+encodeURIComponent("request=getPoint&x="+a.x+"&y="+a.y+"&start=0&num="+b),c)},wholeSearch_tableIndex:function(c,b,a,d){DCI.Ajax.ajaxService("/"+_applicationName+"/WholeSearch?"+encodeURIComponent("request=TableIndex&tableName="+b+"&objectID="+a+"&servicename="+c),d)},wholeSearch_index:function(a,c,b){DCI.Ajax.ajaxService("/"+_applicationName+"/WholeSearch?"+encodeURIComponent("request=Index&ID="+c+"&servicename="+a),b)}});DWholeSearch=function(){return new DCI.Search.WholeSearch()};DCI.WebSocket=DCI.Class.extend({initialize:function(a){ws=null;innerWSClient=this;if(!window.WebSocket&&window.MozWebSocket){window.WebSocket=window.MozWebSocket}if(!window.WebSocket){alert("对不起，您的浏览器不支持websocket，请更换至chrome、firefox、safari、IE10+以上浏览器");return}this.options=a;if(a.ip==null||a.port==null||a.ip==""||a.port==""){this.options.ip="172.26.15.21";this.options.port="8888"}this.startWebSocket()},sendMessage:function(a){innerWSClient.send(a)},send:function(a){console.log("send:"+a);ws.send(a)},startWebSocket:function(){ws=new WebSocket("ws://"+this.options.ip+":"+this.options.port);ws.onopen=function(){console.log("success open")};ws.onmessage=function(a){innerWSClient.handleData(a.data)};ws.onclose=function(a){console.log("Client notified socket has closed",a)}},handleData:function(wsdata){if(wsdata==null||wsdata.length<100){return}try{if(wsdata.indexOf("END")!=-1){wsdata=wsdata.substr(0,wsdata.length-3)}var jsonObj=eval("("+wsdata+")");innerWSClient.options.callback(jsonObj)}catch(e){console.log(wsdata);console.log("系统出现异常："+e.message)}},calculateAngle:function(a,b,c){var d;if((b.X-a.X)==0&&(b.Y-a.Y)==0){d=c}else{if((b.X-a.X)==0){if(b.Y>a.Y){d=270}else{d=90}}else{if((b.Y-a.Y)==0){if(b.X>a.X){d=0}else{d=180}}else{if(b.Y-a.Y>0&&b.X-a.X<0){d=(Math.atan((b.Y-a.Y)/(a.X-b.X))/Math.PI)*180;d=d+180}else{if(b.Y-a.Y<0&&b.X-a.X<0){d=(Math.atan((a.Y-b.Y)/(a.X-b.X))/Math.PI)*180;d=180-d}else{if(b.Y-a.Y>0&&b.X-a.X>0){d=(Math.atan((b.Y-a.Y)/(b.X-a.X))/Math.PI)*180;d=360-d}else{d=(Math.atan((a.Y-b.Y)/(b.X-a.X))/Math.PI)*180;d=d}}}}}if(d){c=d}else{d=c}}return d}});DWebsocket=function(a){return new DCI.WebSocket(a)};DCI.WPS=DCI.Class.extend({getwps:function(b){var a="service=WPS&version=1.0.0&request=GetCapabilities";DCI.Ajax.ajaxService("/"+_applicationName+"/wps",b,"GET",encodeURIComponent(a))},getAreaXML:function(b,c){var a="request=getArea&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getBoundaryXML:function(b,c){var a="request=getBoundary&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getBufferXML:function(b,d,c){var a="request=getBuffer&geometryStr="+b+"&distance="+d;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getCentroidXML:function(b,c){var a="request=getCentroid&geometryStr="+b+"&distance=5";DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getContainsXML:function(d,b,c){var a="request=getContains&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getConvexHullXML:function(b,c){var a="request=getConvexHull&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getCrossesXML:function(d,b,c){var a="request=getCrosses&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getDifferenceXML:function(d,b,c){var a="request=getDifference&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getDimensionXML:function(b,c){var a="request=getDimension&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getDisjointXML:function(d,b,c){var a="request=getDisjoint&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getDistanceXML:function(d,b,c){var a="request=getDistance&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getEndPointXML:function(b,c){var a="request=getEndPoint&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getEnvelopeXML:function(b,c){var a="request=getEnvelope&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getEqualsExactXML:function(d,b,c){var a="request=getEqualsExact&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getExteriorRingXML:function(b,c){var a="request=getExteriorRing&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getGeometryTypeXML:function(b,c){var a="request=getGeometryType&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},GetGeometryNXML:function(b,c,d){var a="request=GetGeometryN&geometryStr="+b+"&index="+c;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",d,"GET",encodeURIComponent(a))},getXXML:function(b,c){var a="request=getX&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getYXML:function(b,c){var a="request=getY&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getInterSectionXML:function(b,c){var a="request=getInterSection&geometry="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getIntersectsXML:function(d,b,c){var a="request=getIntersects&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getIsValidXML:function(b,c){var a="request=getIsValid&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getLengthXML:function(b,c){var a="request=getLength&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getRelateXML:function(d,b,c){var a="request=getRelate&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getSimplifyXML:function(c,b,d){var a="request=getSimplify&geometryStr="+c+"&precision="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",d,"GET",encodeURIComponent(a))},getSimDifferenceXML:function(d,b,c){var a="request=getSimDifference&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getUnionXML:function(b,c){var a="request=getUnion&geometryStr="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},getWithin:function(d,b,c){var a="request=getWithin&geometryA="+d+"&geometryB="+b;DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"GET",encodeURIComponent(a))},postwps:function(b){var a="service=WPS&version=1.0.0&request=GetCapabilities";DCI.Ajax.ajaxService("/"+_applicationName+"/wps",b,"POST",encodeURIComponent(a))},postButtomMsg:function(a){a+="<wps:ResponseForm>";a+="<wps:RawDataOutput>";a+="<ows:Identifier>result</ows:Identifier>";a+="</wps:RawDataOutput>";a+="</wps:ResponseForm>";a+="</wps:Execute>";return a},postRootMsg:function(){var a="";a+='<?xml version="1.0" encoding="UTF-8"?>';a+='<wps:Execute version="1.0.0" service="WPS" ';a+='xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ';a+='xmlns="http://www.opengis.net/wps/1.0.0" ';a+='xmlns:wfs="http://www.opengis.net/wfs" ';a+='xmlns:wps="http://www.opengis.net/wps/1.0.0" ';a+='xmlns:ows="http://www.opengis.net/ows/1.1" ';a+='xmlns:gml="http://www.opengis.net/gml" ';a+='xmlns:ogc="http://www.opengis.net/ogc" ';a+='xmlns:wcs="http://www.opengis.net/wcs/1.1.1" ';a+='xmlns:xlink="http://www.w3.org/1999/xlink" ';a+='xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">';return a},postAreaXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>area</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postBoundaryXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>boundary</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postBufferXML:function(b,d,c){var a=this.postRootMsg();a+="<ows:Identifier>buffer</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>distance</ows:Identifier>";a+="<wps:Data>";a+="<wps:LiteralData>";a+=d;a+="</wps:LiteralData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postCentroidXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>centroid</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postContainsXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>contains</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postConvexHullXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>convexHull</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postCrossesXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>crosses</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postDifferenceXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>difference</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postDimensionXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>dimension</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postDisjointXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>disjoint</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postDistanceXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>disjoint</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postEndPointXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>endPoint</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postEnvelopeXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>envelope</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postEqualsExactXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>equalsExact</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postExteriorRingXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>exteriorRing</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postGeometryTypeXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>geometryType</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postGeometryNXML:function(b,c,d){var a=this.postRootMsg();a+="<ows:Identifier>postGeometryN</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>index</ows:Identifier>";a+="<wps:Data>";a+="<wps:LiteralData>";a+=c;a+="</wps:LiteralData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",d,"POST",encodeURIComponent(a))},postXXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>postX</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postYXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>postY</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postInterSectionXML:function(d,f){var a=this.postRootMsg();a+="<ows:Identifier>intersection</ows:Identifier>";a+="<wps:DataInputs>";var e="";var c=d.split(";");for(var b=0;b<c.length;b++){e+="<wps:Input>";e+="<ows:Identifier>geom</ows:Identifier>";e+="<wps:Data>";e+='<wps:ComplexData mimeType="application/wkt">';e+="<![CDATA[";e+=c[b];e+="]]></wps:ComplexData>";e+="</wps:Data>";e+="</wps:Input>"}a+=e;a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",f,"POST",encodeURIComponent(a))},postIntersectsXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>intersects</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postIsValidXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>isValid</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postLengthXML:function(b,c){var a=this.postRootMsg();a+="<ows:Identifier>length</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postRelateXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>relate</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postSimplifyXML:function(c,b,d){var a=this.postRootMsg();a+="<ows:Identifier>simplify</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>geom</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=c;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>precision</ows:Identifier>";a+="<wps:Data>";a+="<wps:LiteralData>";a+=b;a+="</wps:LiteralData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",d,"POST",encodeURIComponent(a))},postSimDifferenceXML:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>symDifference</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))},postUnionXML:function(d,f){var a=this.postRootMsg();a+="<ows:Identifier>union</ows:Identifier>";a+="<wps:DataInputs>";var e="";var c=d.split(";");for(var b=0;b<c.length;b++){e+="<wps:Input>";e+="<ows:Identifier>geom</ows:Identifier>";e+="<wps:Data>";e+='<wps:ComplexData mimeType="application/wkt">';e+="<![CDATA[";e+=c[b];e+="]]></wps:ComplexData>";e+="</wps:Data>";e+="</wps:Input>"}a+=e;a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",f,"POST",encodeURIComponent(a))},postWithin:function(d,b,c){var a=this.postRootMsg();a+="<ows:Identifier>within</ows:Identifier>";a+="<wps:DataInputs>";a+="<wps:Input>";a+="<ows:Identifier>a</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=d;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="<wps:Input>";a+="<ows:Identifier>b</ows:Identifier>";a+="<wps:Data>";a+='<wps:ComplexData mimeType="application/wkt">';a+="<![CDATA[";a+=b;a+="]]></wps:ComplexData>";a+="</wps:Data>";a+="</wps:Input>";a+="</wps:DataInputs>";a=this.postButtomMsg(a);DCI.Ajax.ajaxService("/"+_applicationName+"/wps",c,"POST",encodeURIComponent(a))}});DCI.wps=function(){return new DCI.WPS()};DCI.FilterOperator=DCI.Class.extend({initialize:function(a){this._name=a},getName:function(){return this._name},xml:function(){return null}});DCI.SpatialOperator=DCI.FilterOperator.extend({initialize:function(a){DCI.FilterOperator.prototype.initialize.call(this,a)}});DCI.BinarySpatialOperator=DCI.Class.extend({initialize:function(b,a,c){DCI.SpatialOperator.prototype.initialize.call(this,b);this._propertyName=a;this._geometry=c},getPropertyName:function(){return this._propertyName},setPropertyName:function(a){if(a==null){throw new Error("PropertyName cannot be null")}this._propertyName=a},getGeometry:function(){return this._geometry},setGeometry:function(a){this._geometry=a}});DCI.Within=DCI.BinarySpatialOperator.extend({initialize:function(a,b){DCI.BinarySpatialOperator.prototype.initialize.call(this,"Within",a,b)},xml:function(){var a="<ogc:Within xmlns:ogc='http://www.opengis.net/ogc'>";if(this.propertyName!=null){a+="<ogc:PropertyName xmlns:ogc='http://www.opengis.net/ogc'>"+this._propertyName+"</ogc:PropertyName>"}else{a+="<ogc:PropertyName xmlns:ogc='http://www.opengis.net/ogc'>SHAPE</ogc:PropertyName>"}a+=this._geometry.gml();if(this._geometry instanceof DCI.Circle){a=a.replace("Within","DWithin");a+="<Distance>"+this._geometry.getRadius()+"</Distance></ogc:DWithin>"}else{a+="</ogc:Within>"}return encodeURIComponent("<ogc:Filter>"+a+"</ogc:Filter>")}});DCI.within=function(a,b){return new DCI.Within(a,b)};DCI.DWithin=DCI.BinarySpatialOperator.extend({initialize:function(a,b,c){DCI.BinarySpatialOperator.prototype.initialize.call(this,"DWithin",a,b);this._distance=c},xml:function(){var a="<DWithin>";if(this.propertyName!=null){a+="<PropertyName>"+this._propertyName+"</PropertyName>"}else{a+="<PropertyName>SHAPE</PropertyName>"}a+=this._geometry.gml();if(!this._distance){this._distance=1000}if(this._geometry instanceof DCI.Circle){this._distance+=this._geometry.getRadius()}a+="<Distance>"+this._distance+"</Distance></DWithin>";return encodeURIComponent("<Filter>"+a+"</Filter>")}});DCI.dwithin=function(a,b,c){return new DCI.DWithin(a,b,c)};DCI.Bbox=DCI.SpatialOperator.extend({initialize:function(b,a){DCI.SpatialOperator.prototype.initialize.call(this,"BBox");this.extent=b;this.propertyName=a},xml:function(){var b="<ogc:BBOX xmlns:ogc='http://www.opengis.net/ogc'>";if(this.propertyName!=null){b+="<ogc:PropertyName  xmlns:ogc='http://www.opengis.net/ogc'>"+this.propertyName+"</ogc:PropertyName>"}else{b+="<ogc:PropertyName  xmlns:ogc='http://www.opengis.net/ogc'>SHAPE</ogc:PropertyName>"}var a=this.extent.getSouthWest();var c=this.extent.getNorthEast();var d=a.lng+","+a.lat+" "+c.lng+","+c.lat;b+="<gml:Box><gml:coordinates>"+d+"</gml:coordinates></gml:Box>";b+="</ogc:BBOX>";return encodeURIComponent("<ogc:Filter>"+b+"</ogc:Filter>")}});DCI.bbox=function(b,a){return new DCI.Bbox(b,a)};DCI.ComparisonOperator=DCI.FilterOperator.extend({initialize:function(a){DCI.FilterOperator.prototype.initialize.call(this,a)}});DCI.PropertyIsEqualTo=DCI.ComparisonOperator.extend({initialize:function(a,b){this.propertyName=a;this.literal=b;DCI.ComparisonOperator.prototype.initialize.call(this,"PropertyIsEqualTo")},xml:function(){var a="<ogc:PropertyIsEqualTo xmlns:ogc='http://www.opengis.net/ogc'><ogc:PropertyName>"+this.propertyName+"</ogc:PropertyName><Literal>"+this.literal+"</Literal></ogc:PropertyIsEqualTo>";return"<ogc:Filter>"+a+"</ogc:Filter>"}});DCI.propertyIsEqualTo=function(a,b){return new DCI.PropertyIsEqualTo(a,b)};DCI.Transaction=DCI.Class.extend({add:function(b,d,e){var c="<?xml version='1.0'?><Transaction><Insert><"+b+" id='F1'>";var a="";for(prop in d){a+="<"+prop+">"+d[prop]+"</"+prop+">"}c+=a+"</"+b+"></Insert></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",e,"POST",encodeURIComponent(c))},upd:function(b,d,e,f){var c="<?xml version='1.0'?><Transaction><Update typeName='"+b+"'>";var a="";for(prop in d){a+="<Property><Name>"+prop+"</Name><Value>"+d[prop]+"</Value></Property>"}c+=a;c+=e+"</Update></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",f,"POST",encodeURIComponent(c))},del:function(a,c,d){var b="<?xml version='1.0'?><Transaction><Delete typeName='"+a+"'>";b+=c+"</Delete></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",d,"POST",encodeURIComponent(b))}});DCI.transaction=function(){return new DCI.Transaction()};DCI.Transaction.Point=DCI.Transaction.extend({add:function(b,f,d,e){var c="<?xml version='1.0'?><Transaction><Insert><"+b+" id='F1'><SHAPEDATA><Point><coordinates>"+f.lng+","+f.lat+"</coordinates></Point></SHAPEDATA>";var a="";for(prop in d){a+="<"+prop+">"+d[prop]+"</"+prop+">"}c+=a+"</"+b+"></Insert></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",e,"POST",encodeURIComponent(c))},update:function(g,b,c,f,e,h){var k="<?xml version='1.0'?><Transaction><Update typeName='"+g+"'><Property><ValueReference>"+b+"</ValueReference><Value><Point><coordinates>"+c.lng+","+c.lat+"</coordinates></Point></Value></Property>";var d=DCI.propertyIsEqualTo(f,e);var a=d.xml();k+=a+"</Update></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",h,"POST",encodeURIComponent(k))}});DCI.transaction.point=function(){return new DCI.Transaction.Point()};DCI.Transaction.Polyline=DCI.Transaction.extend({add:function(g,f,d,h){var k="<?xml version='1.0'?><Transaction><Insert><"+g+" id='F1'><SHAPEDATA><MultiLineString><lineStringMember><lineString><posList>";var b=f.getLatLngs();var e="";for(var c=0;c<b.length;c++){e+=b[c].lng+" "+b[c].lat+" "}k+=e.substring(0,e.length-1);k+="</posList></lineString></lineStringMember></MultiLineString></SHAPEDATA>";var a="";for(prop in d){a+="<"+prop+">"+d[prop]+"</"+prop+">"}k+=a+"</"+g+"></Insert></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",h,"POST",encodeURIComponent(k))},update:function(l,c,k,h,f,m){var n="<?xml version='1.0'?><Transaction><Update typeName='"+l+"'><Property><ValueReference>"+c+"</ValueReference><Value><MultiLineString><lineStringMember><lineString><posList>";var a=k.getLatLngs();var g="";for(var e=0;e<a.length;e++){g+=a[e].lng+" "+a[e].lat+" "}n+=g.substring(0,g.length-1);n+="</posList></lineString></lineStringMember></MultiLineString></Value></Property>";var d=DCI.propertyIsEqualTo(h,f);var b=d.xml();n+=b+"</Update></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",m,"POST",encodeURIComponent(n))}});DCI.transaction.polyline=function(){return new DCI.Transaction.Polyline()};DCI.Transaction.Polygon=DCI.Transaction.extend({add:function(g,f,d,h){var k="<?xml version='1.0'?><Transaction><Insert><"+g+" id='F1'><SHAPEDATA><Polygon><exterior><LinearRing><posList>";var b=f.getLatLngs();var e="";for(var c=0;c<b.length;c++){e+=b[c].lng+" "+b[c].lat+" "}e+=b[0].lng+" "+b[0].lat;k+=e+"</posList></LinearRing></exterior></Polygon></SHAPEDATA>";var a="";for(prop in d){a+="<"+prop+">"+d[prop]+"</"+prop+">"}k+=a+"</"+g+"></Insert></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",h,"POST",encodeURIComponent(k))},update:function(l,c,k,h,g,m){var n="<?xml version='1.0'?><Transaction><Update typeName='"+l+"'><Property><ValueReference>"+c+"</ValueReference><Value><Polygon><exterior><LinearRing><posList>";var a=k.getLatLngs();var d="";for(var f=0;f<a.length;f++){d+=a[f].lng+" "+a[f].lat+" "}d+=a[0].lng+" "+a[0].lat;n+=d+"</posList></LinearRing></exterior></Polygon></Value></Property>";var e=DCI.propertyIsEqualTo(h,g);var b=e.xml();n+=b+"</Update></Transaction>";DCI.Ajax.ajaxService("/"+_applicationName+"/GIMSNEW",m,"POST",encodeURIComponent(n))}});DCI.transaction.polygon=function(){return new DCI.Transaction.Polygon()};